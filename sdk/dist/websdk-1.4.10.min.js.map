{"version":3,"sources":["websdk-1.4.10.js"],"names":["_typeof","Symbol","iterator","obj","constructor","prototype","root","factory","exports","module","define","amd","undefined","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_parsePrivacy","iq","list","items","getElementsByTagName","i","length","item","jid","getAttribute","order","type","n","_parseNameFromJidFn","name","_parseGroupBlacklist","affiliation","nick","_setText","valueDom","v","textContent","text","logMessage","message","WebIM","config","isDebug","console","log","utils","ts","data","_version","_code","code","_utils","_msg","_message","_msgHash","Queue","window","URL","webkitURL","mozURL","msURL","XDomainRequest","oldsend","send","apply","this","arguments","readyState","Strophe","Request","_newXHR","xhr","xmlrequest","overrideMimeType","onreadystatechange","func","bind","Websocket","_closeSocket","socket","me","setTimeout","close","e","_onMessage","elem","indexOf","DOMParser","parseFromString","documentElement","see_uri","_conn","_changeConnectStatus","Status","REDIRECT","reset","service","_connect","_doDisconnect","search","_handleStreamStart","_streamWrap","_check_streamerror","ERROR","disconnecting","firstChild","nodeName","xmlInput","rawInput","serialize","_dataRecv","_listenNetwork","onlineCallback","offlineCallback","addEventListener","attachEvent","document","body","_parseRoom","result","rooms","roomJid","tmp","split","room","roomId","push","_parseRoomOccupants","occupants","_parseResponseMessage","msginfo","parseMsgData","errorMsg","msgBodies","msgBody","childNodes","childNode","nodeType","ElementType","TEXT","jsondata","wholeText","nodeValue","replace","eval","delayTags","delayTag","delayMsgTime","delayTimeStamp","childrens","child","domain","tempstr","findex","substring","atindex","_parseFriend","queryTag","conn","from","rouster","subscription","friend","ask","groups","forEachChild","group","getText","subscribe","toJid","subscribed","_login","options","accessToken","access_token","stringify","onError","WEBIM_CONNCTION_OPEN_USERGRID_ERROR","context","accessTokenExpires","expires_in","stropheConn","isOpening","isOpened","getStrophe","callback","status","msg","_loginCallback","route","connect","wait","hold","_parseMessageType","receiveinfo","inviteinfo","deliveryinfo","acked","error","msgtype","namespaceURI","errorItem","userMuted","_handleMessageQueue","hasOwnProperty","conflict","CONNFAIL","WEBIM_CONNCTION_SERVER_CLOSE_ERROR","reconnect","ATTACHED","CONNECTED","autoReconnectNumTotal","intervalId","setInterval","handelSendQueue","handleMessage","delivery","handleDeliveredMessage","handleAckedMessage","handleReceivedMessage","handleInviteMessage","handleMutedMessage","handlePresence","handlePing","handleIqRoster","handleIqPrivacy","handleIq","addHandler","registerConfrIQHandler","STATUS_OPENED","supportRecMessage","WEBIM_MESSAGE_REC_TEXT","WEBIM_MESSAGE_REC_EMOJI","isCanDownLoadFile","WEBIM_MESSAGE_REC_PHOTO","WEBIM_MESSAGE_REC_AUDIO_FILE","supportSedMessage","WEBIM_MESSAGE_SED_TEXT","isCanUploadFile","notifyVersion","retry","heartBeat","isAutoLogin","setPresence","onOpened","canReceive","canSend","DISCONNECTING","stopHeartBeat","STATUS_CLOSING","DISCONNECTED","autoReconnectNumMax","WEBIM_CONNCTION_DISCONNECTED","STATUS_CLOSED","clear","onClosed","AUTHFAIL","WEBIM_CONNCTION_AUTH_ERROR","STATUS_ERROR","WEBIM_CONNCTION_SERVER_ERROR","status_now","_getJid","appKey","to","resource","_getJidByName","_validCheck","user","WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR","devInfos","WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR","orgName","appName","toLowerCase","isMultiLoginSessions","Date","getTime","Math","floor","random","toFixed","userId","_getXmppUrl","baseUrl","https","test","url","prefix","base","suffix","isSupportWss","WebSocket","connection","isHttpDNS","location","protocol","inactivity","heartBeatWait","maxRetries","pollingTime","autoReconnectInterval","STATUS_INIT","sendQueue","apiUrl","isWindowSDK","dnsArr","dnsIndex","dnsTotal","restHosts","restIndex","restTotal","xmppHosts","xmppIndex","xmppTotal","groupOption","registerUser","getHttpDNS","signup","pop","sendReceiptsMessage","listen","emptyfn","onTextMessage","onEmojiMessage","onPictureMessage","onAudioMessage","onVideoMessage","onFileMessage","onLocationMessage","onCmdMessage","onPresence","onRoster","onReceivedMessage","onInviteMessage","onDeliverdMessage","onDeliveredMessage","onReadMessage","onMutedMessage","onOffline","onOnline","onConfirmPop","onCreateGroup","onUpdateMyGroupList","onUpdateMyRoster","onBlacklistUpdate","forcing","isNeed","navigator","userAgent","heartBeatID","ping","clearInterval","dom","$msg","xmlns","sendCommand","tree","cacheReceiptsMessage","host","getXmlFirstChild","ip","port","parter","Connection","getHostsByTag","tagName","tag","hosts","getRestFromHttpDNS","login","self","suc","res","options2","dataType","app_key","encodeURIComponent","success","ajax","EMPTYFN","err","restUrl","userjson","username","password","nickname","userinfo","open","xmppURL","pass","restTokenData","pwd","STATUS_DOLOGIN_IM","error_description","WEBIM_CONNCTION_OPEN_ERROR","STATUS_DOLOGIN_USERGRID","loginJson","grant_type","timestamp","loginfo","attach","WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR","sid","WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR","rid","WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR","wind","reason","isClosed","isClosing","disconnect","handler","ns","fail","$iq","t","up","failFn","ele","WEBIM_CONNCTION_NOTIFYVERSION_ERROR","sendIQ","presence_type","fromUser","toUser","isCreate","isMemberJoin","isDecline","isApply","info","fromJid","chatroom","showTags","showTag","show","statusTags","statusTag","priorityTags","priorityTag","priority","destroy","members","member","role","kickedMember","actor","actorNick","kicked","x","accept","decline","toNick","groupJid","gid","mid","owner","original_type","reflectUser","slice","lastIndexOf","getBlacklist","curJid","iqresult","errorCode","errorText","errorBool","textDOM","msgDatas","too","extmsg","ext","chattype","typeEl","bodies","receiveMsg","emojibody","parseTextMessage","Emoji","isemoji","delay","rwidth","rheight","size","width","height","substr","secret","filename","thumb","thumb_secret","file_length","filetype","addr","lat","lng","action","WEBIM_CONNCTION_CALLBACK_INNER_ERROR","isNaN","innerHTML","received","rcv","innerText","Function","form","invitemsg","reasonDom","reasonMsg","xmsg","roomid","roomjid","getUniqueId","autoIncrement","cdate","offdate","offset","hexd","parseFloat","toString","doQuery","encodeURI","chatType","response","WEBIM_MESSAGE_SED_ERROR","Object","addRoster","removeRoster","getRoster","completeFn","WEBIM_CONNCTION_GETROSTER_ERROR","pres","$pres","unsubscribe","unsubscribed","joinPublicGroup","room_nick","errorFn","WEBIM_CONNCTION_JOINROOM_ERROR","NS","MUC","listRooms","server","DISCO_ITEMS","WEBIM_CONNCTION_GETROOM_ERROR","queryRoomMember","mem","WEBIM_CONNCTION_GETROOMMEMBER_ERROR","queryRoomInfo","DISCO_INFO","settings","features","fields","fieldValues","field","fieldVar","fieldSimplify","WEBIM_CONNCTION_GETROOMINFO_ERROR","queryRoomOccupants","WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR","attrs","setUserSig","desc","getPresence","WEBIM_CONNCTION_PING_ERROR","key","errorType","WEBIM_CONNCTION_CLIENT_LOGOUT","getChatRooms","isCanSetRequestHeader","WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR","token","WEBIM_CONNCTION_LOAD_CHATROOM_ERROR","pageInfo","pagenum","parseInt","pagesize","opts","headers","Authorization","joinChatRoom","WEBIM_CONNCTION_JOINCHATROOM_ERROR","quitChatRoom","WEBIM_CONNCTION_QUITCHATROOM_ERROR","_onReceiveInviteFromGroup","title","group_id","agree","WEBIM_CONNECTION_ACCEPT_INVITATION_FROM_GROUP","reject","WEBIM_CONNECTION_DECLINE_INVITATION_FROM_GROUP","_onReceiveInviteAcceptionFromGroup","_onReceiveInviteDeclineFromGroup","_onAutoAcceptInvitationFromGroup","group_name","_onLeaveGroup","_onReceiveJoinGroupApplication","WEBIM_CONNECTION_ACCEPT_JOIN_GROUP","WEBIM_CONNECTION_DECLINE_JOIN_GROUP","_onReceiveAcceptionFromGroup","_onReceiveRejectionFromGroup","_onUpdateMyGroupList","_onUpdateMyRoster","that","closed","WEBIM_CONNECTION_CLOSED","sucFn","errFn","addToBlackList","blacklist","piece","keys","len","value","removeFromBlackList","_getGroupJid","addToGroupBlackList","getGroupBlacklist","removeGroupMemberFromBlacklist","changeGroupSubject","var","subject","description","destroyGroup","leaveGroupBySelf","msgInfo","errInfo","leaveGroup","addGroupMembers","acceptInviteFromGroup","rejectInviteFromGroup","createGroupAsync","toRoom","setAttribute","optionsMaxUsers","optionsPublic","optionsMembersOnly","optionsModerate","optionsAllowInvites","cnode","createGroup","createGroupNew","respData","shieldGroup","statusCode","str","cefQuery","request","persistent","onSuccess","onFailure","rawOutput","isSandBox","apiURL","WEBIM_CONNCTION_ATTACH_ERROR","WEBIM_CONNCTION_ATTACH_USERGRID_ERROR","WEBIM_CONNCTION_REOPEN_ERROR","WEBIM_CONNCTION_IQ_ERROR","WEBIM_CONNCTION_CROSSDOMAIN_ERROR","WEBIM_CONNCTION_LISTENING_OUTOF_MAXRETRIES","WEBIM_CONNCTION_RECEIVEMSG_CONTENTERROR","WEBIM_CONNCTION_AJAX_ERROR","WEBIM_CONNCTION_CLIENT_OFFLINE","WEBIM_CONNCTION_CLIENT_TOO_MUCH_ERROR","WEBIM_UPLOADFILE_BROWSER_ERROR","WEBIM_UPLOADFILE_ERROR","WEBIM_UPLOADFILE_NO_LOGIN","WEBIM_UPLOADFILE_NO_FILE","WEBIM_DOWNLOADFILE_ERROR","WEBIM_DOWNLOADFILE_NO_LOGIN","WEBIM_DOWNLOADFILE_BROWSER_ERROR","WEBIM_MESSAGE_REC_TEXT_ERROR","WEBIM_MESSAGE_REC_EMOTION","WEBIM_MESSAGE_REC_AUDIO","WEBIM_MESSAGE_REC_VEDIO","WEBIM_MESSAGE_REC_VEDIO_FILE","WEBIM_MESSAGE_REC_FILE","WEBIM_MESSAGE_SED_EMOTION","WEBIM_MESSAGE_SED_PHOTO","WEBIM_MESSAGE_SED_AUDIO","WEBIM_MESSAGE_SED_AUDIO_FILE","WEBIM_MESSAGE_SED_VEDIO","WEBIM_MESSAGE_SED_VEDIO_FILE","WEBIM_MESSAGE_SED_FILE","WEBIM_FILESIZE_LIMIT","_createStandardXHR","XMLHttpRequest","_createActiveXHR","ActiveXObject","_xmlrequest","crossDomain","temp","onload","xmlDoc","async","loadXML","responseText","responseXML","ontimeout","onerror","_hasFlash","ex","plugins","_base64","_keyStr","encode","input","chr1","chr2","chr3","enc1","enc2","enc3","enc4","output","_utf8_encode","charCodeAt","charAt","decode","String","fromCharCode","_utf8_decode","string","utftext","c2","c3","_tmpUtilXHR","_hasFormData","FormData","_hasBlob","Blob","_isCanSetRequestHeader","setRequestHeader","_hasOverrideMimeType","_isCanUploadFileAsync","_isCanUploadFile","_isCanDownLoadFile","hasDontEnumBug","propertyIsEnumerable","dontEnums","dontEnumsLength","TypeError","prop","hasFormData","hasBlob","hasOverrideMimeType","isCanUploadFileAsync","notSupportList","ua","l","getIEVersion","matches","tridentMap","4","5","6","7","match","json","JSON","s","arr","iterate","isArr","o","getFileUrl","fileInputId","uri","fileObj","getElementById","createObjectURL","fileItems","files","u","pos1","pos2","pos","max","index","getFileSize","file","fileSize","getFileLength","kb","round","mb","gb","fileLength","select","fileobject","GetFile","Size","hasFlash","trim","parseEmoji","map","emoji","face","path","parseLink","reg","parseJSON","parse","requireNonComma","depth","comma","parseUploadResponse","parseDownloadResponse","uploadFile","onFileUploadProgress","onFileUploadComplete","onFileUploadError","onFileUploadCanceled","acc","uploadUrl","flashUpload","upload","abort","formData","append","download","onFileDownloadComplete","onFileDownloadError","method","resType","responseType","mimeType","innerHeaer","X-Requested-With","Accept","share-secret","faces","emessage","expr","tmsg","existEmoji","emojiStr","restMsgIndex","parseUri","pattern","args","eq","children","tempData","d","Hours","getHours","Minutes","getMinutes","Seconds","getSeconds","Milliseconds","getMilliseconds","getObjectKey","val","sprintf","arg","encrypt","base64","decrypt","escape","unescape","setCookie","days","cookie","getCookie","allCookie","all","decodeURIComponent","Message","setGroup","read","set","opt","ackId","bodyId","txt","roomType","cmd","img","uploadError","uploadComplete","audio","video","_Message","_send","weichat","originType","jsonstr","_tmpComplete","_complete","entities","file_len","thumbnail","Array_h","array","Array","at","start","end","concat","remove","count","splice","join","separator","_array_h","_index","ret","head","tail","empty"],"mappings":"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","file":"websdk-1.4.10.min.js","sourcesContent":["'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\n(function webpackUniversalModuleDefinition(root, factory) {\n\tif ((typeof exports === 'undefined' ? 'undefined' : _typeof(exports)) === 'object' && (typeof module === 'undefined' ? 'undefined' : _typeof(module)) === 'object') module.exports = factory();else if (typeof define === 'function' && define.amd) define([], factory);else if ((typeof exports === 'undefined' ? 'undefined' : _typeof(exports)) === 'object') exports[\"WebIM\"] = factory();else root[\"WebIM\"] = factory();\n})(undefined, function () {\n\treturn (/******/function (modules) {\n\t\t\t// webpackBootstrap\n\t\t\t/******/ // The module cache\n\t\t\t/******/var installedModules = {};\n\n\t\t\t/******/ // The require function\n\t\t\t/******/function __webpack_require__(moduleId) {\n\n\t\t\t\t/******/ // Check if module is in cache\n\t\t\t\t/******/if (installedModules[moduleId])\n\t\t\t\t\t/******/return installedModules[moduleId].exports;\n\n\t\t\t\t/******/ // Create a new module (and put it into the cache)\n\t\t\t\t/******/var module = installedModules[moduleId] = {\n\t\t\t\t\t/******/exports: {},\n\t\t\t\t\t/******/id: moduleId,\n\t\t\t\t\t/******/loaded: false\n\t\t\t\t\t/******/ };\n\n\t\t\t\t/******/ // Execute the module function\n\t\t\t\t/******/modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t\t\t\t/******/ // Flag the module as loaded\n\t\t\t\t/******/module.loaded = true;\n\n\t\t\t\t/******/ // Return the exports of the module\n\t\t\t\t/******/return module.exports;\n\t\t\t\t/******/\n\t\t\t}\n\n\t\t\t/******/ // expose the modules object (__webpack_modules__)\n\t\t\t/******/__webpack_require__.m = modules;\n\n\t\t\t/******/ // expose the module cache\n\t\t\t/******/__webpack_require__.c = installedModules;\n\n\t\t\t/******/ // __webpack_public_path__\n\t\t\t/******/__webpack_require__.p = \"\";\n\n\t\t\t/******/ // Load entry module and return exports\n\t\t\t/******/return __webpack_require__(0);\n\t\t\t/******/\n\t\t}(\n\t\t/************************************************************************/\n\t\t/******/[\n\t\t/* 0 */\n\t\t/***/function (module, exports, __webpack_require__) {\n\n\t\t\tmodule.exports = __webpack_require__(1);\n\n\t\t\t/***/\n\t\t},\n\t\t/* 1 */\n\t\t/***/function (module, exports, __webpack_require__) {\n\n\t\t\tvar _version = '1.4.2';\n\t\t\tvar _code = __webpack_require__(2).code;\n\t\t\tvar _utils = __webpack_require__(3).utils;\n\t\t\tvar _msg = __webpack_require__(4);\n\t\t\tvar _message = _msg._msg;\n\t\t\tvar _msgHash = {};\n\t\t\tvar Queue = __webpack_require__(5).Queue;\n\n\t\t\twindow.URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n\n\t\t\tif (window.XDomainRequest) {\n\t\t\t\tXDomainRequest.prototype.oldsend = XDomainRequest.prototype.send;\n\t\t\t\tXDomainRequest.prototype.send = function () {\n\t\t\t\t\tXDomainRequest.prototype.oldsend.apply(this, arguments);\n\t\t\t\t\tthis.readyState = 2;\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tStrophe.Request.prototype._newXHR = function () {\n\t\t\t\tvar xhr = _utils.xmlrequest(true);\n\t\t\t\tif (xhr.overrideMimeType) {\n\t\t\t\t\txhr.overrideMimeType('text/xml');\n\t\t\t\t}\n\t\t\t\t// use Function.bind() to prepend ourselves as an argument\n\t\t\t\txhr.onreadystatechange = this.func.bind(null, this);\n\t\t\t\treturn xhr;\n\t\t\t};\n\n\t\t\tStrophe.Websocket.prototype._closeSocket = function () {\n\t\t\t\tif (this.socket) {\n\t\t\t\t\tvar me = this;\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tme.socket.close();\n\t\t\t\t\t\t} catch (e) {}\n\t\t\t\t\t}, 0);\n\t\t\t\t} else {\n\t\t\t\t\tthis.socket = null;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t/**\n    *\n    * Strophe.Websocket has a bug while logout:\n    * 1.send: <presence xmlns='jabber:client' type='unavailable'/> is ok;\n    * 2.send: <close xmlns='urn:ietf:params:xml:ns:xmpp-framing'/> will cause a problem,log as follows:\n    * WebSocket connection to 'ws://im-api.easemob.com/ws/' failed: Data frame received after close_connect @ strophe.js:5292connect @ strophe.js:2491_login @ websdk-1.1.2.js:278suc @ websdk-1.1.2.js:636xhr.onreadystatechange @ websdk-1.1.2.js:2582\n    * 3 \"Websocket error [object Event]\"\n    * _changeConnectStatus\n    * onError Object {type: 7, msg: \"The WebSocket connection could not be established or was disconnected.\", reconnect: true}\n    *\n    * this will trigger socket.onError, therefore _doDisconnect again.\n    * Fix it by overide  _onMessage\n    */\n\t\t\tStrophe.Websocket.prototype._onMessage = function (message) {\n\t\t\t\tlogMessage(message);\n\t\t\t\tvar elem, data;\n\t\t\t\t// check for closing stream\n\t\t\t\t// var close = '<close xmlns=\"urn:ietf:params:xml:ns:xmpp-framing\" />';\n\t\t\t\t// if (message.data === close) {\n\t\t\t\t//     this._conn.rawInput(close);\n\t\t\t\t//     this._conn.xmlInput(message);\n\t\t\t\t//     if (!this._conn.disconnecting) {\n\t\t\t\t//         this._conn._doDisconnect();\n\t\t\t\t//     }\n\t\t\t\t//     return;\n\t\t\t\t//\n\t\t\t\t// send and receive close xml: <close xmlns='urn:ietf:params:xml:ns:xmpp-framing'/>\n\t\t\t\t// so we can't judge whether message.data equals close by === simply.\n\t\t\t\tif (message.data.indexOf(\"<close \") === 0) {\n\t\t\t\t\telem = new DOMParser().parseFromString(message.data, \"text/xml\").documentElement;\n\t\t\t\t\tvar see_uri = elem.getAttribute(\"see-other-uri\");\n\t\t\t\t\tif (see_uri) {\n\t\t\t\t\t\tthis._conn._changeConnectStatus(Strophe.Status.REDIRECT, \"Received see-other-uri, resetting connection\");\n\t\t\t\t\t\tthis._conn.reset();\n\t\t\t\t\t\tthis._conn.service = see_uri;\n\t\t\t\t\t\tthis._connect();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// if (!this._conn.disconnecting) {\n\t\t\t\t\t\tthis._conn._doDisconnect(\"receive <close> from server\");\n\t\t\t\t\t\t// }\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t} else if (message.data.search(\"<open \") === 0) {\n\t\t\t\t\t// This handles stream restarts\n\t\t\t\t\telem = new DOMParser().parseFromString(message.data, \"text/xml\").documentElement;\n\t\t\t\t\tif (!this._handleStreamStart(elem)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tdata = this._streamWrap(message.data);\n\t\t\t\t\telem = new DOMParser().parseFromString(data, \"text/xml\").documentElement;\n\t\t\t\t}\n\n\t\t\t\tif (this._check_streamerror(elem, Strophe.Status.ERROR)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t//handle unavailable presence stanza before disconnecting\n\t\t\t\tif (this._conn.disconnecting && elem.firstChild.nodeName === \"presence\" && elem.firstChild.getAttribute(\"type\") === \"unavailable\") {\n\t\t\t\t\tthis._conn.xmlInput(elem);\n\t\t\t\t\tthis._conn.rawInput(Strophe.serialize(elem));\n\t\t\t\t\t// if we are already disconnecting we will ignore the unavailable stanza and\n\t\t\t\t\t// wait for the </stream:stream> tag before we close the connection\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis._conn._dataRecv(elem, message.data);\n\t\t\t};\n\n\t\t\tvar _listenNetwork = function _listenNetwork(onlineCallback, offlineCallback) {\n\n\t\t\t\tif (window.addEventListener) {\n\t\t\t\t\twindow.addEventListener('online', onlineCallback);\n\t\t\t\t\twindow.addEventListener('offline', offlineCallback);\n\t\t\t\t} else if (window.attachEvent) {\n\t\t\t\t\tif (document.body) {\n\t\t\t\t\t\tdocument.body.attachEvent('ononline', onlineCallback);\n\t\t\t\t\t\tdocument.body.attachEvent('onoffline', offlineCallback);\n\t\t\t\t\t} else {\n\t\t\t\t\t\twindow.attachEvent('load', function () {\n\t\t\t\t\t\t\tdocument.body.attachEvent('ononline', onlineCallback);\n\t\t\t\t\t\t\tdocument.body.attachEvent('onoffline', offlineCallback);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t/*var onlineTmp = window.ononline;\n      var offlineTmp = window.onoffline;\n       window.attachEvent('ononline', function () {\n      try {\n      typeof onlineTmp === 'function' && onlineTmp();\n      } catch ( e ) {}\n      onlineCallback();\n      });\n      window.attachEvent('onoffline', function () {\n      try {\n      typeof offlineTmp === 'function' && offlineTmp();\n      } catch ( e ) {}\n      offlineCallback();\n      });*/\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tvar _parseRoom = function _parseRoom(result) {\n\t\t\t\tvar rooms = [];\n\t\t\t\tvar items = result.getElementsByTagName('item');\n\t\t\t\tif (items) {\n\t\t\t\t\tfor (var i = 0; i < items.length; i++) {\n\t\t\t\t\t\tvar item = items[i];\n\t\t\t\t\t\tvar roomJid = item.getAttribute('jid');\n\t\t\t\t\t\tvar tmp = roomJid.split('@')[0];\n\t\t\t\t\t\tvar room = {\n\t\t\t\t\t\t\tjid: roomJid,\n\t\t\t\t\t\t\tname: item.getAttribute('name'),\n\t\t\t\t\t\t\troomId: tmp.split('_')[1]\n\t\t\t\t\t\t};\n\t\t\t\t\t\trooms.push(room);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn rooms;\n\t\t\t};\n\n\t\t\tvar _parseRoomOccupants = function _parseRoomOccupants(result) {\n\t\t\t\tvar occupants = [];\n\t\t\t\tvar items = result.getElementsByTagName('item');\n\t\t\t\tif (items) {\n\t\t\t\t\tfor (var i = 0; i < items.length; i++) {\n\t\t\t\t\t\tvar item = items[i];\n\t\t\t\t\t\tvar room = {\n\t\t\t\t\t\t\tjid: item.getAttribute('jid'),\n\t\t\t\t\t\t\tname: item.getAttribute('name')\n\t\t\t\t\t\t};\n\t\t\t\t\t\toccupants.push(room);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn occupants;\n\t\t\t};\n\n\t\t\tvar _parseResponseMessage = function _parseResponseMessage(msginfo) {\n\t\t\t\tvar parseMsgData = { errorMsg: true, data: [] };\n\n\t\t\t\tvar msgBodies = msginfo.getElementsByTagName('body');\n\t\t\t\tif (msgBodies) {\n\t\t\t\t\tfor (var i = 0; i < msgBodies.length; i++) {\n\t\t\t\t\t\tvar msgBody = msgBodies[i];\n\t\t\t\t\t\tvar childNodes = msgBody.childNodes;\n\t\t\t\t\t\tif (childNodes && childNodes.length > 0) {\n\t\t\t\t\t\t\tvar childNode = msgBody.childNodes[0];\n\t\t\t\t\t\t\tif (childNode.nodeType == Strophe.ElementType.TEXT) {\n\t\t\t\t\t\t\t\tvar jsondata = childNode.wholeText || childNode.nodeValue;\n\t\t\t\t\t\t\t\tjsondata = jsondata.replace('\\n', '<br>');\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tvar data = eval('(' + jsondata + ')');\n\t\t\t\t\t\t\t\t\tparseMsgData.errorMsg = false;\n\t\t\t\t\t\t\t\t\tparseMsgData.data = [data];\n\t\t\t\t\t\t\t\t} catch (e) {}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tvar delayTags = msginfo.getElementsByTagName('delay');\n\t\t\t\t\tif (delayTags && delayTags.length > 0) {\n\t\t\t\t\t\tvar delayTag = delayTags[0];\n\t\t\t\t\t\tvar delayMsgTime = delayTag.getAttribute('stamp');\n\t\t\t\t\t\tif (delayMsgTime) {\n\t\t\t\t\t\t\tparseMsgData.delayTimeStamp = delayMsgTime;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tvar childrens = msginfo.childNodes;\n\t\t\t\t\tif (childrens && childrens.length > 0) {\n\t\t\t\t\t\tvar child = msginfo.childNodes[0];\n\t\t\t\t\t\tif (child.nodeType == Strophe.ElementType.TEXT) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tvar data = eval('(' + child.nodeValue + ')');\n\t\t\t\t\t\t\t\tparseMsgData.errorMsg = false;\n\t\t\t\t\t\t\t\tparseMsgData.data = [data];\n\t\t\t\t\t\t\t} catch (e) {}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn parseMsgData;\n\t\t\t};\n\n\t\t\tvar _parseNameFromJidFn = function _parseNameFromJidFn(jid, domain) {\n\t\t\t\tdomain = domain || '';\n\t\t\t\tvar tempstr = jid;\n\t\t\t\tvar findex = tempstr.indexOf('_');\n\n\t\t\t\tif (findex !== -1) {\n\t\t\t\t\ttempstr = tempstr.substring(findex + 1);\n\t\t\t\t}\n\t\t\t\tvar atindex = tempstr.indexOf('@' + domain);\n\t\t\t\tif (atindex !== -1) {\n\t\t\t\t\ttempstr = tempstr.substring(0, atindex);\n\t\t\t\t}\n\t\t\t\treturn tempstr;\n\t\t\t};\n\n\t\t\tvar _parseFriend = function _parseFriend(queryTag, conn, from) {\n\t\t\t\tvar rouster = [];\n\t\t\t\tvar items = queryTag.getElementsByTagName('item');\n\t\t\t\tif (items) {\n\t\t\t\t\tfor (var i = 0; i < items.length; i++) {\n\t\t\t\t\t\tvar item = items[i];\n\t\t\t\t\t\tvar jid = item.getAttribute('jid');\n\t\t\t\t\t\tif (!jid) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar subscription = item.getAttribute('subscription');\n\t\t\t\t\t\tvar friend = {\n\t\t\t\t\t\t\tsubscription: subscription,\n\t\t\t\t\t\t\tjid: jid\n\t\t\t\t\t\t};\n\t\t\t\t\t\tvar ask = item.getAttribute('ask');\n\t\t\t\t\t\tif (ask) {\n\t\t\t\t\t\t\tfriend.ask = ask;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar name = item.getAttribute('name');\n\t\t\t\t\t\tif (name) {\n\t\t\t\t\t\t\tfriend.name = name;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar n = _parseNameFromJidFn(jid);\n\t\t\t\t\t\t\tfriend.name = n;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar groups = [];\n\t\t\t\t\t\tStrophe.forEachChild(item, 'group', function (group) {\n\t\t\t\t\t\t\tgroups.push(Strophe.getText(group));\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfriend.groups = groups;\n\t\t\t\t\t\trouster.push(friend);\n\t\t\t\t\t\t// B同意之后 -> B订阅A\n\t\t\t\t\t\t// fix: 含有ask标示的好友代表已经发送过反向订阅消息，不需要再次发送。\n\t\t\t\t\t\tif (conn && subscription == 'from' && !ask) {\n\t\t\t\t\t\t\tconn.subscribe({\n\t\t\t\t\t\t\t\ttoJid: jid\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (conn && subscription == 'to') {\n\t\t\t\t\t\t\tconn.subscribed({\n\t\t\t\t\t\t\t\ttoJid: jid\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn rouster;\n\t\t\t};\n\n\t\t\tvar _login = function _login(options, conn) {\n\t\t\t\tvar accessToken = options.access_token || '';\n\t\t\t\tif (accessToken == '') {\n\t\t\t\t\tvar loginfo = _utils.stringify(options);\n\t\t\t\t\tconn.onError({\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,\n\t\t\t\t\t\tdata: options\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconn.context.accessToken = options.access_token;\n\t\t\t\tconn.context.accessTokenExpires = options.expires_in;\n\t\t\t\tvar stropheConn = null;\n\t\t\t\tif (conn.isOpening() && conn.context.stropheConn) {\n\t\t\t\t\tstropheConn = conn.context.stropheConn;\n\t\t\t\t} else if (conn.isOpened() && conn.context.stropheConn) {\n\t\t\t\t\t// return;\n\t\t\t\t\tstropheConn = conn.getStrophe();\n\t\t\t\t} else {\n\t\t\t\t\tstropheConn = conn.getStrophe();\n\t\t\t\t}\n\t\t\t\tvar callback = function callback(status, msg) {\n\t\t\t\t\t_loginCallback(status, msg, conn);\n\t\t\t\t};\n\n\t\t\t\t//console.log('jid=', conn.context.jid)\n\t\t\t\tconn.context.stropheConn = stropheConn;\n\t\t\t\tif (conn.route) {\n\t\t\t\t\tstropheConn.connect(conn.context.jid, '$t$' + accessToken, callback, conn.wait, conn.hold, conn.route);\n\t\t\t\t} else {\n\t\t\t\t\tstropheConn.connect(conn.context.jid, '$t$' + accessToken, callback, conn.wait, conn.hold);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tvar _parseMessageType = function _parseMessageType(msginfo) {\n\t\t\t\tvar receiveinfo = msginfo.getElementsByTagName('received'),\n\t\t\t\t    inviteinfo = msginfo.getElementsByTagName('invite'),\n\t\t\t\t    deliveryinfo = msginfo.getElementsByTagName('delivery'),\n\t\t\t\t    acked = msginfo.getElementsByTagName('acked'),\n\t\t\t\t    error = msginfo.getElementsByTagName('error'),\n\t\t\t\t    msgtype = 'normal';\n\t\t\t\tif (receiveinfo && receiveinfo.length > 0 && receiveinfo[0].namespaceURI === 'urn:xmpp:receipts') {\n\n\t\t\t\t\tmsgtype = 'received';\n\t\t\t\t} else if (inviteinfo && inviteinfo.length > 0) {\n\n\t\t\t\t\tmsgtype = 'invite';\n\t\t\t\t} else if (deliveryinfo && deliveryinfo.length > 0) {\n\n\t\t\t\t\tmsgtype = 'delivery'; // 消息送达\n\t\t\t\t} else if (acked && acked.length) {\n\n\t\t\t\t\tmsgtype = 'acked'; // 消息已读\n\t\t\t\t} else if (error && error.length) {\n\n\t\t\t\t\tvar errorItem = error[0],\n\t\t\t\t\t    userMuted = errorItem.getElementsByTagName('user-muted');\n\n\t\t\t\t\tif (userMuted && userMuted.length) {\n\n\t\t\t\t\t\tmsgtype = 'userMuted';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn msgtype;\n\t\t\t};\n\n\t\t\tvar _handleMessageQueue = function _handleMessageQueue(conn) {\n\t\t\t\tfor (var i in _msgHash) {\n\t\t\t\t\tif (_msgHash.hasOwnProperty(i)) {\n\t\t\t\t\t\t_msgHash[i].send(conn);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tvar _loginCallback = function _loginCallback(status, msg, conn) {\n\t\t\t\t// console.log('stropheConn.connected status=', status, msg)\n\t\t\t\tvar conflict, error;\n\n\t\t\t\tif (msg === 'conflict') {\n\t\t\t\t\tconflict = true;\n\t\t\t\t}\n\n\t\t\t\tif (status == Strophe.Status.CONNFAIL) {\n\t\t\t\t\t//client offline, ping/pong timeout, server quit, server offline\n\t\t\t\t\terror = {\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_SERVER_CLOSE_ERROR,\n\t\t\t\t\t\tmsg: msg,\n\t\t\t\t\t\treconnect: true\n\t\t\t\t\t};\n\n\t\t\t\t\tconflict && (error.conflict = true);\n\t\t\t\t\tconn.onError(error);\n\t\t\t\t} else if (status == Strophe.Status.ATTACHED || status == Strophe.Status.CONNECTED) {\n\t\t\t\t\t// client should limit the speed of sending ack messages  up to 5/s\n\t\t\t\t\tconn.autoReconnectNumTotal = 0;\n\t\t\t\t\tconn.intervalId = setInterval(function () {\n\t\t\t\t\t\tconn.handelSendQueue();\n\t\t\t\t\t}, 200);\n\t\t\t\t\tvar handleMessage = function handleMessage(msginfo) {\n\t\t\t\t\t\tvar delivery = msginfo.getElementsByTagName('delivery');\n\t\t\t\t\t\tvar acked = msginfo.getElementsByTagName('acked');\n\t\t\t\t\t\tif (delivery.length) {\n\t\t\t\t\t\t\tconn.handleDeliveredMessage(msginfo);\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (acked.length) {\n\t\t\t\t\t\t\tconn.handleAckedMessage(msginfo);\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar type = _parseMessageType(msginfo);\n\t\t\t\t\t\tswitch (type) {\n\t\t\t\t\t\t\tcase \"received\":\n\t\t\t\t\t\t\t\tconn.handleReceivedMessage(msginfo);\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\tcase \"invite\":\n\t\t\t\t\t\t\t\tconn.handleInviteMessage(msginfo);\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\tcase \"delivery\":\n\t\t\t\t\t\t\t\tconn.handleDeliveredMessage(msginfo);\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\tcase \"acked\":\n\t\t\t\t\t\t\t\tconn.handleAckedMessage(msginfo);\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\tcase \"userMuted\":\n\t\t\t\t\t\t\t\tconn.handleMutedMessage(msginfo);\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\tconn.handleMessage(msginfo);\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tvar handlePresence = function handlePresence(msginfo) {\n\t\t\t\t\t\tconn.handlePresence(msginfo);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t};\n\t\t\t\t\tvar handlePing = function handlePing(msginfo) {\n\t\t\t\t\t\tconn.handlePing(msginfo);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t};\n\t\t\t\t\tvar handleIqRoster = function handleIqRoster(msginfo) {\n\t\t\t\t\t\tconn.handleIqRoster(msginfo);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t};\n\t\t\t\t\tvar handleIqPrivacy = function handleIqPrivacy(msginfo) {\n\t\t\t\t\t\tconn.handleIqPrivacy(msginfo);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t};\n\t\t\t\t\tvar handleIq = function handleIq(msginfo) {\n\t\t\t\t\t\tconn.handleIq(msginfo);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t};\n\n\t\t\t\t\tconn.addHandler(handleMessage, null, 'message', null, null, null);\n\t\t\t\t\tconn.addHandler(handlePresence, null, 'presence', null, null, null);\n\t\t\t\t\tconn.addHandler(handlePing, 'urn:xmpp:ping', 'iq', 'get', null, null);\n\t\t\t\t\tconn.addHandler(handleIqRoster, 'jabber:iq:roster', 'iq', 'set', null, null);\n\t\t\t\t\tconn.addHandler(handleIqPrivacy, 'jabber:iq:privacy', 'iq', 'set', null, null);\n\t\t\t\t\tconn.addHandler(handleIq, null, 'iq', null, null, null);\n\n\t\t\t\t\tconn.registerConfrIQHandler && conn.registerConfrIQHandler();\n\n\t\t\t\t\tconn.context.status = _code.STATUS_OPENED;\n\n\t\t\t\t\tvar supportRecMessage = [_code.WEBIM_MESSAGE_REC_TEXT, _code.WEBIM_MESSAGE_REC_EMOJI];\n\n\t\t\t\t\tif (_utils.isCanDownLoadFile) {\n\t\t\t\t\t\tsupportRecMessage.push(_code.WEBIM_MESSAGE_REC_PHOTO);\n\t\t\t\t\t\tsupportRecMessage.push(_code.WEBIM_MESSAGE_REC_AUDIO_FILE);\n\t\t\t\t\t}\n\t\t\t\t\tvar supportSedMessage = [_code.WEBIM_MESSAGE_SED_TEXT];\n\t\t\t\t\tif (_utils.isCanUploadFile) {\n\t\t\t\t\t\tsupportSedMessage.push(_code.WEBIM_MESSAGE_REC_PHOTO);\n\t\t\t\t\t\tsupportSedMessage.push(_code.WEBIM_MESSAGE_REC_AUDIO_FILE);\n\t\t\t\t\t}\n\t\t\t\t\tconn.notifyVersion();\n\t\t\t\t\tconn.retry && _handleMessageQueue(conn);\n\t\t\t\t\tconn.heartBeat();\n\t\t\t\t\tconn.isAutoLogin && conn.setPresence();\n\t\t\t\t\tconn.onOpened({\n\t\t\t\t\t\tcanReceive: supportRecMessage,\n\t\t\t\t\t\tcanSend: supportSedMessage,\n\t\t\t\t\t\taccessToken: conn.context.accessToken\n\t\t\t\t\t});\n\t\t\t\t} else if (status == Strophe.Status.DISCONNECTING) {\n\t\t\t\t\tif (conn.isOpened()) {\n\t\t\t\t\t\tconn.stopHeartBeat();\n\t\t\t\t\t\tconn.context.status = _code.STATUS_CLOSING;\n\n\t\t\t\t\t\terror = {\n\t\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_SERVER_CLOSE_ERROR,\n\t\t\t\t\t\t\tmsg: msg,\n\t\t\t\t\t\t\treconnect: true\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tconflict && (error.conflict = true);\n\t\t\t\t\t\tconn.onError(error);\n\t\t\t\t\t}\n\t\t\t\t} else if (status == Strophe.Status.DISCONNECTED) {\n\t\t\t\t\tif (conn.isOpened()) {\n\t\t\t\t\t\tif (conn.autoReconnectNumTotal < conn.autoReconnectNumMax) {\n\t\t\t\t\t\t\tconn.reconnect();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\terror = {\n\t\t\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_DISCONNECTED\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tconn.onError(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tconn.context.status = _code.STATUS_CLOSED;\n\t\t\t\t\tconn.clear();\n\t\t\t\t\tconn.onClosed();\n\t\t\t\t} else if (status == Strophe.Status.AUTHFAIL) {\n\t\t\t\t\terror = {\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_AUTH_ERROR\n\t\t\t\t\t};\n\n\t\t\t\t\tconflict && (error.conflict = true);\n\t\t\t\t\tconn.onError(error);\n\t\t\t\t\tconn.clear();\n\t\t\t\t} else if (status == Strophe.Status.ERROR) {\n\t\t\t\t\tconn.context.status = _code.STATUS_ERROR;\n\t\t\t\t\terror = {\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_SERVER_ERROR\n\t\t\t\t\t};\n\n\t\t\t\t\tconflict && (error.conflict = true);\n\t\t\t\t\tconn.onError(error);\n\t\t\t\t}\n\t\t\t\tconn.context.status_now = status;\n\t\t\t};\n\n\t\t\tvar _getJid = function _getJid(options, conn) {\n\t\t\t\tvar jid = options.toJid || '';\n\n\t\t\t\tif (jid === '') {\n\t\t\t\t\tvar appKey = conn.context.appKey || '';\n\t\t\t\t\tvar toJid = appKey + '_' + options.to + '@' + conn.domain;\n\n\t\t\t\t\tif (options.resource) {\n\t\t\t\t\t\ttoJid = toJid + '/' + options.resource;\n\t\t\t\t\t}\n\t\t\t\t\tjid = toJid;\n\t\t\t\t}\n\t\t\t\treturn jid;\n\t\t\t};\n\n\t\t\tvar _getJidByName = function _getJidByName(name, conn) {\n\t\t\t\tvar options = {\n\t\t\t\t\tto: name\n\t\t\t\t};\n\t\t\t\treturn _getJid(options, conn);\n\t\t\t};\n\n\t\t\tvar _validCheck = function _validCheck(options, conn) {\n\t\t\t\toptions = options || {};\n\n\t\t\t\tif (options.user == '') {\n\t\t\t\t\tconn.onError({\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR\n\t\t\t\t\t});\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tvar user = options.user + '' || '';\n\t\t\t\tvar appKey = options.appKey || '';\n\t\t\t\tvar devInfos = appKey.split('#');\n\n\t\t\t\tif (devInfos.length !== 2) {\n\t\t\t\t\tconn.onError({\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR\n\t\t\t\t\t});\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tvar orgName = devInfos[0];\n\t\t\t\tvar appName = devInfos[1];\n\n\t\t\t\tif (!orgName) {\n\t\t\t\t\tconn.onError({\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR\n\t\t\t\t\t});\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (!appName) {\n\t\t\t\t\tconn.onError({\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR\n\t\t\t\t\t});\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tvar jid = appKey + '_' + user.toLowerCase() + '@' + conn.domain,\n\t\t\t\t    resource = options.resource || 'webim';\n\n\t\t\t\tif (conn.isMultiLoginSessions) {\n\t\t\t\t\tresource += user + new Date().getTime() + Math.floor(Math.random().toFixed(6) * 1000000);\n\t\t\t\t}\n\t\t\t\tconn.context.jid = jid + '/' + resource;\n\t\t\t\t/*jid: {appkey}_{username}@domain/resource*/\n\t\t\t\tconn.context.userId = user;\n\t\t\t\tconn.context.appKey = appKey;\n\t\t\t\tconn.context.appName = appName;\n\t\t\t\tconn.context.orgName = orgName;\n\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t\tvar _getXmppUrl = function _getXmppUrl(baseUrl, https) {\n\t\t\t\tif (/^(ws|http)s?:\\/\\/?/.test(baseUrl)) {\n\t\t\t\t\treturn baseUrl;\n\t\t\t\t}\n\n\t\t\t\tvar url = {\n\t\t\t\t\tprefix: 'http',\n\t\t\t\t\tbase: '://' + baseUrl,\n\t\t\t\t\tsuffix: '/http-bind/'\n\t\t\t\t};\n\n\t\t\t\tif (https && _utils.isSupportWss) {\n\t\t\t\t\turl.prefix = 'wss';\n\t\t\t\t\turl.suffix = '/ws/';\n\t\t\t\t} else {\n\t\t\t\t\tif (https) {\n\t\t\t\t\t\turl.prefix = 'https';\n\t\t\t\t\t} else if (window.WebSocket) {\n\t\t\t\t\t\turl.prefix = 'ws';\n\t\t\t\t\t\turl.suffix = '/ws/';\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn url.prefix + url.base + url.suffix;\n\t\t\t};\n\n\t\t\t//class\n\t\t\tvar connection = function connection(options) {\n\t\t\t\tif (!this instanceof connection) {\n\t\t\t\t\treturn new connection(options);\n\t\t\t\t}\n\n\t\t\t\tvar options = options || {};\n\n\t\t\t\tthis.isHttpDNS = options.isHttpDNS || false;\n\t\t\t\tthis.isMultiLoginSessions = options.isMultiLoginSessions || false;\n\t\t\t\tthis.wait = options.wait || 30;\n\t\t\t\tthis.retry = options.retry || false;\n\t\t\t\tthis.https = options.https || location.protocol === 'https:';\n\t\t\t\tthis.url = _getXmppUrl(options.url, this.https);\n\t\t\t\tthis.hold = options.hold || 1;\n\t\t\t\tthis.route = options.route || null;\n\t\t\t\tthis.domain = options.domain || 'easemob.com';\n\t\t\t\tthis.inactivity = options.inactivity || 30;\n\t\t\t\tthis.heartBeatWait = options.heartBeatWait || 4500;\n\t\t\t\tthis.maxRetries = options.maxRetries || 5;\n\t\t\t\tthis.isAutoLogin = options.isAutoLogin === false ? false : true;\n\t\t\t\tthis.pollingTime = options.pollingTime || 800;\n\t\t\t\tthis.stropheConn = false;\n\t\t\t\tthis.autoReconnectNumMax = options.autoReconnectNumMax || 0;\n\t\t\t\tthis.autoReconnectNumTotal = 0;\n\t\t\t\tthis.autoReconnectInterval = options.autoReconnectInterval || 0;\n\t\t\t\tthis.context = { status: _code.STATUS_INIT };\n\t\t\t\tthis.sendQueue = new Queue(); //instead of sending message immediately,cache them in this queue\n\t\t\t\tthis.intervalId = null; //clearInterval return value\n\t\t\t\tthis.apiUrl = options.apiUrl || '';\n\t\t\t\tthis.isWindowSDK = options.isWindowSDK || false;\n\n\t\t\t\tthis.dnsArr = ['https://rs.easemob.com', 'https://rsbak.easemob.com', 'http://182.92.174.78', 'http://112.126.66.111']; //http dns server hosts\n\t\t\t\tthis.dnsIndex = 0; //the dns ip used in dnsArr currently\n\t\t\t\tthis.dnsTotal = this.dnsArr.length; //max number of getting dns retries\n\t\t\t\tthis.restHosts = null; //rest server ips\n\t\t\t\tthis.restIndex = 0; //the rest ip used in restHosts currently\n\t\t\t\tthis.restTotal = 0; //max number of getting rest token retries\n\t\t\t\tthis.xmppHosts = null; //xmpp server ips\n\t\t\t\tthis.xmppIndex = 0; //the xmpp ip used in xmppHosts currently\n\t\t\t\tthis.xmppTotal = 0; //max number of creating xmpp server connection(ws/bosh) retries\n\n\t\t\t\tthis.groupOption = {};\n\t\t\t};\n\n\t\t\tconnection.prototype.registerUser = function (options) {\n\t\t\t\tif (location.protocol != 'https:' && this.isHttpDNS) {\n\t\t\t\t\tthis.dnsIndex = 0;\n\t\t\t\t\tthis.getHttpDNS(options, 'signup');\n\t\t\t\t} else {\n\t\t\t\t\tthis.signup(options);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconnection.prototype.handelSendQueue = function () {\n\t\t\t\tvar options = this.sendQueue.pop();\n\t\t\t\tif (options !== null) {\n\t\t\t\t\tthis.sendReceiptsMessage(options);\n\t\t\t\t}\n\t\t\t};\n\t\t\tconnection.prototype.listen = function (options) {\n\t\t\t\tthis.onOpened = options.onOpened || _utils.emptyfn;\n\t\t\t\tthis.onClosed = options.onClosed || _utils.emptyfn;\n\t\t\t\tthis.onTextMessage = options.onTextMessage || _utils.emptyfn;\n\t\t\t\tthis.onEmojiMessage = options.onEmojiMessage || _utils.emptyfn;\n\t\t\t\tthis.onPictureMessage = options.onPictureMessage || _utils.emptyfn;\n\t\t\t\tthis.onAudioMessage = options.onAudioMessage || _utils.emptyfn;\n\t\t\t\tthis.onVideoMessage = options.onVideoMessage || _utils.emptyfn;\n\t\t\t\tthis.onFileMessage = options.onFileMessage || _utils.emptyfn;\n\t\t\t\tthis.onLocationMessage = options.onLocationMessage || _utils.emptyfn;\n\t\t\t\tthis.onCmdMessage = options.onCmdMessage || _utils.emptyfn;\n\t\t\t\tthis.onPresence = options.onPresence || _utils.emptyfn;\n\t\t\t\tthis.onRoster = options.onRoster || _utils.emptyfn;\n\t\t\t\tthis.onError = options.onError || _utils.emptyfn;\n\t\t\t\tthis.onReceivedMessage = options.onReceivedMessage || _utils.emptyfn;\n\t\t\t\tthis.onInviteMessage = options.onInviteMessage || _utils.emptyfn;\n\t\t\t\tthis.onDeliverdMessage = options.onDeliveredMessage || _utils.emptyfn;\n\t\t\t\tthis.onReadMessage = options.onReadMessage || _utils.emptyfn;\n\t\t\t\tthis.onMutedMessage = options.onMutedMessage || _utils.emptyfn;\n\t\t\t\tthis.onOffline = options.onOffline || _utils.emptyfn;\n\t\t\t\tthis.onOnline = options.onOnline || _utils.emptyfn;\n\t\t\t\tthis.onConfirmPop = options.onConfirmPop || _utils.emptyfn;\n\t\t\t\tthis.onCreateGroup = options.onCreateGroup || _utils.emptyfn;\n\t\t\t\t//for WindowSDK start\n\t\t\t\tthis.onUpdateMyGroupList = options.onUpdateMyGroupList || _utils.emptyfn;\n\t\t\t\tthis.onUpdateMyRoster = options.onUpdateMyRoster || _utils.emptyfn;\n\t\t\t\t//for WindowSDK end\n\t\t\t\tthis.onBlacklistUpdate = options.onBlacklistUpdate || _utils.emptyfn;\n\n\t\t\t\t_listenNetwork(this.onOnline, this.onOffline);\n\t\t\t};\n\n\t\t\t//webrtc需要强制心跳，加个默认为false的参数 向下兼容\n\t\t\tconnection.prototype.heartBeat = function () {\n\t\t\t\tvar forcing = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n\t\t\t\tvar me = this;\n\t\t\t\t//IE8: strophe auto switch from ws to BOSH, need heartbeat\n\t\t\t\tvar isNeed = !/^ws|wss/.test(me.url) || /mobile/.test(navigator.userAgent);\n\n\t\t\t\tif (this.heartBeatID || !forcing && !isNeed) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar options = {\n\t\t\t\t\ttoJid: this.domain,\n\t\t\t\t\ttype: 'normal'\n\t\t\t\t};\n\t\t\t\tthis.heartBeatID = setInterval(function () {\n\t\t\t\t\tme.ping(options);\n\t\t\t\t}, this.heartBeatWait);\n\t\t\t};\n\n\t\t\tconnection.prototype.stopHeartBeat = function () {\n\t\t\t\tif (typeof this.heartBeatID == \"number\") {\n\t\t\t\t\tthis.heartBeatID = clearInterval(this.heartBeatID);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconnection.prototype.sendReceiptsMessage = function (options) {\n\t\t\t\tvar dom = $msg({\n\t\t\t\t\tfrom: this.context.jid || '',\n\t\t\t\t\tto: this.domain,\n\t\t\t\t\tid: options.id || ''\n\t\t\t\t}).c('received', {\n\t\t\t\t\txmlns: 'urn:xmpp:receipts',\n\t\t\t\t\tid: options.id || ''\n\t\t\t\t});\n\t\t\t\tthis.sendCommand(dom.tree());\n\t\t\t};\n\n\t\t\tconnection.prototype.cacheReceiptsMessage = function (options) {\n\t\t\t\tthis.sendQueue.push(options);\n\t\t\t};\n\n\t\t\tconnection.prototype.getStrophe = function () {\n\t\t\t\tif (location.protocol != 'https:' && this.isHttpDNS) {\n\t\t\t\t\t//TODO: try this.xmppTotal times on fail\n\t\t\t\t\tvar url = '';\n\t\t\t\t\tvar host = this.xmppHosts[this.xmppIndex];\n\t\t\t\t\tvar domain = _utils.getXmlFirstChild(host, 'domain');\n\t\t\t\t\tvar ip = _utils.getXmlFirstChild(host, 'ip');\n\t\t\t\t\tif (ip) {\n\t\t\t\t\t\turl = ip.textContent;\n\t\t\t\t\t\tvar port = _utils.getXmlFirstChild(host, 'port');\n\t\t\t\t\t\tif (port.textContent != '80') {\n\t\t\t\t\t\t\turl += ':' + port.textContent;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\turl = domain.textContent;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (url != '') {\n\t\t\t\t\t\tvar parter = /(.+\\/\\/).+(\\/.+)/;\n\t\t\t\t\t\tthis.url = this.url.replace(parter, \"$1\" + url + \"$2\");\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar stropheConn = new Strophe.Connection(this.url, {\n\t\t\t\t\tinactivity: this.inactivity,\n\t\t\t\t\tmaxRetries: this.maxRetries,\n\t\t\t\t\tpollingTime: this.pollingTime\n\t\t\t\t});\n\t\t\t\treturn stropheConn;\n\t\t\t};\n\t\t\tconnection.prototype.getHostsByTag = function (data, tagName) {\n\t\t\t\tvar tag = _utils.getXmlFirstChild(data, tagName);\n\t\t\t\tif (!tag) {\n\t\t\t\t\tconsole.log(tagName + ' hosts error');\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\tvar hosts = tag.getElementsByTagName('hosts');\n\t\t\t\tif (hosts.length == 0) {\n\t\t\t\t\tconsole.log(tagName + ' hosts error2');\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\treturn hosts[0].getElementsByTagName('host');\n\t\t\t};\n\t\t\tconnection.prototype.getRestFromHttpDNS = function (options, type) {\n\t\t\t\tif (this.restIndex > this.restTotal) {\n\t\t\t\t\tconsole.log('rest hosts all tried,quit');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar url = '';\n\t\t\t\tvar host = this.restHosts[this.restIndex];\n\t\t\t\tvar domain = _utils.getXmlFirstChild(host, 'domain');\n\t\t\t\tvar ip = _utils.getXmlFirstChild(host, 'ip');\n\t\t\t\tif (ip) {\n\t\t\t\t\tvar port = _utils.getXmlFirstChild(host, 'port');\n\t\t\t\t\turl = (location.protocol === 'https:' ? 'https:' : 'http:') + '//' + ip.textContent + ':' + port.textContent;\n\t\t\t\t} else {\n\t\t\t\t\turl = (location.protocol === 'https:' ? 'https:' : 'http:') + '//' + domain.textContent;\n\t\t\t\t}\n\n\t\t\t\tif (url != '') {\n\t\t\t\t\tthis.apiUrl = url;\n\t\t\t\t\toptions.apiUrl = url;\n\t\t\t\t}\n\n\t\t\t\tif (type == 'login') {\n\t\t\t\t\tthis.login(options);\n\t\t\t\t} else {\n\t\t\t\t\tthis.signup(options);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconnection.prototype.getHttpDNS = function (options, type) {\n\t\t\t\tif (this.restHosts) {\n\t\t\t\t\tthis.getRestFromHttpDNS(options, type);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar self = this;\n\t\t\t\tvar suc = function suc(data, xhr) {\n\t\t\t\t\tdata = new DOMParser().parseFromString(data, \"text/xml\").documentElement;\n\t\t\t\t\t//get rest ips\n\t\t\t\t\tvar restHosts = self.getHostsByTag(data, 'rest');\n\t\t\t\t\tif (!restHosts) {\n\t\t\t\t\t\tconsole.log('rest hosts error3');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tself.restHosts = restHosts;\n\t\t\t\t\tself.restTotal = restHosts.length;\n\n\t\t\t\t\t//get xmpp ips\n\t\t\t\t\tvar xmppHosts = self.getHostsByTag(data, 'xmpp');\n\t\t\t\t\tif (!xmppHosts) {\n\t\t\t\t\t\tconsole.log('xmpp hosts error3');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tself.xmppHosts = xmppHosts;\n\t\t\t\t\tself.xmppTotal = xmppHosts.length;\n\n\t\t\t\t\tself.getRestFromHttpDNS(options, type);\n\t\t\t\t};\n\t\t\t\tvar error = function error(res, xhr, msg) {\n\n\t\t\t\t\tconsole.log('getHttpDNS error', res, msg);\n\t\t\t\t\tself.dnsIndex++;\n\t\t\t\t\tif (self.dnsIndex < self.dnsTotal) {\n\t\t\t\t\t\tself.getHttpDNS(options, type);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tvar options2 = {\n\t\t\t\t\turl: this.dnsArr[this.dnsIndex] + '/easemob/server.xml',\n\t\t\t\t\tdataType: 'text',\n\t\t\t\t\ttype: 'GET',\n\n\t\t\t\t\t// url: 'http://www.easemob.com/easemob/server.xml',\n\t\t\t\t\t// dataType: 'xml',\n\t\t\t\t\tdata: { app_key: encodeURIComponent(options.appKey) },\n\t\t\t\t\tsuccess: suc || _utils.emptyfn,\n\t\t\t\t\terror: error || _utils.emptyfn\n\t\t\t\t};\n\t\t\t\t_utils.ajax(options2);\n\t\t\t};\n\n\t\t\tconnection.prototype.signup = function (options) {\n\t\t\t\tvar self = this;\n\t\t\t\tvar orgName = options.orgName || '';\n\t\t\t\tvar appName = options.appName || '';\n\t\t\t\tvar appKey = options.appKey || '';\n\t\t\t\tvar suc = options.success || EMPTYFN;\n\t\t\t\tvar err = options.error || EMPTYFN;\n\n\t\t\t\tif (!orgName && !appName && appKey) {\n\t\t\t\t\tvar devInfos = appKey.split('#');\n\t\t\t\t\tif (devInfos.length === 2) {\n\t\t\t\t\t\torgName = devInfos[0];\n\t\t\t\t\t\tappName = devInfos[1];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!orgName && !appName) {\n\t\t\t\t\terr({\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar error = function error(res, xhr, msg) {\n\t\t\t\t\tif (location.protocol != 'https:' && self.isHttpDNS) {\n\t\t\t\t\t\tif (self.restIndex + 1 < self.restTotal) {\n\t\t\t\t\t\t\tself.restIndex++;\n\t\t\t\t\t\t\tself.getRestFromHttpDNS(options, 'signup');\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tself.clear();\n\t\t\t\t\terr(res);\n\t\t\t\t};\n\t\t\t\tvar https = options.https || https;\n\t\t\t\tvar apiUrl = options.apiUrl;\n\t\t\t\tvar restUrl = apiUrl + '/' + orgName + '/' + appName + '/users';\n\n\t\t\t\tvar userjson = {\n\t\t\t\t\tusername: options.username,\n\t\t\t\t\tpassword: options.password,\n\t\t\t\t\tnickname: options.nickname || ''\n\t\t\t\t};\n\n\t\t\t\tvar userinfo = _utils.stringify(userjson);\n\t\t\t\tvar options2 = {\n\t\t\t\t\turl: restUrl,\n\t\t\t\t\tdataType: 'json',\n\t\t\t\t\tdata: userinfo,\n\t\t\t\t\tsuccess: suc,\n\t\t\t\t\terror: error\n\t\t\t\t};\n\t\t\t\t_utils.ajax(options2);\n\t\t\t};\n\n\t\t\tconnection.prototype.open = function (options) {\n\t\t\t\tif (options.xmppURL) {\n\t\t\t\t\tthis.url = _getXmppUrl(options.xmppURL, this.https);\n\t\t\t\t}\n\t\t\t\tif (location.protocol != 'https:' && this.isHttpDNS) {\n\t\t\t\t\tthis.dnsIndex = 0;\n\t\t\t\t\tthis.getHttpDNS(options, 'login');\n\t\t\t\t} else {\n\t\t\t\t\tthis.login(options);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconnection.prototype.login = function (options) {\n\t\t\t\tvar pass = _validCheck(options, this);\n\n\t\t\t\tif (!pass) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar conn = this;\n\n\t\t\t\tif (conn.isOpened()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (options.accessToken) {\n\t\t\t\t\toptions.access_token = options.accessToken;\n\t\t\t\t\tconn.context.restTokenData = options;\n\t\t\t\t\t_login(options, conn);\n\t\t\t\t} else {\n\t\t\t\t\tvar apiUrl = options.apiUrl;\n\t\t\t\t\tvar userId = this.context.userId;\n\t\t\t\t\tvar pwd = options.pwd || '';\n\t\t\t\t\tvar appName = this.context.appName;\n\t\t\t\t\tvar orgName = this.context.orgName;\n\n\t\t\t\t\tvar suc = function suc(data, xhr) {\n\t\t\t\t\t\tconn.context.status = _code.STATUS_DOLOGIN_IM;\n\t\t\t\t\t\tconn.context.restTokenData = data;\n\t\t\t\t\t\tif (options.success) options.success(data);\n\t\t\t\t\t\t_login(data, conn);\n\t\t\t\t\t};\n\t\t\t\t\tvar error = function error(res, xhr, msg) {\n\t\t\t\t\t\tif (options.error) options.error();\n\t\t\t\t\t\tif (location.protocol != 'https:' && conn.isHttpDNS) {\n\t\t\t\t\t\t\tif (conn.restIndex + 1 < conn.restTotal) {\n\t\t\t\t\t\t\t\tconn.restIndex++;\n\t\t\t\t\t\t\t\tconn.getRestFromHttpDNS(options, 'login');\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconn.clear();\n\t\t\t\t\t\tif (res.error && res.error_description) {\n\t\t\t\t\t\t\tconn.onError({\n\t\t\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,\n\t\t\t\t\t\t\t\tdata: res,\n\t\t\t\t\t\t\t\txhr: xhr\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconn.onError({\n\t\t\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_OPEN_ERROR,\n\t\t\t\t\t\t\t\tdata: res,\n\t\t\t\t\t\t\t\txhr: xhr\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.context.status = _code.STATUS_DOLOGIN_USERGRID;\n\n\t\t\t\t\tvar loginJson = {\n\t\t\t\t\t\tgrant_type: 'password',\n\t\t\t\t\t\tusername: userId,\n\t\t\t\t\t\tpassword: pwd,\n\t\t\t\t\t\ttimestamp: +new Date()\n\t\t\t\t\t};\n\t\t\t\t\tvar loginfo = _utils.stringify(loginJson);\n\n\t\t\t\t\tvar options2 = {\n\t\t\t\t\t\turl: apiUrl + '/' + orgName + '/' + appName + '/token',\n\t\t\t\t\t\tdataType: 'json',\n\t\t\t\t\t\tdata: loginfo,\n\t\t\t\t\t\tsuccess: suc || _utils.emptyfn,\n\t\t\t\t\t\terror: error || _utils.emptyfn\n\t\t\t\t\t};\n\t\t\t\t\t_utils.ajax(options2);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// attach to xmpp server for BOSH\n\t\t\tconnection.prototype.attach = function (options) {\n\t\t\t\tvar pass = _validCheck(options, this);\n\n\t\t\t\tif (!pass) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\toptions = options || {};\n\n\t\t\t\tvar accessToken = options.accessToken || '';\n\t\t\t\tif (accessToken == '') {\n\t\t\t\t\tthis.onError({\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar sid = options.sid || '';\n\t\t\t\tif (sid === '') {\n\t\t\t\t\tthis.onError({\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar rid = options.rid || '';\n\t\t\t\tif (rid === '') {\n\t\t\t\t\tthis.onError({\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar stropheConn = this.getStrophe();\n\n\t\t\t\tthis.context.accessToken = accessToken;\n\t\t\t\tthis.context.stropheConn = stropheConn;\n\t\t\t\tthis.context.status = _code.STATUS_DOLOGIN_IM;\n\n\t\t\t\tvar conn = this;\n\t\t\t\tvar callback = function callback(status, msg) {\n\t\t\t\t\t_loginCallback(status, msg, conn);\n\t\t\t\t};\n\n\t\t\t\tvar jid = this.context.jid;\n\t\t\t\tvar wait = this.wait;\n\t\t\t\tvar hold = this.hold;\n\t\t\t\tvar wind = this.wind || 5;\n\t\t\t\tstropheConn.attach(jid, sid, rid, callback, wait, hold, wind);\n\t\t\t};\n\n\t\t\tconnection.prototype.close = function (reason) {\n\t\t\t\tthis.stopHeartBeat();\n\n\t\t\t\tvar status = this.context.status;\n\t\t\t\tif (status == _code.STATUS_INIT) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.isClosed() || this.isClosing()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.context.status = _code.STATUS_CLOSING;\n\t\t\t\tthis.context.stropheConn.disconnect(reason);\n\t\t\t};\n\n\t\t\tconnection.prototype.addHandler = function (handler, ns, name, type, id, from, options) {\n\t\t\t\tthis.context.stropheConn.addHandler(handler, ns, name, type, id, from, options);\n\t\t\t};\n\n\t\t\tconnection.prototype.notifyVersion = function (suc, fail) {\n\t\t\t\tvar jid = _getJid({}, this);\n\t\t\t\tvar dom = $iq({\n\t\t\t\t\tfrom: this.context.jid || '',\n\t\t\t\t\tto: this.domain,\n\t\t\t\t\ttype: 'result'\n\t\t\t\t}).c('query', { xmlns: 'jabber:iq:version' }).c('name').t('easemob').up().c('version').t(_version).up().c('os').t('webim');\n\n\t\t\t\tvar suc = suc || _utils.emptyfn;\n\t\t\t\tvar error = fail || this.onError;\n\t\t\t\tvar failFn = function failFn(ele) {\n\t\t\t\t\terror({\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_NOTIFYVERSION_ERROR,\n\t\t\t\t\t\tdata: ele\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t\tthis.context.stropheConn.sendIQ(dom.tree(), suc, failFn);\n\t\t\t\treturn;\n\t\t\t};\n\n\t\t\t// handle all types of presence message\n\t\t\tconnection.prototype.handlePresence = function (msginfo) {\n\t\t\t\tif (this.isClosed()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar from = msginfo.getAttribute('from') || '';\n\t\t\t\tvar to = msginfo.getAttribute('to') || '';\n\t\t\t\tvar type = msginfo.getAttribute('type') || '';\n\t\t\t\tvar presence_type = msginfo.getAttribute('presence_type') || '';\n\t\t\t\tvar fromUser = _parseNameFromJidFn(from);\n\t\t\t\tvar toUser = _parseNameFromJidFn(to);\n\t\t\t\tvar isCreate = false;\n\t\t\t\tvar isMemberJoin = false;\n\t\t\t\tvar isDecline = false;\n\t\t\t\tvar isApply = false;\n\t\t\t\tvar info = {\n\t\t\t\t\tfrom: fromUser,\n\t\t\t\t\tto: toUser,\n\t\t\t\t\tfromJid: from,\n\t\t\t\t\ttoJid: to,\n\t\t\t\t\ttype: type,\n\t\t\t\t\tchatroom: msginfo.getElementsByTagName('roomtype').length ? true : false\n\t\t\t\t};\n\n\t\t\t\tvar showTags = msginfo.getElementsByTagName('show');\n\t\t\t\tif (showTags && showTags.length > 0) {\n\t\t\t\t\tvar showTag = showTags[0];\n\t\t\t\t\tinfo.show = Strophe.getText(showTag);\n\t\t\t\t}\n\t\t\t\tvar statusTags = msginfo.getElementsByTagName('status');\n\t\t\t\tif (statusTags && statusTags.length > 0) {\n\t\t\t\t\tvar statusTag = statusTags[0];\n\t\t\t\t\tinfo.status = Strophe.getText(statusTag);\n\t\t\t\t\tinfo.code = statusTag.getAttribute('code');\n\t\t\t\t}\n\n\t\t\t\tvar priorityTags = msginfo.getElementsByTagName('priority');\n\t\t\t\tif (priorityTags && priorityTags.length > 0) {\n\t\t\t\t\tvar priorityTag = priorityTags[0];\n\t\t\t\t\tinfo.priority = Strophe.getText(priorityTag);\n\t\t\t\t}\n\n\t\t\t\tvar error = msginfo.getElementsByTagName('error');\n\t\t\t\tif (error && error.length > 0) {\n\t\t\t\t\tvar error = error[0];\n\t\t\t\t\tinfo.error = {\n\t\t\t\t\t\tcode: error.getAttribute('code')\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tvar destroy = msginfo.getElementsByTagName('destroy');\n\t\t\t\tif (destroy && destroy.length > 0) {\n\t\t\t\t\tvar destroy = destroy[0];\n\t\t\t\t\tinfo.destroy = true;\n\n\t\t\t\t\tvar reason = destroy.getElementsByTagName('reason');\n\t\t\t\t\tif (reason && reason.length > 0) {\n\t\t\t\t\t\tinfo.reason = Strophe.getText(reason[0]);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar members = msginfo.getElementsByTagName('item');\n\t\t\t\tif (members && members.length > 0) {\n\t\t\t\t\tvar member = members[0];\n\t\t\t\t\tvar role = member.getAttribute('role');\n\t\t\t\t\tvar jid = member.getAttribute('jid');\n\t\t\t\t\tvar affiliation = member.getAttribute('affiliation');\n\t\t\t\t\t// dismissed by group\n\t\t\t\t\tif (role == 'none' && jid) {\n\t\t\t\t\t\tvar kickedMember = _parseNameFromJidFn(jid);\n\t\t\t\t\t\tvar actor = member.getElementsByTagName('actor')[0];\n\t\t\t\t\t\tvar actorNick = actor.getAttribute('nick');\n\t\t\t\t\t\tinfo.actor = actorNick;\n\t\t\t\t\t\tinfo.kicked = kickedMember;\n\t\t\t\t\t}\n\t\t\t\t\t// Service Acknowledges Room Creation `createGroupACK`\n\t\t\t\t\tif (role == 'moderator' && info.code == '201') {\n\t\t\t\t\t\tif (affiliation === 'owner') {\n\t\t\t\t\t\t\tinfo.type = 'createGroupACK';\n\t\t\t\t\t\t\tisCreate = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// else\n\t\t\t\t\t\t//     info.type = 'joinPublicGroupSuccess';\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar x = msginfo.getElementsByTagName('x');\n\t\t\t\tif (x && x.length > 0) {\n\t\t\t\t\t// 加群申请\n\t\t\t\t\tvar apply = x[0].getElementsByTagName('apply');\n\t\t\t\t\t// 加群成功\n\t\t\t\t\tvar accept = x[0].getElementsByTagName('accept');\n\t\t\t\t\t// 同意加群后用户进群通知\n\t\t\t\t\tvar item = x[0].getElementsByTagName('item');\n\t\t\t\t\t// 加群被拒绝\n\t\t\t\t\tvar decline = x[0].getElementsByTagName('decline');\n\t\t\t\t\t// console.log('ScareCrow: ', decline, decline.length);\n\n\t\t\t\t\tif (apply && apply.length > 0) {\n\t\t\t\t\t\tisApply = true;\n\t\t\t\t\t\tinfo.toNick = apply[0].getAttribute('toNick');\n\t\t\t\t\t\tinfo.type = 'joinGroupNotifications';\n\t\t\t\t\t\tvar groupJid = apply[0].getAttribute('to');\n\t\t\t\t\t\tvar gid = groupJid.split('@')[0].split('_');\n\t\t\t\t\t\tgid = gid[gid.length - 1];\n\t\t\t\t\t\tinfo.gid = gid;\n\t\t\t\t\t} else if (accept && accept.length > 0) {\n\t\t\t\t\t\tinfo.type = 'joinPublicGroupSuccess';\n\t\t\t\t\t} else if (item && item.length > 0) {\n\t\t\t\t\t\tvar affiliation = item[0].getAttribute('affiliation'),\n\t\t\t\t\t\t    role = item[0].getAttribute('role');\n\t\t\t\t\t\tif (affiliation == 'member' || role == 'participant') {\n\t\t\t\t\t\t\tisMemberJoin = true;\n\t\t\t\t\t\t\tinfo.mid = info.fromJid.split('/');\n\t\t\t\t\t\t\tinfo.mid = info.mid[info.mid.length - 1];\n\t\t\t\t\t\t\tinfo.type = 'memberJoinPublicGroupSuccess';\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (decline && decline.length) {\n\t\t\t\t\t\tisDecline = true;\n\t\t\t\t\t\tvar gid = decline[0].getAttribute(\"fromNick\");\n\t\t\t\t\t\tvar owner = _parseNameFromJidFn(decline[0].getAttribute(\"from\"));\n\t\t\t\t\t\tinfo.type = \"joinPublicGroupDeclined\";\n\t\t\t\t\t\tinfo.owner = owner;\n\t\t\t\t\t\tinfo.gid = gid;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (info.chatroom) {\n\t\t\t\t\t// diff the\n\t\t\t\t\tinfo.presence_type = presence_type;\n\t\t\t\t\tinfo.original_type = info.type;\n\t\t\t\t\tvar reflectUser = from.slice(from.lastIndexOf('/') + 1);\n\n\t\t\t\t\tif (reflectUser === this.context.userId) {\n\t\t\t\t\t\tif (info.type === '' && !info.code) {\n\t\t\t\t\t\t\tinfo.type = 'joinChatRoomSuccess';\n\t\t\t\t\t\t} else if (presence_type === 'unavailable' || info.type === 'unavailable') {\n\t\t\t\t\t\t\tif (!info.status) {\n\t\t\t\t\t\t\t\t// logout successfully.\n\t\t\t\t\t\t\t\tinfo.type = 'leaveChatRoom';\n\t\t\t\t\t\t\t} else if (info.code == 110) {\n\t\t\t\t\t\t\t\t// logout or dismissied by admin.\n\t\t\t\t\t\t\t\tinfo.type = 'leaveChatRoom';\n\t\t\t\t\t\t\t} else if (info.error && info.error.code == 406) {\n\t\t\t\t\t\t\t\t// The chat room is full.\n\t\t\t\t\t\t\t\tinfo.type = 'reachChatRoomCapacity';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tinfo.presence_type = presence_type;\n\t\t\t\t\tinfo.original_type = type;\n\n\t\t\t\t\tif (/subscribe/.test(info.type)) {\n\t\t\t\t\t\t//subscribe | subscribed | unsubscribe | unsubscribed\n\t\t\t\t\t} else if (type == \"\" && !info.status && !info.error && !isCreate && !isApply && !isMemberJoin && !isDecline) {\n\t\t\t\t\t\t//console.log(2222222, msginfo, info, isApply);\n\t\t\t\t\t\tinfo.type = 'joinPublicGroupSuccess';\n\t\t\t\t\t} else if (presence_type === 'unavailable' || type === 'unavailable') {\n\t\t\t\t\t\t// There is no roomtype when a chat room is deleted.\n\t\t\t\t\t\tif (info.destroy) {\n\t\t\t\t\t\t\t// Group or Chat room Deleted.\n\t\t\t\t\t\t\tinfo.type = 'deleteGroupChat';\n\t\t\t\t\t\t} else if (info.code == 307 || info.code == 321) {\n\t\t\t\t\t\t\t// Dismissed by group.\n\t\t\t\t\t\t\tvar nick = msginfo.getAttribute('nick');\n\t\t\t\t\t\t\tif (!nick) info.type = 'leaveGroup';else info.type = 'removedFromGroup';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.onPresence(info, msginfo);\n\t\t\t};\n\n\t\t\tconnection.prototype.handlePing = function (e) {\n\t\t\t\tif (this.isClosed()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar id = e.getAttribute('id');\n\t\t\t\tvar from = e.getAttribute('from');\n\t\t\t\tvar to = e.getAttribute('to');\n\t\t\t\tvar dom = $iq({\n\t\t\t\t\tfrom: to,\n\t\t\t\t\tto: from,\n\t\t\t\t\tid: id,\n\t\t\t\t\ttype: 'result'\n\t\t\t\t});\n\t\t\t\tthis.sendCommand(dom.tree());\n\t\t\t};\n\n\t\t\tconnection.prototype.handleIq = function (iq) {\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t\tconnection.prototype.handleIqPrivacy = function (msginfo) {\n\t\t\t\tvar list = msginfo.getElementsByTagName('list');\n\t\t\t\tif (list.length == 0) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.getBlacklist();\n\t\t\t};\n\n\t\t\tconnection.prototype.handleIqRoster = function (e) {\n\t\t\t\tvar id = e.getAttribute('id');\n\t\t\t\tvar from = e.getAttribute('from') || '';\n\t\t\t\tvar name = _parseNameFromJidFn(from);\n\t\t\t\tvar curJid = this.context.jid;\n\t\t\t\tvar curUser = this.context.userId;\n\n\t\t\t\tvar iqresult = $iq({ type: 'result', id: id, from: curJid });\n\t\t\t\tthis.sendCommand(iqresult.tree());\n\n\t\t\t\tvar msgBodies = e.getElementsByTagName('query');\n\t\t\t\tif (msgBodies && msgBodies.length > 0) {\n\t\t\t\t\tvar queryTag = msgBodies[0];\n\t\t\t\t\tvar rouster = _parseFriend(queryTag, this, from);\n\t\t\t\t\tthis.onRoster(rouster);\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t\tconnection.prototype.handleMessage = function (msginfo) {\n\t\t\t\tvar self = this;\n\t\t\t\tif (this.isClosed()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar id = msginfo.getAttribute('id') || '';\n\n\t\t\t\t// cache ack into sendQueue first , handelSendQueue will do the send thing with the speed of  5/s\n\t\t\t\tthis.cacheReceiptsMessage({\n\t\t\t\t\tid: id\n\t\t\t\t});\n\t\t\t\tvar parseMsgData = _parseResponseMessage(msginfo);\n\t\t\t\tif (parseMsgData.errorMsg) {\n\t\t\t\t\tthis.handlePresence(msginfo);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// send error\n\t\t\t\tvar error = msginfo.getElementsByTagName('error');\n\t\t\t\tvar errorCode = '';\n\t\t\t\tvar errorText = '';\n\t\t\t\tvar errorBool = false;\n\t\t\t\tif (error.length > 0) {\n\t\t\t\t\terrorBool = true;\n\t\t\t\t\terrorCode = error[0].getAttribute('code');\n\t\t\t\t\tvar textDOM = error[0].getElementsByTagName('text');\n\t\t\t\t\terrorText = textDOM[0].textContent || textDOM[0].text;\n\t\t\t\t}\n\n\t\t\t\tvar msgDatas = parseMsgData.data;\n\t\t\t\tfor (var i in msgDatas) {\n\t\t\t\t\tif (!msgDatas.hasOwnProperty(i)) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tvar msg = msgDatas[i];\n\t\t\t\t\tif (!msg.from || !msg.to) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar from = (msg.from + '').toLowerCase();\n\t\t\t\t\tvar too = (msg.to + '').toLowerCase();\n\t\t\t\t\tvar extmsg = msg.ext || {};\n\t\t\t\t\tvar chattype = '';\n\t\t\t\t\tvar typeEl = msginfo.getElementsByTagName('roomtype');\n\t\t\t\t\tif (typeEl.length) {\n\t\t\t\t\t\tchattype = typeEl[0].getAttribute('type') || 'chat';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tchattype = msginfo.getAttribute('type') || 'chat';\n\t\t\t\t\t}\n\n\t\t\t\t\tvar msgBodies = msg.bodies;\n\t\t\t\t\tif (!msgBodies || msgBodies.length == 0) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tvar msgBody = msg.bodies[0];\n\t\t\t\t\tvar type = msgBody.type;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tswitch (type) {\n\t\t\t\t\t\t\tcase 'txt':\n\t\t\t\t\t\t\t\tvar receiveMsg = msgBody.msg;\n\t\t\t\t\t\t\t\tvar emojibody = _utils.parseTextMessage(receiveMsg, WebIM.Emoji);\n\t\t\t\t\t\t\t\tif (emojibody.isemoji) {\n\t\t\t\t\t\t\t\t\tvar msg = {\n\t\t\t\t\t\t\t\t\t\tid: id,\n\t\t\t\t\t\t\t\t\t\ttype: chattype,\n\t\t\t\t\t\t\t\t\t\tfrom: from,\n\t\t\t\t\t\t\t\t\t\tto: too,\n\t\t\t\t\t\t\t\t\t\tdelay: parseMsgData.delayTimeStamp,\n\t\t\t\t\t\t\t\t\t\tdata: emojibody.body,\n\t\t\t\t\t\t\t\t\t\text: extmsg\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t!msg.delay && delete msg.delay;\n\t\t\t\t\t\t\t\t\tmsg.error = errorBool;\n\t\t\t\t\t\t\t\t\tmsg.errorText = errorText;\n\t\t\t\t\t\t\t\t\tmsg.errorCode = errorCode;\n\t\t\t\t\t\t\t\t\tthis.onEmojiMessage(msg);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tvar msg = {\n\t\t\t\t\t\t\t\t\t\tid: id,\n\t\t\t\t\t\t\t\t\t\ttype: chattype,\n\t\t\t\t\t\t\t\t\t\tfrom: from,\n\t\t\t\t\t\t\t\t\t\tto: too,\n\t\t\t\t\t\t\t\t\t\tdelay: parseMsgData.delayTimeStamp,\n\t\t\t\t\t\t\t\t\t\tdata: receiveMsg,\n\t\t\t\t\t\t\t\t\t\text: extmsg\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t!msg.delay && delete msg.delay;\n\t\t\t\t\t\t\t\t\tmsg.error = errorBool;\n\t\t\t\t\t\t\t\t\tmsg.errorText = errorText;\n\t\t\t\t\t\t\t\t\tmsg.errorCode = errorCode;\n\t\t\t\t\t\t\t\t\tthis.onTextMessage(msg);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'img':\n\t\t\t\t\t\t\t\tvar rwidth = 0;\n\t\t\t\t\t\t\t\tvar rheight = 0;\n\t\t\t\t\t\t\t\tif (msgBody.size) {\n\t\t\t\t\t\t\t\t\trwidth = msgBody.size.width;\n\t\t\t\t\t\t\t\t\trheight = msgBody.size.height;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tvar msg = {\n\t\t\t\t\t\t\t\t\tid: id,\n\t\t\t\t\t\t\t\t\ttype: chattype,\n\t\t\t\t\t\t\t\t\tfrom: from,\n\t\t\t\t\t\t\t\t\tto: too,\n\n\t\t\t\t\t\t\t\t\turl: location.protocol != 'https:' && self.isHttpDNS ? self.apiUrl + msgBody.url.substr(msgBody.url.indexOf(\"/\", 9)) : msgBody.url,\n\t\t\t\t\t\t\t\t\tsecret: msgBody.secret,\n\t\t\t\t\t\t\t\t\tfilename: msgBody.filename,\n\t\t\t\t\t\t\t\t\tthumb: msgBody.thumb,\n\t\t\t\t\t\t\t\t\tthumb_secret: msgBody.thumb_secret,\n\t\t\t\t\t\t\t\t\tfile_length: msgBody.file_length || '',\n\t\t\t\t\t\t\t\t\twidth: rwidth,\n\t\t\t\t\t\t\t\t\theight: rheight,\n\t\t\t\t\t\t\t\t\tfiletype: msgBody.filetype || '',\n\t\t\t\t\t\t\t\t\taccessToken: this.context.accessToken || '',\n\t\t\t\t\t\t\t\t\text: extmsg,\n\t\t\t\t\t\t\t\t\tdelay: parseMsgData.delayTimeStamp\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t!msg.delay && delete msg.delay;\n\t\t\t\t\t\t\t\tmsg.error = errorBool;\n\t\t\t\t\t\t\t\tmsg.errorText = errorText;\n\t\t\t\t\t\t\t\tmsg.errorCode = errorCode;\n\t\t\t\t\t\t\t\tthis.onPictureMessage(msg);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'audio':\n\t\t\t\t\t\t\t\tvar msg = {\n\t\t\t\t\t\t\t\t\tid: id,\n\t\t\t\t\t\t\t\t\ttype: chattype,\n\t\t\t\t\t\t\t\t\tfrom: from,\n\t\t\t\t\t\t\t\t\tto: too,\n\n\t\t\t\t\t\t\t\t\turl: location.protocol != 'https:' && self.isHttpDNS ? self.apiUrl + msgBody.url.substr(msgBody.url.indexOf(\"/\", 9)) : msgBody.url,\n\t\t\t\t\t\t\t\t\tsecret: msgBody.secret,\n\t\t\t\t\t\t\t\t\tfilename: msgBody.filename,\n\t\t\t\t\t\t\t\t\tlength: msgBody.length || '',\n\t\t\t\t\t\t\t\t\tfile_length: msgBody.file_length || '',\n\t\t\t\t\t\t\t\t\tfiletype: msgBody.filetype || '',\n\t\t\t\t\t\t\t\t\taccessToken: this.context.accessToken || '',\n\t\t\t\t\t\t\t\t\text: extmsg,\n\t\t\t\t\t\t\t\t\tdelay: parseMsgData.delayTimeStamp\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t!msg.delay && delete msg.delay;\n\t\t\t\t\t\t\t\tmsg.error = errorBool;\n\t\t\t\t\t\t\t\tmsg.errorText = errorText;\n\t\t\t\t\t\t\t\tmsg.errorCode = errorCode;\n\t\t\t\t\t\t\t\tthis.onAudioMessage(msg);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'file':\n\t\t\t\t\t\t\t\tvar msg = {\n\t\t\t\t\t\t\t\t\tid: id,\n\t\t\t\t\t\t\t\t\ttype: chattype,\n\t\t\t\t\t\t\t\t\tfrom: from,\n\t\t\t\t\t\t\t\t\tto: too,\n\n\t\t\t\t\t\t\t\t\turl: location.protocol != 'https:' && self.isHttpDNS ? self.apiUrl + msgBody.url.substr(msgBody.url.indexOf(\"/\", 9)) : msgBody.url,\n\t\t\t\t\t\t\t\t\tsecret: msgBody.secret,\n\t\t\t\t\t\t\t\t\tfilename: msgBody.filename,\n\t\t\t\t\t\t\t\t\tfile_length: msgBody.file_length,\n\t\t\t\t\t\t\t\t\taccessToken: this.context.accessToken || '',\n\t\t\t\t\t\t\t\t\text: extmsg,\n\t\t\t\t\t\t\t\t\tdelay: parseMsgData.delayTimeStamp\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t!msg.delay && delete msg.delay;\n\t\t\t\t\t\t\t\tmsg.error = errorBool;\n\t\t\t\t\t\t\t\tmsg.errorText = errorText;\n\t\t\t\t\t\t\t\tmsg.errorCode = errorCode;\n\t\t\t\t\t\t\t\tthis.onFileMessage(msg);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'loc':\n\t\t\t\t\t\t\t\tvar msg = {\n\t\t\t\t\t\t\t\t\tid: id,\n\t\t\t\t\t\t\t\t\ttype: chattype,\n\t\t\t\t\t\t\t\t\tfrom: from,\n\t\t\t\t\t\t\t\t\tto: too,\n\t\t\t\t\t\t\t\t\taddr: msgBody.addr,\n\t\t\t\t\t\t\t\t\tlat: msgBody.lat,\n\t\t\t\t\t\t\t\t\tlng: msgBody.lng,\n\t\t\t\t\t\t\t\t\text: extmsg,\n\t\t\t\t\t\t\t\t\tdelay: parseMsgData.delayTimeStamp\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t!msg.delay && delete msg.delay;\n\t\t\t\t\t\t\t\tmsg.error = errorBool;\n\t\t\t\t\t\t\t\tmsg.errorText = errorText;\n\t\t\t\t\t\t\t\tmsg.errorCode = errorCode;\n\t\t\t\t\t\t\t\tthis.onLocationMessage(msg);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'video':\n\t\t\t\t\t\t\t\tvar msg = {\n\t\t\t\t\t\t\t\t\tid: id,\n\t\t\t\t\t\t\t\t\ttype: chattype,\n\t\t\t\t\t\t\t\t\tfrom: from,\n\t\t\t\t\t\t\t\t\tto: too,\n\n\t\t\t\t\t\t\t\t\turl: location.protocol != 'https:' && self.isHttpDNS ? self.apiUrl + msgBody.url.substr(msgBody.url.indexOf(\"/\", 9)) : msgBody.url,\n\t\t\t\t\t\t\t\t\tsecret: msgBody.secret,\n\t\t\t\t\t\t\t\t\tfilename: msgBody.filename,\n\t\t\t\t\t\t\t\t\tfile_length: msgBody.file_length,\n\t\t\t\t\t\t\t\t\taccessToken: this.context.accessToken || '',\n\t\t\t\t\t\t\t\t\text: extmsg,\n\t\t\t\t\t\t\t\t\tdelay: parseMsgData.delayTimeStamp\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t!msg.delay && delete msg.delay;\n\t\t\t\t\t\t\t\tmsg.error = errorBool;\n\t\t\t\t\t\t\t\tmsg.errorText = errorText;\n\t\t\t\t\t\t\t\tmsg.errorCode = errorCode;\n\t\t\t\t\t\t\t\tthis.onVideoMessage(msg);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'cmd':\n\t\t\t\t\t\t\t\tvar msg = {\n\t\t\t\t\t\t\t\t\tid: id,\n\t\t\t\t\t\t\t\t\tfrom: from,\n\t\t\t\t\t\t\t\t\tto: too,\n\t\t\t\t\t\t\t\t\taction: msgBody.action,\n\t\t\t\t\t\t\t\t\text: extmsg,\n\t\t\t\t\t\t\t\t\tdelay: parseMsgData.delayTimeStamp\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t!msg.delay && delete msg.delay;\n\t\t\t\t\t\t\t\tmsg.error = errorBool;\n\t\t\t\t\t\t\t\tmsg.errorText = errorText;\n\t\t\t\t\t\t\t\tmsg.errorCode = errorCode;\n\t\t\t\t\t\t\t\tthis.onCmdMessage(msg);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t;\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tthis.onError({\n\t\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,\n\t\t\t\t\t\t\tdata: e\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconnection.prototype.handleDeliveredMessage = function (message) {\n\t\t\t\tvar id = message.id;\n\t\t\t\tvar body = message.getElementsByTagName('body');\n\t\t\t\tvar mid = 0;\n\t\t\t\tif (isNaN(body[0].innerHTML)) mid = body[1].innerHTML;else mid = body[0].innerHTML;\n\t\t\t\tvar msg = {\n\t\t\t\t\tmid: mid\n\t\t\t\t};\n\t\t\t\tthis.onDeliverdMessage(msg);\n\t\t\t\tthis.sendReceiptsMessage({\n\t\t\t\t\tid: id\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tconnection.prototype.handleAckedMessage = function (message) {\n\t\t\t\tvar id = message.id;\n\t\t\t\tvar body = message.getElementsByTagName('body');\n\t\t\t\tvar mid = 0;\n\t\t\t\tif (isNaN(body[0].innerHTML)) mid = body[1].innerHTML;else mid = body[0].innerHTML;\n\t\t\t\tvar msg = {\n\t\t\t\t\tmid: mid\n\t\t\t\t};\n\t\t\t\tthis.onReadMessage(msg);\n\t\t\t\tthis.sendReceiptsMessage({\n\t\t\t\t\tid: id\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tconnection.prototype.handleReceivedMessage = function (message) {\n\t\t\t\ttry {\n\t\t\t\t\tvar received = message.getElementsByTagName(\"received\");\n\t\t\t\t\tvar mid = received[0].getAttribute('mid');\n\t\t\t\t\tvar body = message.getElementsByTagName(\"body\");\n\t\t\t\t\tvar id = body[0].innerHTML;\n\t\t\t\t\tvar msg = {\n\t\t\t\t\t\tmid: mid,\n\t\t\t\t\t\tid: id\n\t\t\t\t\t};\n\t\t\t\t\tthis.onReceivedMessage(msg);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthis.onError({\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,\n\t\t\t\t\t\tdata: e\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tvar rcv = message.getElementsByTagName('received'),\n\t\t\t\t    id,\n\t\t\t\t    mid;\n\n\t\t\t\tif (rcv.length > 0) {\n\t\t\t\t\tif (rcv[0].childNodes && rcv[0].childNodes.length > 0) {\n\t\t\t\t\t\tid = rcv[0].childNodes[0].nodeValue;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tid = rcv[0].innerHTML || rcv[0].innerText;\n\t\t\t\t\t}\n\t\t\t\t\tmid = rcv[0].getAttribute('mid');\n\t\t\t\t}\n\n\t\t\t\tif (_msgHash[id]) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\t_msgHash[id].msg.success instanceof Function && _msgHash[id].msg.success(id, mid);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tthis.onError({\n\t\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,\n\t\t\t\t\t\t\tdata: e\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tdelete _msgHash[id];\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconnection.prototype.handleInviteMessage = function (message) {\n\t\t\t\tvar form = null;\n\t\t\t\tvar invitemsg = message.getElementsByTagName('invite');\n\t\t\t\tvar reasonDom = message.getElementsByTagName('reason')[0];\n\t\t\t\tvar reasonMsg = reasonDom.textContent;\n\t\t\t\tvar id = message.getAttribute('id') || '';\n\t\t\t\tthis.sendReceiptsMessage({\n\t\t\t\t\tid: id\n\t\t\t\t});\n\n\t\t\t\tif (invitemsg && invitemsg.length > 0) {\n\t\t\t\t\tvar fromJid = invitemsg[0].getAttribute('from');\n\t\t\t\t\tform = _parseNameFromJidFn(fromJid);\n\t\t\t\t}\n\t\t\t\tvar xmsg = message.getElementsByTagName('x');\n\t\t\t\tvar roomid = null;\n\t\t\t\tif (xmsg && xmsg.length > 0) {\n\t\t\t\t\tfor (var i = 0; i < xmsg.length; i++) {\n\t\t\t\t\t\tif ('jabber:x:conference' === xmsg[i].namespaceURI) {\n\t\t\t\t\t\t\tvar roomjid = xmsg[i].getAttribute('jid');\n\t\t\t\t\t\t\troomid = _parseNameFromJidFn(roomjid);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.onInviteMessage({\n\t\t\t\t\ttype: 'invite',\n\t\t\t\t\tfrom: form,\n\t\t\t\t\troomid: roomid,\n\t\t\t\t\treason: reasonMsg\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tconnection.prototype.handleMutedMessage = function (message) {\n\t\t\t\tvar id = message.id;\n\t\t\t\tthis.onMutedMessage({\n\t\t\t\t\tmid: id\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tconnection.prototype.sendCommand = function (dom, id) {\n\t\t\t\tif (this.isOpened()) {\n\t\t\t\t\tthis.context.stropheConn.send(dom);\n\t\t\t\t} else {\n\t\t\t\t\tthis.onError({\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_DISCONNECTED,\n\t\t\t\t\t\treconnect: true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconnection.prototype.getUniqueId = function (prefix) {\n\t\t\t\t// fix: too frequently msg sending will make same id\n\t\t\t\tif (this.autoIncrement) {\n\t\t\t\t\tthis.autoIncrement++;\n\t\t\t\t} else {\n\t\t\t\t\tthis.autoIncrement = 1;\n\t\t\t\t}\n\t\t\t\tvar cdate = new Date();\n\t\t\t\tvar offdate = new Date(2010, 1, 1);\n\t\t\t\tvar offset = cdate.getTime() - offdate.getTime();\n\t\t\t\tvar hexd = parseFloat(offset).toString(16) + this.autoIncrement;\n\n\t\t\t\tif (typeof prefix === 'string' || typeof prefix === 'number') {\n\t\t\t\t\treturn prefix + '_' + hexd;\n\t\t\t\t} else {\n\t\t\t\t\treturn 'WEBIM_' + hexd;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconnection.prototype.send = function (message) {\n\t\t\t\tvar self = this;\n\t\t\t\tif (this.isWindowSDK) {\n\t\t\t\t\tWebIM.doQuery('{\"type\":\"sendMessage\",\"to\":\"' + message.to + '\",\"message_type\":\"' + message.type + '\",\"msg\":\"' + encodeURI(message.msg) + '\",\"chatType\":\"' + message.chatType + '\"}', function (response) {}, function (code, msg) {\n\t\t\t\t\t\tvar message = {\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tdata: \"send\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttype: _code.WEBIM_MESSAGE_SED_ERROR\n\t\t\t\t\t\t};\n\t\t\t\t\t\tself.onError(message);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tif (Object.prototype.toString.call(message) === '[object Object]') {\n\t\t\t\t\t\tvar appKey = this.context.appKey || '';\n\t\t\t\t\t\tvar toJid = appKey + '_' + message.to + '@' + this.domain;\n\n\t\t\t\t\t\tif (message.group) {\n\t\t\t\t\t\t\ttoJid = appKey + '_' + message.to + '@conference.' + this.domain;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (message.resource) {\n\t\t\t\t\t\t\ttoJid = toJid + '/' + message.resource;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tmessage.toJid = toJid;\n\t\t\t\t\t\tmessage.id = message.id || this.getUniqueId();\n\t\t\t\t\t\t_msgHash[message.id] = new _message(message);\n\t\t\t\t\t\t_msgHash[message.id].send(this);\n\t\t\t\t\t} else if (typeof message === 'string') {\n\t\t\t\t\t\t_msgHash[message] && _msgHash[message].send(this);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconnection.prototype.addRoster = function (options) {\n\t\t\t\tvar jid = _getJid(options, this);\n\t\t\t\tvar name = options.name || '';\n\t\t\t\tvar groups = options.groups || '';\n\n\t\t\t\tvar iq = $iq({ type: 'set' });\n\t\t\t\tiq.c('query', { xmlns: 'jabber:iq:roster' });\n\t\t\t\tiq.c('item', { jid: jid, name: name });\n\n\t\t\t\tif (groups) {\n\t\t\t\t\tfor (var i = 0; i < groups.length; i++) {\n\t\t\t\t\t\tiq.c('group').t(groups[i]).up();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvar suc = options.success || _utils.emptyfn;\n\t\t\t\tvar error = options.error || _utils.emptyfn;\n\t\t\t\tthis.context.stropheConn.sendIQ(iq.tree(), suc, error);\n\t\t\t};\n\n\t\t\tconnection.prototype.removeRoster = function (options) {\n\t\t\t\tvar jid = _getJid(options, this);\n\t\t\t\tvar iq = $iq({ type: 'set' }).c('query', { xmlns: 'jabber:iq:roster' }).c('item', {\n\t\t\t\t\tjid: jid,\n\t\t\t\t\tsubscription: 'remove'\n\t\t\t\t});\n\n\t\t\t\tvar suc = options.success || _utils.emptyfn;\n\t\t\t\tvar error = options.error || _utils.emptyfn;\n\t\t\t\tthis.context.stropheConn.sendIQ(iq, suc, error);\n\t\t\t};\n\n\t\t\tconnection.prototype.getRoster = function (options) {\n\t\t\t\tvar conn = this;\n\t\t\t\tvar dom = $iq({\n\t\t\t\t\ttype: 'get'\n\t\t\t\t}).c('query', { xmlns: 'jabber:iq:roster' });\n\n\t\t\t\tvar options = options || {};\n\t\t\t\tvar suc = options.success || this.onRoster;\n\t\t\t\tvar completeFn = function completeFn(ele) {\n\t\t\t\t\tvar rouster = [];\n\t\t\t\t\tvar msgBodies = ele.getElementsByTagName('query');\n\t\t\t\t\tif (msgBodies && msgBodies.length > 0) {\n\t\t\t\t\t\tvar queryTag = msgBodies[0];\n\t\t\t\t\t\trouster = _parseFriend(queryTag);\n\t\t\t\t\t}\n\t\t\t\t\tsuc(rouster, ele);\n\t\t\t\t};\n\t\t\t\tvar error = options.error || this.onError;\n\t\t\t\tvar failFn = function failFn(ele) {\n\t\t\t\t\terror({\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_GETROSTER_ERROR,\n\t\t\t\t\t\tdata: ele\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t\tif (this.isOpened()) {\n\t\t\t\t\tthis.context.stropheConn.sendIQ(dom.tree(), completeFn, failFn);\n\t\t\t\t} else {\n\t\t\t\t\terror({\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_DISCONNECTED\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconnection.prototype.subscribe = function (options) {\n\t\t\t\tvar jid = _getJid(options, this);\n\t\t\t\tvar pres = $pres({ to: jid, type: 'subscribe' });\n\t\t\t\tif (options.message) {\n\t\t\t\t\tpres.c('status').t(options.message).up();\n\t\t\t\t}\n\t\t\t\tif (options.nick) {\n\t\t\t\t\tpres.c('nick', { 'xmlns': 'http://jabber.org/protocol/nick' }).t(options.nick);\n\t\t\t\t}\n\t\t\t\tthis.sendCommand(pres.tree());\n\t\t\t};\n\n\t\t\tconnection.prototype.subscribed = function (options) {\n\t\t\t\tvar jid = _getJid(options, this);\n\t\t\t\tvar pres = $pres({ to: jid, type: 'subscribed' });\n\n\t\t\t\tif (options.message) {\n\t\t\t\t\tpres.c('status').t(options.message).up();\n\t\t\t\t}\n\t\t\t\tthis.sendCommand(pres.tree());\n\t\t\t};\n\n\t\t\tconnection.prototype.unsubscribe = function (options) {\n\t\t\t\tvar jid = _getJid(options, this);\n\t\t\t\tvar pres = $pres({ to: jid, type: 'unsubscribe' });\n\n\t\t\t\tif (options.message) {\n\t\t\t\t\tpres.c('status').t(options.message);\n\t\t\t\t}\n\t\t\t\tthis.sendCommand(pres.tree());\n\t\t\t};\n\n\t\t\tconnection.prototype.unsubscribed = function (options) {\n\t\t\t\tvar jid = _getJid(options, this);\n\t\t\t\tvar pres = $pres({ to: jid, type: 'unsubscribed' });\n\n\t\t\t\tif (options.message) {\n\t\t\t\t\tpres.c('status').t(options.message).up();\n\t\t\t\t}\n\t\t\t\tthis.sendCommand(pres.tree());\n\t\t\t};\n\n\t\t\tconnection.prototype.joinPublicGroup = function (options) {\n\t\t\t\tvar roomJid = this.context.appKey + '_' + options.roomId + '@conference.' + this.domain;\n\t\t\t\tvar room_nick = roomJid + '/' + this.context.userId;\n\t\t\t\tvar suc = options.success || _utils.emptyfn;\n\t\t\t\tvar err = options.error || _utils.emptyfn;\n\t\t\t\tvar errorFn = function errorFn(ele) {\n\t\t\t\t\terr({\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_JOINROOM_ERROR,\n\t\t\t\t\t\tdata: ele\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t\tvar iq = $pres({\n\t\t\t\t\tfrom: this.context.jid,\n\t\t\t\t\tto: room_nick\n\t\t\t\t}).c('x', { xmlns: Strophe.NS.MUC });\n\n\t\t\t\tthis.context.stropheConn.sendIQ(iq.tree(), suc, errorFn);\n\t\t\t};\n\n\t\t\tconnection.prototype.listRooms = function (options) {\n\t\t\t\tvar iq = $iq({\n\t\t\t\t\tto: options.server || 'conference.' + this.domain,\n\t\t\t\t\tfrom: this.context.jid,\n\t\t\t\t\ttype: 'get'\n\t\t\t\t}).c('query', { xmlns: Strophe.NS.DISCO_ITEMS });\n\n\t\t\t\tvar suc = options.success || _utils.emptyfn;\n\t\t\t\tvar error = options.error || this.onError;\n\t\t\t\tvar completeFn = function completeFn(result) {\n\t\t\t\t\tvar rooms = [];\n\t\t\t\t\trooms = _parseRoom(result);\n\t\t\t\t\ttry {\n\t\t\t\t\t\tsuc(rooms);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\terror({\n\t\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_GETROOM_ERROR,\n\t\t\t\t\t\t\tdata: e\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tvar err = options.error || _utils.emptyfn;\n\t\t\t\tvar errorFn = function errorFn(ele) {\n\t\t\t\t\terr({\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_GETROOM_ERROR,\n\t\t\t\t\t\tdata: ele\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t\tthis.context.stropheConn.sendIQ(iq.tree(), completeFn, errorFn);\n\t\t\t};\n\n\t\t\tconnection.prototype.queryRoomMember = function (options) {\n\t\t\t\tvar domain = this.domain;\n\t\t\t\tvar members = [];\n\t\t\t\tvar iq = $iq({\n\t\t\t\t\tto: this.context.appKey + '_' + options.roomId + '@conference.' + this.domain,\n\t\t\t\t\ttype: 'get'\n\t\t\t\t}).c('query', { xmlns: Strophe.NS.MUC + '#admin' }).c('item', { affiliation: 'member' });\n\n\t\t\t\tvar suc = options.success || _utils.emptyfn;\n\t\t\t\tvar completeFn = function completeFn(result) {\n\t\t\t\t\tvar items = result.getElementsByTagName('item');\n\n\t\t\t\t\tif (items) {\n\t\t\t\t\t\tfor (var i = 0; i < items.length; i++) {\n\t\t\t\t\t\t\tvar item = items[i];\n\t\t\t\t\t\t\tvar mem = {\n\t\t\t\t\t\t\t\tjid: item.getAttribute('jid'),\n\t\t\t\t\t\t\t\taffiliation: 'member'\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tmembers.push(mem);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tsuc(members);\n\t\t\t\t};\n\t\t\t\tvar err = options.error || _utils.emptyfn;\n\t\t\t\tvar errorFn = function errorFn(ele) {\n\t\t\t\t\terr({\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_GETROOMMEMBER_ERROR,\n\t\t\t\t\t\tdata: ele\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t\tthis.context.stropheConn.sendIQ(iq.tree(), completeFn, errorFn);\n\t\t\t};\n\n\t\t\tconnection.prototype.queryRoomInfo = function (options) {\n\t\t\t\tvar domain = this.domain;\n\t\t\t\tvar iq = $iq({\n\t\t\t\t\tto: this.context.appKey + '_' + options.roomId + '@conference.' + domain,\n\t\t\t\t\ttype: 'get'\n\t\t\t\t}).c('query', { xmlns: Strophe.NS.DISCO_INFO });\n\n\t\t\t\tvar suc = options.success || _utils.emptyfn;\n\t\t\t\tvar members = [];\n\n\t\t\t\tvar completeFn = function completeFn(result) {\n\t\t\t\t\tvar settings = '';\n\t\t\t\t\tvar features = result.getElementsByTagName('feature');\n\t\t\t\t\tif (features) {\n\t\t\t\t\t\tsettings = features[1].getAttribute('var') + '|' + features[3].getAttribute('var') + '|' + features[4].getAttribute('var');\n\t\t\t\t\t}\n\t\t\t\t\tswitch (settings) {\n\t\t\t\t\t\tcase 'muc_public|muc_membersonly|muc_notallowinvites':\n\t\t\t\t\t\t\tsettings = 'PUBLIC_JOIN_APPROVAL';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'muc_public|muc_open|muc_notallowinvites':\n\t\t\t\t\t\t\tsettings = 'PUBLIC_JOIN_OPEN';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'muc_hidden|muc_membersonly|muc_allowinvites':\n\t\t\t\t\t\t\tsettings = 'PRIVATE_MEMBER_INVITE';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'muc_hidden|muc_membersonly|muc_notallowinvites':\n\t\t\t\t\t\t\tsettings = 'PRIVATE_OWNER_INVITE';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tvar owner = '';\n\t\t\t\t\tvar fields = result.getElementsByTagName('field');\n\t\t\t\t\tvar fieldValues = {};\n\t\t\t\t\tif (fields) {\n\t\t\t\t\t\tfor (var i = 0; i < fields.length; i++) {\n\t\t\t\t\t\t\tvar field = fields[i];\n\t\t\t\t\t\t\tvar fieldVar = field.getAttribute('var');\n\t\t\t\t\t\t\tvar fieldSimplify = fieldVar.split('_')[1];\n\t\t\t\t\t\t\tswitch (fieldVar) {\n\t\t\t\t\t\t\t\tcase 'muc#roominfo_occupants':\n\t\t\t\t\t\t\t\tcase 'muc#roominfo_maxusers':\n\t\t\t\t\t\t\t\tcase 'muc#roominfo_affiliations':\n\t\t\t\t\t\t\t\tcase 'muc#roominfo_description':\n\t\t\t\t\t\t\t\t\tfieldValues[fieldSimplify] = field.textContent || field.text || '';\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 'muc#roominfo_owner':\n\t\t\t\t\t\t\t\t\tvar mem = {\n\t\t\t\t\t\t\t\t\t\tjid: (field.textContent || field.text) + '@' + domain,\n\t\t\t\t\t\t\t\t\t\taffiliation: 'owner'\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\tmembers.push(mem);\n\t\t\t\t\t\t\t\t\tfieldValues[fieldSimplify] = field.textContent || field.text;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// if (field.getAttribute('label') === 'owner') {\n\t\t\t\t\t\t\t//     var mem = {\n\t\t\t\t\t\t\t//         jid: (field.textContent || field.text) + '@' + domain\n\t\t\t\t\t\t\t//         , affiliation: 'owner'\n\t\t\t\t\t\t\t//     };\n\t\t\t\t\t\t\t//     members.push(mem);\n\t\t\t\t\t\t\t//     break;\n\t\t\t\t\t\t\t// }\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfieldValues['name'] = result.getElementsByTagName('identity')[0].getAttribute('name');\n\t\t\t\t\t}\n\t\t\t\t\tsuc(settings, members, fieldValues);\n\t\t\t\t};\n\t\t\t\tvar err = options.error || _utils.emptyfn;\n\t\t\t\tvar errorFn = function errorFn(ele) {\n\t\t\t\t\terr({\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_GETROOMINFO_ERROR,\n\t\t\t\t\t\tdata: ele\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t\tthis.context.stropheConn.sendIQ(iq.tree(), completeFn, errorFn);\n\t\t\t};\n\n\t\t\tconnection.prototype.queryRoomOccupants = function (options) {\n\t\t\t\tvar suc = options.success || _utils.emptyfn;\n\t\t\t\tvar completeFn = function completeFn(result) {\n\t\t\t\t\tvar occupants = [];\n\t\t\t\t\toccupants = _parseRoomOccupants(result);\n\t\t\t\t\tsuc(occupants);\n\t\t\t\t};\n\t\t\t\tvar err = options.error || _utils.emptyfn;\n\t\t\t\tvar errorFn = function errorFn(ele) {\n\t\t\t\t\terr({\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR,\n\t\t\t\t\t\tdata: ele\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t\tvar attrs = {\n\t\t\t\t\txmlns: Strophe.NS.DISCO_ITEMS\n\t\t\t\t};\n\t\t\t\tvar info = $iq({\n\t\t\t\t\tfrom: this.context.jid,\n\t\t\t\t\tto: this.context.appKey + '_' + options.roomId + '@conference.' + this.domain,\n\t\t\t\t\ttype: 'get'\n\t\t\t\t}).c('query', attrs);\n\t\t\t\tthis.context.stropheConn.sendIQ(info.tree(), completeFn, errorFn);\n\t\t\t};\n\n\t\t\tconnection.prototype.setUserSig = function (desc) {\n\t\t\t\tvar dom = $pres({ xmlns: 'jabber:client' });\n\t\t\t\tdesc = desc || '';\n\t\t\t\tdom.c('status').t(desc);\n\t\t\t\tthis.sendCommand(dom.tree());\n\t\t\t};\n\n\t\t\tconnection.prototype.setPresence = function (type, status) {\n\t\t\t\tvar dom = $pres({ xmlns: 'jabber:client' });\n\t\t\t\tif (type) {\n\t\t\t\t\tif (status) {\n\t\t\t\t\t\tdom.c('show').t(type);\n\t\t\t\t\t\tdom.up().c('status').t(status);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdom.c('show').t(type);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.sendCommand(dom.tree());\n\t\t\t};\n\n\t\t\tconnection.prototype.getPresence = function () {\n\t\t\t\tvar dom = $pres({ xmlns: 'jabber:client' });\n\t\t\t\tvar conn = this;\n\t\t\t\tthis.sendCommand(dom.tree());\n\t\t\t};\n\n\t\t\tconnection.prototype.ping = function (options) {\n\t\t\t\tvar options = options || {};\n\t\t\t\tvar jid = _getJid(options, this);\n\n\t\t\t\tvar dom = $iq({\n\t\t\t\t\tfrom: this.context.jid || '',\n\t\t\t\t\tto: jid,\n\t\t\t\t\ttype: 'get'\n\t\t\t\t}).c('ping', { xmlns: 'urn:xmpp:ping' });\n\n\t\t\t\tvar suc = options.success || _utils.emptyfn;\n\t\t\t\tvar error = options.error || this.onError;\n\t\t\t\tvar failFn = function failFn(ele) {\n\t\t\t\t\terror({\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_PING_ERROR,\n\t\t\t\t\t\tdata: ele\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t\tif (this.isOpened()) {\n\t\t\t\t\tthis.context.stropheConn.sendIQ(dom.tree(), suc, failFn);\n\t\t\t\t} else {\n\t\t\t\t\terror({\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_DISCONNECTED\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t};\n\n\t\t\tconnection.prototype.isOpened = function () {\n\t\t\t\treturn this.context.status == _code.STATUS_OPENED;\n\t\t\t};\n\n\t\t\tconnection.prototype.isOpening = function () {\n\t\t\t\tvar status = this.context.status;\n\t\t\t\treturn status == _code.STATUS_DOLOGIN_USERGRID || status == _code.STATUS_DOLOGIN_IM;\n\t\t\t};\n\n\t\t\tconnection.prototype.isClosing = function () {\n\t\t\t\treturn this.context.status == _code.STATUS_CLOSING;\n\t\t\t};\n\n\t\t\tconnection.prototype.isClosed = function () {\n\t\t\t\treturn this.context.status == _code.STATUS_CLOSED;\n\t\t\t};\n\n\t\t\tconnection.prototype.clear = function () {\n\t\t\t\tvar key = this.context.appKey;\n\t\t\t\tif (this.errorType != _code.WEBIM_CONNCTION_DISCONNECTED) {\n\t\t\t\t\tthis.context = {\n\t\t\t\t\t\tstatus: _code.STATUS_INIT,\n\t\t\t\t\t\tappKey: key\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tif (this.intervalId) {\n\t\t\t\t\tclearInterval(this.intervalId);\n\t\t\t\t}\n\t\t\t\tthis.restIndex = 0;\n\t\t\t\tthis.xmppIndex = 0;\n\n\t\t\t\tif (this.errorType == _code.WEBIM_CONNCTION_CLIENT_LOGOUT || this.errorType == -1) {\n\t\t\t\t\tvar message = {\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tdata: \"logout\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_CLIENT_LOGOUT\n\t\t\t\t\t};\n\t\t\t\t\tthis.onError(message);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconnection.prototype.getChatRooms = function (options) {\n\n\t\t\t\tif (!_utils.isCanSetRequestHeader) {\n\t\t\t\t\tconn.onError({\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar conn = this,\n\t\t\t\t    token = options.accessToken || this.context.accessToken;\n\n\t\t\t\tif (token) {\n\t\t\t\t\tvar apiUrl = options.apiUrl;\n\t\t\t\t\tvar appName = this.context.appName;\n\t\t\t\t\tvar orgName = this.context.orgName;\n\n\t\t\t\t\tif (!appName || !orgName) {\n\t\t\t\t\t\tconn.onError({\n\t\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_AUTH_ERROR\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar suc = function suc(data, xhr) {\n\t\t\t\t\t\ttypeof options.success === 'function' && options.success(data);\n\t\t\t\t\t};\n\n\t\t\t\t\tvar error = function error(res, xhr, msg) {\n\t\t\t\t\t\tif (res.error && res.error_description) {\n\t\t\t\t\t\t\tconn.onError({\n\t\t\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_LOAD_CHATROOM_ERROR,\n\t\t\t\t\t\t\t\tmsg: res.error_description,\n\t\t\t\t\t\t\t\tdata: res,\n\t\t\t\t\t\t\t\txhr: xhr\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tvar pageInfo = {\n\t\t\t\t\t\tpagenum: parseInt(options.pagenum) || 1,\n\t\t\t\t\t\tpagesize: parseInt(options.pagesize) || 20\n\t\t\t\t\t};\n\n\t\t\t\t\tvar opts = {\n\t\t\t\t\t\turl: apiUrl + '/' + orgName + '/' + appName + '/chatrooms',\n\t\t\t\t\t\tdataType: 'json',\n\t\t\t\t\t\ttype: 'GET',\n\t\t\t\t\t\theaders: { 'Authorization': 'Bearer ' + token },\n\t\t\t\t\t\tdata: pageInfo,\n\t\t\t\t\t\tsuccess: suc || _utils.emptyfn,\n\t\t\t\t\t\terror: error || _utils.emptyfn\n\t\t\t\t\t};\n\t\t\t\t\t_utils.ajax(opts);\n\t\t\t\t} else {\n\t\t\t\t\tconn.onError({\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconnection.prototype.joinChatRoom = function (options) {\n\t\t\t\tvar roomJid = this.context.appKey + '_' + options.roomId + '@conference.' + this.domain;\n\t\t\t\tvar room_nick = roomJid + '/' + this.context.userId;\n\t\t\t\tvar suc = options.success || _utils.emptyfn;\n\t\t\t\tvar err = options.error || _utils.emptyfn;\n\t\t\t\tvar errorFn = function errorFn(ele) {\n\t\t\t\t\terr({\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_JOINCHATROOM_ERROR,\n\t\t\t\t\t\tdata: ele\n\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\tvar iq = $pres({\n\t\t\t\t\tfrom: this.context.jid,\n\t\t\t\t\tto: room_nick\n\t\t\t\t}).c('x', { xmlns: Strophe.NS.MUC + '#user' }).c('item', { affiliation: 'member', role: 'participant' }).up().up().c('roomtype', { xmlns: 'easemob:x:roomtype', type: 'chatroom' });\n\n\t\t\t\tthis.context.stropheConn.sendIQ(iq.tree(), suc, errorFn);\n\t\t\t};\n\n\t\t\tconnection.prototype.quitChatRoom = function (options) {\n\t\t\t\tvar roomJid = this.context.appKey + '_' + options.roomId + '@conference.' + this.domain;\n\t\t\t\tvar room_nick = roomJid + '/' + this.context.userId;\n\t\t\t\tvar suc = options.success || _utils.emptyfn;\n\t\t\t\tvar err = options.error || _utils.emptyfn;\n\t\t\t\tvar errorFn = function errorFn(ele) {\n\t\t\t\t\terr({\n\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_QUITCHATROOM_ERROR,\n\t\t\t\t\t\tdata: ele\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t\tvar iq = $pres({\n\t\t\t\t\tfrom: this.context.jid,\n\t\t\t\t\tto: room_nick,\n\t\t\t\t\ttype: 'unavailable'\n\t\t\t\t}).c('x', { xmlns: Strophe.NS.MUC + '#user' }).c('item', { affiliation: 'none', role: 'none' }).up().up().c('roomtype', { xmlns: 'easemob:x:roomtype', type: 'chatroom' });\n\n\t\t\t\tthis.context.stropheConn.sendIQ(iq.tree(), suc, errorFn);\n\t\t\t};\n\n\t\t\tconnection.prototype._onReceiveInviteFromGroup = function (info) {\n\t\t\t\tinfo = eval('(' + info + ')');\n\t\t\t\tvar self = this;\n\t\t\t\tvar options = {\n\t\t\t\t\ttitle: \"Group invitation\",\n\t\t\t\t\tmsg: info.user + \" invites you to join into group:\" + info.group_id,\n\t\t\t\t\tagree: function agree() {\n\t\t\t\t\t\tWebIM.doQuery('{\"type\":\"acceptInvitationFromGroup\",\"id\":\"' + info.group_id + '\",\"user\":\"' + info.user + '\"}', function (response) {}, function (code, msg) {\n\t\t\t\t\t\t\tvar message = {\n\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\tdata: \"acceptInvitationFromGroup error:\" + msg\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttype: _code.WEBIM_CONNECTION_ACCEPT_INVITATION_FROM_GROUP\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tself.onError(message);\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\treject: function reject() {\n\t\t\t\t\t\tWebIM.doQuery('{\"type\":\"declineInvitationFromGroup\",\"id\":\"' + info.group_id + '\",\"user\":\"' + info.user + '\"}', function (response) {}, function (code, msg) {\n\t\t\t\t\t\t\tvar message = {\n\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\tdata: \"declineInvitationFromGroup error:\" + msg\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttype: _code.WEBIM_CONNECTION_DECLINE_INVITATION_FROM_GROUP\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tself.onError(message);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tthis.onConfirmPop(options);\n\t\t\t};\n\t\t\tconnection.prototype._onReceiveInviteAcceptionFromGroup = function (info) {\n\t\t\t\tinfo = eval('(' + info + ')');\n\t\t\t\tvar options = {\n\t\t\t\t\ttitle: \"Group invitation response\",\n\t\t\t\t\tmsg: info.user + \" agreed to join into group:\" + info.group_id,\n\t\t\t\t\tagree: function agree() {}\n\t\t\t\t};\n\t\t\t\tthis.onConfirmPop(options);\n\t\t\t};\n\t\t\tconnection.prototype._onReceiveInviteDeclineFromGroup = function (info) {\n\t\t\t\tinfo = eval('(' + info + ')');\n\t\t\t\tvar options = {\n\t\t\t\t\ttitle: \"Group invitation response\",\n\t\t\t\t\tmsg: info.user + \" rejected to join into group:\" + info.group_id,\n\t\t\t\t\tagree: function agree() {}\n\t\t\t\t};\n\t\t\t\tthis.onConfirmPop(options);\n\t\t\t};\n\t\t\tconnection.prototype._onAutoAcceptInvitationFromGroup = function (info) {\n\t\t\t\tinfo = eval('(' + info + ')');\n\t\t\t\tvar options = {\n\t\t\t\t\ttitle: \"Group invitation\",\n\t\t\t\t\tmsg: \"You had joined into the group:\" + info.group_name + \" automatically.Inviter:\" + info.user,\n\t\t\t\t\tagree: function agree() {}\n\t\t\t\t};\n\t\t\t\tthis.onConfirmPop(options);\n\t\t\t};\n\t\t\tconnection.prototype._onLeaveGroup = function (info) {\n\t\t\t\tinfo = eval('(' + info + ')');\n\t\t\t\tvar options = {\n\t\t\t\t\ttitle: \"Group notification\",\n\t\t\t\t\tmsg: \"You have been out of the group:\" + info.group_id + \".Reason:\" + info.msg,\n\t\t\t\t\tagree: function agree() {}\n\t\t\t\t};\n\t\t\t\tthis.onConfirmPop(options);\n\t\t\t};\n\t\t\tconnection.prototype._onReceiveJoinGroupApplication = function (info) {\n\t\t\t\tinfo = eval('(' + info + ')');\n\t\t\t\tvar self = this;\n\t\t\t\tvar options = {\n\t\t\t\t\ttitle: \"Group join application\",\n\t\t\t\t\tmsg: info.user + \" applys to join into group:\" + info.group_id,\n\t\t\t\t\tagree: function agree() {\n\t\t\t\t\t\tWebIM.doQuery('{\"type\":\"acceptJoinGroupApplication\",\"id\":\"' + info.group_id + '\",\"user\":\"' + info.user + '\"}', function (response) {}, function (code, msg) {\n\t\t\t\t\t\t\tvar message = {\n\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\tdata: \"acceptJoinGroupApplication error:\" + msg\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttype: _code.WEBIM_CONNECTION_ACCEPT_JOIN_GROUP\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tself.onError(message);\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\treject: function reject() {\n\t\t\t\t\t\tWebIM.doQuery('{\"type\":\"declineJoinGroupApplication\",\"id\":\"' + info.group_id + '\",\"user\":\"' + info.user + '\"}', function (response) {}, function (code, msg) {\n\t\t\t\t\t\t\tvar message = {\n\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\tdata: \"declineJoinGroupApplication error:\" + msg\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttype: _code.WEBIM_CONNECTION_DECLINE_JOIN_GROUP\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tself.onError(message);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tthis.onConfirmPop(options);\n\t\t\t};\n\t\t\tconnection.prototype._onReceiveAcceptionFromGroup = function (info) {\n\t\t\t\tinfo = eval('(' + info + ')');\n\t\t\t\tvar options = {\n\t\t\t\t\ttitle: \"Group notification\",\n\t\t\t\t\tmsg: \"You had joined into the group:\" + info.group_name + \".\",\n\t\t\t\t\tagree: function agree() {}\n\t\t\t\t};\n\t\t\t\tthis.onConfirmPop(options);\n\t\t\t};\n\t\t\tconnection.prototype._onReceiveRejectionFromGroup = function () {\n\t\t\t\tinfo = eval('(' + info + ')');\n\t\t\t\tvar options = {\n\t\t\t\t\ttitle: \"Group notification\",\n\t\t\t\t\tmsg: \"You have been rejected to join into the group:\" + info.group_name + \".\",\n\t\t\t\t\tagree: function agree() {}\n\t\t\t\t};\n\t\t\t\tthis.onConfirmPop(options);\n\t\t\t};\n\t\t\tconnection.prototype._onUpdateMyGroupList = function (options) {\n\t\t\t\tthis.onUpdateMyGroupList(options);\n\t\t\t};\n\t\t\tconnection.prototype._onUpdateMyRoster = function (options) {\n\t\t\t\tthis.onUpdateMyRoster(options);\n\t\t\t};\n\t\t\tconnection.prototype.reconnect = function () {\n\t\t\t\tvar that = this;\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t_login(that.context.restTokenData, that);\n\t\t\t\t}, (this.autoReconnectNumTotal == 0 ? 0 : this.autoReconnectInterval) * 1000);\n\t\t\t\tthis.autoReconnectNumTotal++;\n\t\t\t};\n\n\t\t\tconnection.prototype.closed = function () {\n\t\t\t\tvar message = {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tdata: \"Closed error\"\n\t\t\t\t\t},\n\t\t\t\t\ttype: _code.WEBIM_CONNECTION_CLOSED\n\t\t\t\t};\n\t\t\t\tthis.onError(message);\n\t\t\t};\n\n\t\t\t// used for blacklist\n\t\t\tfunction _parsePrivacy(iq) {\n\t\t\t\tvar list = [];\n\t\t\t\tvar items = iq.getElementsByTagName('item');\n\n\t\t\t\tif (items) {\n\t\t\t\t\tfor (var i = 0; i < items.length; i++) {\n\t\t\t\t\t\tvar item = items[i];\n\t\t\t\t\t\tvar jid = item.getAttribute('value');\n\t\t\t\t\t\tvar order = item.getAttribute('order');\n\t\t\t\t\t\tvar type = item.getAttribute('type');\n\t\t\t\t\t\tif (!jid) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar n = _parseNameFromJidFn(jid);\n\t\t\t\t\t\tlist[n] = {\n\t\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\t\torder: order,\n\t\t\t\t\t\t\tjid: jid,\n\t\t\t\t\t\t\tname: n\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn list;\n\t\t\t};\n\n\t\t\t// used for blacklist\n\t\t\tconnection.prototype.getBlacklist = function (options) {\n\t\t\t\toptions = options || {};\n\t\t\t\tvar iq = $iq({ type: 'get' });\n\t\t\t\tvar sucFn = options.success || _utils.emptyfn;\n\t\t\t\tvar errFn = options.error || _utils.emptyfn;\n\t\t\t\tvar me = this;\n\n\t\t\t\tiq.c('query', { xmlns: 'jabber:iq:privacy' }).c('list', { name: 'special' });\n\n\t\t\t\tthis.context.stropheConn.sendIQ(iq.tree(), function (iq) {\n\t\t\t\t\tme.onBlacklistUpdate(_parsePrivacy(iq));\n\t\t\t\t\tsucFn();\n\t\t\t\t}, function () {\n\t\t\t\t\tme.onBlacklistUpdate([]);\n\t\t\t\t\terrFn();\n\t\t\t\t});\n\t\t\t};\n\n\t\t\t// used for blacklist\n\t\t\tconnection.prototype.addToBlackList = function (options) {\n\t\t\t\tvar iq = $iq({ type: 'set' });\n\t\t\t\tvar blacklist = options.list || {};\n\t\t\t\tvar type = options.type || 'jid';\n\t\t\t\tvar sucFn = options.success || _utils.emptyfn;\n\t\t\t\tvar errFn = options.error || _utils.emptyfn;\n\t\t\t\tvar piece = iq.c('query', { xmlns: 'jabber:iq:privacy' }).c('list', { name: 'special' });\n\n\t\t\t\tvar keys = Object.keys(blacklist);\n\t\t\t\tvar len = keys.length;\n\t\t\t\tvar order = 2;\n\n\t\t\t\tfor (var i = 0; i < len; i++) {\n\t\t\t\t\tvar item = blacklist[keys[i]];\n\t\t\t\t\tvar type = item.type || 'jid';\n\t\t\t\t\tvar jid = item.jid;\n\n\t\t\t\t\tpiece = piece.c('item', { action: 'deny', order: order++, type: type, value: jid }).c('message');\n\t\t\t\t\tif (i !== len - 1) {\n\t\t\t\t\t\tpiece = piece.up().up();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// console.log('addToBlackList', blacklist, piece.tree());\n\t\t\t\tthis.context.stropheConn.sendIQ(piece.tree(), sucFn, errFn);\n\t\t\t};\n\n\t\t\t// used for blacklist\n\t\t\tconnection.prototype.removeFromBlackList = function (options) {\n\n\t\t\t\tvar iq = $iq({ type: 'set' });\n\t\t\t\tvar blacklist = options.list || {};\n\t\t\t\tvar sucFn = options.success || _utils.emptyfn;\n\t\t\t\tvar errFn = options.error || _utils.emptyfn;\n\t\t\t\tvar piece = iq.c('query', { xmlns: 'jabber:iq:privacy' }).c('list', { name: 'special' });\n\n\t\t\t\tvar keys = Object.keys(blacklist);\n\t\t\t\tvar len = keys.length;\n\n\t\t\t\tfor (var i = 0; i < len; i++) {\n\t\t\t\t\tvar item = blacklist[keys[i]];\n\t\t\t\t\tvar type = item.type || 'jid';\n\t\t\t\t\tvar jid = item.jid;\n\t\t\t\t\tvar order = item.order;\n\n\t\t\t\t\tpiece = piece.c('item', { action: 'deny', order: order, type: type, value: jid }).c('message');\n\t\t\t\t\tif (i !== len - 1) {\n\t\t\t\t\t\tpiece = piece.up().up();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// console.log('removeFromBlackList', blacklist, piece.tree());\n\t\t\t\tthis.context.stropheConn.sendIQ(piece.tree(), sucFn, errFn);\n\t\t\t};\n\n\t\t\tconnection.prototype._getGroupJid = function (to) {\n\t\t\t\tvar appKey = this.context.appKey || '';\n\t\t\t\treturn appKey + '_' + to + '@conference.' + this.domain;\n\t\t\t};\n\n\t\t\t// used for blacklist\n\t\t\tconnection.prototype.addToGroupBlackList = function (options) {\n\t\t\t\tvar sucFn = options.success || _utils.emptyfn;\n\t\t\t\tvar errFn = options.error || _utils.emptyfn;\n\t\t\t\tvar jid = _getJid(options, this);\n\t\t\t\tvar affiliation = 'admin'; //options.affiliation || 'admin';\n\t\t\t\tvar to = this._getGroupJid(options.roomId);\n\t\t\t\tvar iq = $iq({ type: 'set', to: to });\n\n\t\t\t\tiq.c('query', { xmlns: 'http://jabber.org/protocol/muc#' + affiliation }).c('item', {\n\t\t\t\t\taffiliation: 'outcast',\n\t\t\t\t\tjid: jid\n\t\t\t\t});\n\n\t\t\t\tthis.context.stropheConn.sendIQ(iq.tree(), sucFn, errFn);\n\t\t\t};\n\n\t\t\tfunction _parseGroupBlacklist(iq) {\n\t\t\t\tvar list = {};\n\t\t\t\tvar items = iq.getElementsByTagName('item');\n\n\t\t\t\tif (items) {\n\t\t\t\t\tfor (var i = 0; i < items.length; i++) {\n\t\t\t\t\t\tvar item = items[i];\n\t\t\t\t\t\tvar jid = item.getAttribute('jid');\n\t\t\t\t\t\tvar affiliation = item.getAttribute('affiliation');\n\t\t\t\t\t\tvar nick = item.getAttribute('nick');\n\t\t\t\t\t\tif (!jid) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar n = _parseNameFromJidFn(jid);\n\t\t\t\t\t\tlist[n] = {\n\t\t\t\t\t\t\tjid: jid,\n\t\t\t\t\t\t\taffiliation: affiliation,\n\t\t\t\t\t\t\tnick: nick,\n\t\t\t\t\t\t\tname: n\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn list;\n\t\t\t}\n\n\t\t\t// used for blacklist\n\t\t\tconnection.prototype.getGroupBlacklist = function (options) {\n\t\t\t\tvar sucFn = options.success || _utils.emptyfn;\n\t\t\t\tvar errFn = options.error || _utils.emptyfn;\n\n\t\t\t\t// var jid = _getJid(options, this);\n\t\t\t\tvar affiliation = 'admin'; //options.affiliation || 'admin';\n\t\t\t\tvar to = this._getGroupJid(options.roomId);\n\t\t\t\tvar iq = $iq({ type: 'get', to: to });\n\n\t\t\t\tiq.c('query', { xmlns: 'http://jabber.org/protocol/muc#' + affiliation }).c('item', {\n\t\t\t\t\taffiliation: 'outcast'\n\t\t\t\t});\n\n\t\t\t\tthis.context.stropheConn.sendIQ(iq.tree(), function (msginfo) {\n\t\t\t\t\tsucFn(_parseGroupBlacklist(msginfo));\n\t\t\t\t}, function () {\n\t\t\t\t\terrFn();\n\t\t\t\t});\n\t\t\t};\n\n\t\t\t// used for blacklist\n\t\t\tconnection.prototype.removeGroupMemberFromBlacklist = function (options) {\n\t\t\t\tvar sucFn = options.success || _utils.emptyfn;\n\t\t\t\tvar errFn = options.error || _utils.emptyfn;\n\n\t\t\t\tvar jid = _getJid(options, this);\n\t\t\t\tvar affiliation = 'admin'; //options.affiliation || 'admin';\n\t\t\t\tvar to = this._getGroupJid(options.roomId);\n\t\t\t\tvar iq = $iq({ type: 'set', to: to });\n\n\t\t\t\tiq.c('query', { xmlns: 'http://jabber.org/protocol/muc#' + affiliation }).c('item', {\n\t\t\t\t\taffiliation: 'none',\n\t\t\t\t\tjid: jid\n\t\t\t\t});\n\n\t\t\t\tthis.context.stropheConn.sendIQ(iq.tree(), function (msginfo) {\n\t\t\t\t\tsucFn();\n\t\t\t\t}, function () {\n\t\t\t\t\terrFn();\n\t\t\t\t});\n\t\t\t};\n\n\t\t\t/**\n    * changeGroupSubject 修改群名称\n    *\n    * @param options\n    */\n\t\t\t// <iq to='easemob-demo#chatdemoui_roomid@conference.easemob.com' type='set' id='3940489311' xmlns='jabber:client'>\n\t\t\t//     <query xmlns='http://jabber.org/protocol/muc#owner'>\n\t\t\t//         <x type='submit' xmlns='jabber:x:data'>\n\t\t\t//             <field var='FORM_TYPE'><value>http://jabber.org/protocol/muc#roomconfig</value></field>\n\t\t\t//             <field var='muc#roomconfig_roomname'><value>Room Name</value></field>\n\t\t\t//         </x>\n\t\t\t//     </query>\n\t\t\t// </iq>\n\t\t\tconnection.prototype.changeGroupSubject = function (options) {\n\t\t\t\tvar sucFn = options.success || _utils.emptyfn;\n\t\t\t\tvar errFn = options.error || _utils.emptyfn;\n\n\t\t\t\t// must be `owner`\n\t\t\t\tvar affiliation = 'owner';\n\t\t\t\tvar to = this._getGroupJid(options.roomId);\n\t\t\t\tvar iq = $iq({ type: 'set', to: to });\n\n\t\t\t\tiq.c('query', { xmlns: 'http://jabber.org/protocol/muc#' + affiliation }).c('x', { type: 'submit', xmlns: 'jabber:x:data' }).c('field', { 'var': 'FORM_TYPE' }).c('value').t('http://jabber.org/protocol/muc#roomconfig').up().up().c('field', { 'var': 'muc#roomconfig_roomname' }).c('value').t(options.subject).up().up().c('field', { 'var': 'muc#roomconfig_roomdesc' }).c('value').t(options.description);\n\n\t\t\t\tthis.context.stropheConn.sendIQ(iq.tree(), function (msginfo) {\n\t\t\t\t\tsucFn();\n\t\t\t\t}, function () {\n\t\t\t\t\terrFn();\n\t\t\t\t});\n\t\t\t};\n\n\t\t\t/**\n    * destroyGroup 删除群组\n    *\n    * @param options\n    */\n\t\t\t// <iq id=\"9BEF5D20-841A-4048-B33A-F3F871120E58\" to=\"easemob-demo#chatdemoui_1477462231499@conference.easemob.com\" type=\"set\">\n\t\t\t//     <query xmlns=\"http://jabber.org/protocol/muc#owner\">\n\t\t\t//         <destroy>\n\t\t\t//             <reason>xxx destory group yyy</reason>\n\t\t\t//         </destroy>\n\t\t\t//     </query>\n\t\t\t// </iq>\n\t\t\tconnection.prototype.destroyGroup = function (options) {\n\t\t\t\tvar sucFn = options.success || _utils.emptyfn;\n\t\t\t\tvar errFn = options.error || _utils.emptyfn;\n\n\t\t\t\t// must be `owner`\n\t\t\t\tvar affiliation = 'owner';\n\t\t\t\tvar to = this._getGroupJid(options.roomId);\n\t\t\t\tvar iq = $iq({ type: 'set', to: to });\n\n\t\t\t\tiq.c('query', { xmlns: 'http://jabber.org/protocol/muc#' + affiliation }).c('destroy').c('reason').t(options.reason || '');\n\n\t\t\t\tthis.context.stropheConn.sendIQ(iq.tree(), function (msginfo) {\n\t\t\t\t\tsucFn();\n\t\t\t\t}, function () {\n\t\t\t\t\terrFn();\n\t\t\t\t});\n\t\t\t};\n\n\t\t\t/**\n    * leaveGroupBySelf 主动离开群组\n    *\n    * @param options\n    */\n\t\t\t// <iq id=\"5CD33172-7B62-41B7-98BC-CE6EF840C4F6_easemob_occupants_change_affiliation\" to=\"easemob-demo#chatdemoui_1477481609392@conference.easemob.com\" type=\"set\">\n\t\t\t//     <query xmlns=\"http://jabber.org/protocol/muc#admin\">\n\t\t\t//         <item affiliation=\"none\" jid=\"easemob-demo#chatdemoui_lwz2@easemob.com\"/>\n\t\t\t//     </query>\n\t\t\t// </iq>\n\t\t\t// <presence to=\"easemob-demo#chatdemoui_1479811172349@conference.easemob.com/mt002\" type=\"unavailable\"/>\n\n\t\t\tconnection.prototype.leaveGroupBySelf = function (options) {\n\t\t\t\tvar self = this;\n\t\t\t\tvar sucFn = options.success || _utils.emptyfn;\n\t\t\t\tvar errFn = options.error || _utils.emptyfn;\n\n\t\t\t\t// must be `owner`\n\t\t\t\tvar jid = _getJid(options, this);\n\t\t\t\tvar affiliation = 'admin';\n\t\t\t\tvar to = this._getGroupJid(options.roomId);\n\t\t\t\tvar iq = $iq({ type: 'set', to: to });\n\n\t\t\t\tiq.c('query', { xmlns: 'http://jabber.org/protocol/muc#' + affiliation }).c('item', {\n\t\t\t\t\taffiliation: 'none',\n\t\t\t\t\tjid: jid\n\t\t\t\t});\n\n\t\t\t\tthis.context.stropheConn.sendIQ(iq.tree(), function (msgInfo) {\n\t\t\t\t\tsucFn(msgInfo);\n\t\t\t\t\tvar pres = $pres({ type: 'unavailable', to: to + '/' + self.context.userId });\n\t\t\t\t\tself.sendCommand(pres.tree());\n\t\t\t\t}, function (errInfo) {\n\t\t\t\t\terrFn(errInfo);\n\t\t\t\t});\n\t\t\t};\n\n\t\t\t/**\n    * leaveGroup 被踢出群组\n    *\n    * @param options\n    */\n\t\t\t// <iq id=\"9fb25cf4-1183-43c9-961e-9df70e300de4:sendIQ\" to=\"easemob-demo#chatdemoui_1477481597120@conference.easemob.com\" type=\"set\" xmlns=\"jabber:client\">\n\t\t\t//     <query xmlns=\"http://jabber.org/protocol/muc#admin\">\n\t\t\t//         <item affiliation=\"none\" jid=\"easemob-demo#chatdemoui_lwz4@easemob.com\"/>\n\t\t\t//         <item jid=\"easemob-demo#chatdemoui_lwz4@easemob.com\" role=\"none\"/>\n\t\t\t//         <item affiliation=\"none\" jid=\"easemob-demo#chatdemoui_lwz2@easemob.com\"/>\n\t\t\t//         <item jid=\"easemob-demo#chatdemoui_lwz2@easemob.com\" role=\"none\"/>\n\t\t\t//     </query>\n\t\t\t// </iq>\n\t\t\tconnection.prototype.leaveGroup = function (options) {\n\t\t\t\tvar sucFn = options.success || _utils.emptyfn;\n\t\t\t\tvar errFn = options.error || _utils.emptyfn;\n\t\t\t\tvar list = options.list || [];\n\t\t\t\tvar affiliation = 'admin';\n\t\t\t\tvar to = this._getGroupJid(options.roomId);\n\t\t\t\tvar iq = $iq({ type: 'set', to: to });\n\t\t\t\tvar piece = iq.c('query', { xmlns: 'http://jabber.org/protocol/muc#' + affiliation });\n\t\t\t\tvar keys = Object.keys(list);\n\t\t\t\tvar len = keys.length;\n\n\t\t\t\tfor (var i = 0; i < len; i++) {\n\t\t\t\t\tvar name = list[keys[i]];\n\t\t\t\t\tvar jid = _getJidByName(name, this);\n\n\t\t\t\t\tpiece = piece.c('item', {\n\t\t\t\t\t\taffiliation: 'none',\n\t\t\t\t\t\tjid: jid\n\t\t\t\t\t}).up().c('item', {\n\t\t\t\t\t\trole: 'none',\n\t\t\t\t\t\tjid: jid\n\t\t\t\t\t}).up();\n\t\t\t\t}\n\n\t\t\t\tthis.context.stropheConn.sendIQ(iq.tree(), function (msgInfo) {\n\t\t\t\t\tsucFn(msgInfo);\n\t\t\t\t}, function (errInfo) {\n\t\t\t\t\terrFn(errInfo);\n\t\t\t\t});\n\t\t\t};\n\n\t\t\t/**\n    * addGroupMembers 添加群组成员\n    *\n    * @param options\n   \t Attention the sequence: message first (每个成员单独发一条message), iq second (多个成员可以合成一条iq发)\n    <!-- 添加成员通知：send -->\n    <message to='easemob-demo#chatdemoui_1477482739698@conference.easemob.com'>\n    <x xmlns='http://jabber.org/protocol/muc#user'>\n    <invite to='easemob-demo#chatdemoui_lwz2@easemob.com'>\n    <reason>liuwz invite you to join group '谢谢'</reason>\n    </invite>\n    </x>\n    </message>\n    <!-- 添加成员：send -->\n    <iq id='09DFB1E5-C939-4C43-B5A7-8000DA0E3B73_easemob_occupants_change_affiliation' to='easemob-demo#chatdemoui_1477482739698@conference.easemob.com' type='set'>\n    <query xmlns='http://jabber.org/protocol/muc#admin'>\n    <item affiliation='member' jid='easemob-demo#chatdemoui_lwz2@easemob.com'/>\n    </query>\n    </iq>\n    */\n\n\t\t\tconnection.prototype.addGroupMembers = function (options) {\n\t\t\t\tvar sucFn = options.success || _utils.emptyfn;\n\t\t\t\tvar errFn = options.error || _utils.emptyfn;\n\t\t\t\tvar list = options.list || [];\n\t\t\t\tvar affiliation = 'admin';\n\t\t\t\tvar to = this._getGroupJid(options.roomId);\n\t\t\t\tvar iq = $iq({ type: 'set', to: to });\n\t\t\t\tvar piece = iq.c('query', { xmlns: 'http://jabber.org/protocol/muc#' + affiliation });\n\t\t\t\tvar len = list.length;\n\n\t\t\t\tfor (var i = 0; i < len; i++) {\n\n\t\t\t\t\tvar name = list[i];\n\t\t\t\t\tvar jid = _getJidByName(name, this);\n\n\t\t\t\t\tpiece = piece.c('item', {\n\t\t\t\t\t\taffiliation: 'member',\n\t\t\t\t\t\tjid: jid\n\t\t\t\t\t}).up();\n\n\t\t\t\t\tvar dom = $msg({\n\t\t\t\t\t\tto: to\n\t\t\t\t\t}).c('x', {\n\t\t\t\t\t\txmlns: 'http://jabber.org/protocol/muc#user'\n\t\t\t\t\t}).c('invite', {\n\t\t\t\t\t\tto: jid\n\t\t\t\t\t}).c('reason').t(options.reason || '');\n\n\t\t\t\t\tthis.sendCommand(dom.tree());\n\t\t\t\t}\n\n\t\t\t\tthis.context.stropheConn.sendIQ(iq.tree(), function (msgInfo) {\n\t\t\t\t\tsucFn(msgInfo);\n\t\t\t\t}, function (errInfo) {\n\t\t\t\t\terrFn(errInfo);\n\t\t\t\t});\n\t\t\t};\n\n\t\t\t/**\n    * acceptInviteFromGroup 接受加入申请\n    *\n    * @param options\n    */\n\t\t\tconnection.prototype.acceptInviteFromGroup = function (options) {\n\t\t\t\toptions.success = function () {\n\t\t\t\t\t// then send sendAcceptInviteMessage\n\t\t\t\t\t// connection.prototype.sendAcceptInviteMessage(optoins);\n\t\t\t\t};\n\t\t\t\tthis.addGroupMembers(options);\n\t\t\t};\n\n\t\t\t/**\n    * rejectInviteFromGroup 拒绝入群申请\n    *\n    * throw request for now 暂时不处理，直接丢弃\n    *\n    <message to='easemob-demo#chatdemoui_mt002@easemob.com' from='easmeob-demo#chatdemoui_mt001@easemob.com' id='B83B7210-BCFF-4DEE-AB28-B9FE5579C1E2'>\n    <x xmlns='http://jabber.org/protocol/muc#user'>\n    <apply to='easemob-demo#chatdemoui_groupid1@conference.easemob.com' from='easmeob-demo#chatdemoui_mt001@easemob.com' toNick='llllll'>\n    <reason>reject</reason>\n    </apply>\n    </x>\n    </message>\n    *\n    * @param options\n    */\n\t\t\tconnection.prototype.rejectInviteFromGroup = function (options) {\n\t\t\t\t// var from = _getJidByName(options.from, this);\n\t\t\t\t// var dom = $msg({\n\t\t\t\t//     from: from,\n\t\t\t\t//     to: _getJidByName(options.to, this)\n\t\t\t\t// }).c('x', {\n\t\t\t\t//     xmlns: 'http://jabber.org/protocol/muc#user'\n\t\t\t\t// }).c('apply', {\n\t\t\t\t//     from: from,\n\t\t\t\t//     to: this._getGroupJid(options.groupId),\n\t\t\t\t//     toNick: options.groupName\n\t\t\t\t// }).c('reason').t(options.reason || '');\n\t\t\t\t//\n\t\t\t\t// this.sendCommand(dom.tree());\n\t\t\t};\n\n\t\t\tconnection.prototype.createGroupAsync = function (p) {\n\t\t\t\tvar roomId = p.from;\n\t\t\t\tvar me = this;\n\t\t\t\tvar toRoom = this._getGroupJid(roomId);\n\t\t\t\tvar to = toRoom + '/' + this.context.userId;\n\t\t\t\tvar options = this.groupOption;\n\t\t\t\tvar suc = p.success || _utils.emptyfn;\n\n\t\t\t\t// Creating a Reserved Room\n\t\t\t\tvar iq = $iq({ type: 'get', to: toRoom }).c('query', { xmlns: 'http://jabber.org/protocol/muc#owner' });\n\n\t\t\t\t// Strophe.info('step 1 ----------');\n\t\t\t\t// Strophe.info(options);\n\t\t\t\tme.context.stropheConn.sendIQ(iq.tree(), function (msgInfo) {\n\t\t\t\t\t// console.log(msgInfo);\n\n\t\t\t\t\t// for ie hack\n\t\t\t\t\tif ('setAttribute' in msgInfo) {\n\t\t\t\t\t\t// Strophe.info('step 3 ----------');\n\t\t\t\t\t\tvar x = msgInfo.getElementsByTagName('x')[0];\n\t\t\t\t\t\tx.setAttribute('type', 'submit');\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Strophe.info('step 4 ----------');\n\t\t\t\t\t\tStrophe.forEachChild(msgInfo, 'x', function (field) {\n\t\t\t\t\t\t\tfield.setAttribute('type', 'submit');\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tStrophe.info('step 5 ----------');\n\t\t\t\t\tStrophe.forEachChild(x, 'field', function (field) {\n\t\t\t\t\t\tvar fieldVar = field.getAttribute('var');\n\t\t\t\t\t\tvar valueDom = field.getElementsByTagName('value')[0];\n\t\t\t\t\t\tStrophe.info(fieldVar);\n\t\t\t\t\t\tswitch (fieldVar) {\n\t\t\t\t\t\t\tcase 'muc#roomconfig_maxusers':\n\t\t\t\t\t\t\t\t_setText(valueDom, options.optionsMaxUsers || 200);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'muc#roomconfig_roomname':\n\t\t\t\t\t\t\t\t_setText(valueDom, options.subject || '');\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'muc#roomconfig_roomdesc':\n\t\t\t\t\t\t\t\t_setText(valueDom, options.description || '');\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'muc#roomconfig_publicroom':\n\t\t\t\t\t\t\t\t// public 1\n\t\t\t\t\t\t\t\t_setText(valueDom, +options.optionsPublic);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'muc#roomconfig_membersonly':\n\t\t\t\t\t\t\t\t_setText(valueDom, +options.optionsMembersOnly);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'muc#roomconfig_moderatedroom':\n\t\t\t\t\t\t\t\t_setText(valueDom, +options.optionsModerate);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'muc#roomconfig_persistentroom':\n\t\t\t\t\t\t\t\t_setText(valueDom, 1);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'muc#roomconfig_allowinvites':\n\t\t\t\t\t\t\t\t_setText(valueDom, +options.optionsAllowInvites);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'muc#roomconfig_allowvisitornickchange':\n\t\t\t\t\t\t\t\t_setText(valueDom, 0);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'muc#roomconfig_allowvisitorstatus':\n\t\t\t\t\t\t\t\t_setText(valueDom, 0);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'allow_private_messages':\n\t\t\t\t\t\t\t\t_setText(valueDom, 0);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'allow_private_messages_from_visitors':\n\t\t\t\t\t\t\t\t_setText(valueDom, 'nobody');\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tvar iq = $iq({ to: toRoom, type: 'set' }).c('query', { xmlns: 'http://jabber.org/protocol/muc#owner' }).cnode(x);\n\n\t\t\t\t\tme.context.stropheConn.sendIQ(iq.tree(), function (msgInfo) {\n\t\t\t\t\t\tme.addGroupMembers({\n\t\t\t\t\t\t\tlist: options.members,\n\t\t\t\t\t\t\troomId: roomId\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tsuc(options);\n\t\t\t\t\t}, function (errInfo) {\n\t\t\t\t\t\t// errFn(errInfo);\n\t\t\t\t\t});\n\t\t\t\t\t// sucFn(msgInfo);\n\t\t\t\t}, function (errInfo) {\n\t\t\t\t\t// errFn(errInfo);\n\t\t\t\t});\n\t\t\t};\n\n\t\t\t/**\n    * createGroup 创建群组\n    *\n    * 1. 创建申请 -> 得到房主身份\n    * 2. 获取房主信息 -> 得到房间form\n    * 3. 完善房间form -> 创建成功\n    * 4. 添加房间成员\n    * 5. 消息通知成员\n    * @param options\n    */\n\t\t\tconnection.prototype.createGroup = function (options) {\n\t\t\t\tthis.groupOption = options;\n\t\t\t\tvar roomId = +new Date();\n\t\t\t\tvar toRoom = this._getGroupJid(roomId);\n\t\t\t\tvar to = toRoom + '/' + this.context.userId;\n\n\t\t\t\tvar pres = $pres({ to: to }).c('x', { xmlns: 'http://jabber.org/protocol/muc' }).up().c('create', { xmlns: 'http://jabber.org/protocol/muc' }).up();\n\n\t\t\t\t// createGroupACK\n\t\t\t\tthis.sendCommand(pres.tree());\n\t\t\t};\n\t\t\t// 通过Rest接口创建群组\n\t\t\tconnection.prototype.createGroupNew = function (options) {\n\t\t\t\toptions.success = function (respData) {\n\t\t\t\t\tthis.onCreateGroup(respData);\n\t\t\t\t}.bind(this);\n\t\t\t\tWebIM.utils.ajax(options);\n\t\t\t};\n\n\t\t\t/**\n    * shieldGroup 屏蔽群组\n    * @param valueDom\n    * @param v\n    * @private\n    */\n\t\t\tconnection.prototype.shieldGroup = function (options) {\n\t\t\t\tWebIM.utils.ajax(options);\n\t\t\t};\n\n\t\t\tfunction _setText(valueDom, v) {\n\t\t\t\tif ('textContent' in valueDom) {\n\t\t\t\t\tvalueDom.textContent = v;\n\t\t\t\t} else if ('text' in valueDom) {\n\t\t\t\t\tvalueDom.text = v;\n\t\t\t\t} else {\n\t\t\t\t\t// Strophe.info('_setText 4 ----------');\n\t\t\t\t\t// valueDom.innerHTML = v;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar WebIM = window.WebIM || {};\n\t\t\tWebIM.connection = connection;\n\t\t\tWebIM.utils = _utils;\n\t\t\tWebIM.statusCode = _code;\n\t\t\tWebIM.message = _msg.message;\n\t\t\tWebIM.doQuery = function (str, suc, fail) {\n\t\t\t\tif (typeof window.cefQuery === 'undefined') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\twindow.cefQuery({\n\t\t\t\t\trequest: str,\n\t\t\t\t\tpersistent: false,\n\t\t\t\t\tonSuccess: suc,\n\t\t\t\t\tonFailure: fail\n\t\t\t\t});\n\t\t\t};\n\n\t\t\t/**************************** debug ****************************/\n\t\t\tfunction logMessage(message) {\n\t\t\t\tWebIM && WebIM.config.isDebug && console.log(WebIM.utils.ts() + '[recv] ', message.data);\n\t\t\t}\n\n\t\t\tif (WebIM && WebIM.config.isDebug) {\n\t\t\t\tStrophe.Connection.prototype.rawOutput = function (data) {\n\t\t\t\t\tconsole.log('%c ' + WebIM.utils.ts() + '[send] ' + data, \"background-color: #e2f7da\");\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (WebIM && WebIM.config && WebIM.config.isSandBox) {\n\t\t\t\tWebIM.config.xmppURL = WebIM.config.xmppURL.replace('.easemob.', '-sandbox.easemob.');\n\t\t\t\tWebIM.config.apiURL = WebIM.config.apiURL.replace('.easemob.', '-sdb.easemob.');\n\t\t\t}\n\n\t\t\tmodule.exports = WebIM;\n\n\t\t\tif (false) {\n\t\t\t\tmodule.hot.accept();\n\t\t\t}\n\n\t\t\t/***/\n\t\t},\n\t\t/* 2 */\n\t\t/***/function (module, exports) {\n\n\t\t\t;\n\t\t\t(function () {\n\n\t\t\t\texports.code = {\n\t\t\t\t\tWEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR: 0,\n\t\t\t\t\tWEBIM_CONNCTION_OPEN_ERROR: 1,\n\t\t\t\t\tWEBIM_CONNCTION_AUTH_ERROR: 2,\n\t\t\t\t\tWEBIM_CONNCTION_OPEN_USERGRID_ERROR: 3,\n\t\t\t\t\tWEBIM_CONNCTION_ATTACH_ERROR: 4,\n\t\t\t\t\tWEBIM_CONNCTION_ATTACH_USERGRID_ERROR: 5,\n\t\t\t\t\tWEBIM_CONNCTION_REOPEN_ERROR: 6,\n\t\t\t\t\tWEBIM_CONNCTION_SERVER_CLOSE_ERROR: 7, //7: client-side network offline (net::ERR_INTERNET_DISCONNECTED)\n\t\t\t\t\tWEBIM_CONNCTION_SERVER_ERROR: 8, //8: offline by multi login\n\t\t\t\t\tWEBIM_CONNCTION_IQ_ERROR: 9,\n\n\t\t\t\t\tWEBIM_CONNCTION_PING_ERROR: 10,\n\t\t\t\t\tWEBIM_CONNCTION_NOTIFYVERSION_ERROR: 11,\n\t\t\t\t\tWEBIM_CONNCTION_GETROSTER_ERROR: 12,\n\t\t\t\t\tWEBIM_CONNCTION_CROSSDOMAIN_ERROR: 13,\n\t\t\t\t\tWEBIM_CONNCTION_LISTENING_OUTOF_MAXRETRIES: 14,\n\t\t\t\t\tWEBIM_CONNCTION_RECEIVEMSG_CONTENTERROR: 15,\n\t\t\t\t\tWEBIM_CONNCTION_DISCONNECTED: 16, //16: server-side close the websocket connection\n\t\t\t\t\tWEBIM_CONNCTION_AJAX_ERROR: 17,\n\t\t\t\t\tWEBIM_CONNCTION_JOINROOM_ERROR: 18,\n\t\t\t\t\tWEBIM_CONNCTION_GETROOM_ERROR: 19,\n\n\t\t\t\t\tWEBIM_CONNCTION_GETROOMINFO_ERROR: 20,\n\t\t\t\t\tWEBIM_CONNCTION_GETROOMMEMBER_ERROR: 21,\n\t\t\t\t\tWEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR: 22,\n\t\t\t\t\tWEBIM_CONNCTION_LOAD_CHATROOM_ERROR: 23,\n\t\t\t\t\tWEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR: 24,\n\t\t\t\t\tWEBIM_CONNCTION_JOINCHATROOM_ERROR: 25,\n\t\t\t\t\tWEBIM_CONNCTION_QUITCHATROOM_ERROR: 26,\n\t\t\t\t\tWEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR: 27,\n\t\t\t\t\tWEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR: 28,\n\t\t\t\t\tWEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR: 29,\n\n\t\t\t\t\tWEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR: 30,\n\t\t\t\t\tWEBIM_CONNCTION_CALLBACK_INNER_ERROR: 31, //31: 处理下行消息出错 try/catch抛出异常\n\t\t\t\t\tWEBIM_CONNCTION_CLIENT_OFFLINE: 32, //32: client offline\n\t\t\t\t\tWEBIM_CONNCTION_CLIENT_LOGOUT: 33, //33: client logout\n\t\t\t\t\tWEBIM_CONNCTION_CLIENT_TOO_MUCH_ERROR: 34, // 34: Over amount of the tabs a user opened in the same browser\n\t\t\t\t\tWEBIM_CONNECTION_ACCEPT_INVITATION_FROM_GROUP: 35,\n\t\t\t\t\tWEBIM_CONNECTION_DECLINE_INVITATION_FROM_GROUP: 36,\n\t\t\t\t\tWEBIM_CONNECTION_ACCEPT_JOIN_GROUP: 37,\n\t\t\t\t\tWEBIM_CONNECTION_DECLINE_JOIN_GROUP: 38,\n\t\t\t\t\tWEBIM_CONNECTION_CLOSED: 39,\n\n\t\t\t\t\tWEBIM_UPLOADFILE_BROWSER_ERROR: 100,\n\t\t\t\t\tWEBIM_UPLOADFILE_ERROR: 101,\n\t\t\t\t\tWEBIM_UPLOADFILE_NO_LOGIN: 102,\n\t\t\t\t\tWEBIM_UPLOADFILE_NO_FILE: 103,\n\n\t\t\t\t\tWEBIM_DOWNLOADFILE_ERROR: 200,\n\t\t\t\t\tWEBIM_DOWNLOADFILE_NO_LOGIN: 201,\n\t\t\t\t\tWEBIM_DOWNLOADFILE_BROWSER_ERROR: 202,\n\n\t\t\t\t\tWEBIM_MESSAGE_REC_TEXT: 300,\n\t\t\t\t\tWEBIM_MESSAGE_REC_TEXT_ERROR: 301,\n\t\t\t\t\tWEBIM_MESSAGE_REC_EMOTION: 302,\n\t\t\t\t\tWEBIM_MESSAGE_REC_PHOTO: 303,\n\t\t\t\t\tWEBIM_MESSAGE_REC_AUDIO: 304,\n\t\t\t\t\tWEBIM_MESSAGE_REC_AUDIO_FILE: 305,\n\t\t\t\t\tWEBIM_MESSAGE_REC_VEDIO: 306,\n\t\t\t\t\tWEBIM_MESSAGE_REC_VEDIO_FILE: 307,\n\t\t\t\t\tWEBIM_MESSAGE_REC_FILE: 308,\n\t\t\t\t\tWEBIM_MESSAGE_SED_TEXT: 309,\n\t\t\t\t\tWEBIM_MESSAGE_SED_EMOTION: 310,\n\t\t\t\t\tWEBIM_MESSAGE_SED_PHOTO: 311,\n\t\t\t\t\tWEBIM_MESSAGE_SED_AUDIO: 312,\n\t\t\t\t\tWEBIM_MESSAGE_SED_AUDIO_FILE: 313,\n\t\t\t\t\tWEBIM_MESSAGE_SED_VEDIO: 314,\n\t\t\t\t\tWEBIM_MESSAGE_SED_VEDIO_FILE: 315,\n\t\t\t\t\tWEBIM_MESSAGE_SED_FILE: 316,\n\t\t\t\t\tWEBIM_MESSAGE_SED_ERROR: 317,\n\n\t\t\t\t\tSTATUS_INIT: 400,\n\t\t\t\t\tSTATUS_DOLOGIN_USERGRID: 401,\n\t\t\t\t\tSTATUS_DOLOGIN_IM: 402,\n\t\t\t\t\tSTATUS_OPENED: 403,\n\t\t\t\t\tSTATUS_CLOSING: 404,\n\t\t\t\t\tSTATUS_CLOSED: 405,\n\t\t\t\t\tSTATUS_ERROR: 406\n\t\t\t\t};\n\t\t\t})();\n\n\t\t\t/***/\n\t\t},\n\t\t/* 3 */\n\t\t/***/function (module, exports, __webpack_require__) {\n\n\t\t\t;\n\t\t\t(function () {\n\n\t\t\t\tvar EMPTYFN = function EMPTYFN() {};\n\t\t\t\tvar _code = __webpack_require__(2).code;\n\t\t\t\tvar WEBIM_FILESIZE_LIMIT = 10485760;\n\n\t\t\t\tvar _createStandardXHR = function _createStandardXHR() {\n\t\t\t\t\ttry {\n\t\t\t\t\t\treturn new window.XMLHttpRequest();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tvar _createActiveXHR = function _createActiveXHR() {\n\t\t\t\t\ttry {\n\t\t\t\t\t\treturn new window.ActiveXObject('Microsoft.XMLHTTP');\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tvar _xmlrequest = function _xmlrequest(crossDomain) {\n\t\t\t\t\tcrossDomain = crossDomain || true;\n\t\t\t\t\tvar temp = _createStandardXHR() || _createActiveXHR();\n\n\t\t\t\t\tif ('withCredentials' in temp) {\n\t\t\t\t\t\treturn temp;\n\t\t\t\t\t}\n\t\t\t\t\tif (!crossDomain) {\n\t\t\t\t\t\treturn temp;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof window.XDomainRequest === 'undefined') {\n\t\t\t\t\t\treturn temp;\n\t\t\t\t\t}\n\t\t\t\t\tvar xhr = new XDomainRequest();\n\t\t\t\t\txhr.readyState = 0;\n\t\t\t\t\txhr.status = 100;\n\t\t\t\t\txhr.onreadystatechange = EMPTYFN;\n\t\t\t\t\txhr.onload = function () {\n\t\t\t\t\t\txhr.readyState = 4;\n\t\t\t\t\t\txhr.status = 200;\n\n\t\t\t\t\t\tvar xmlDoc = new ActiveXObject('Microsoft.XMLDOM');\n\t\t\t\t\t\txmlDoc.async = 'false';\n\t\t\t\t\t\txmlDoc.loadXML(xhr.responseText);\n\t\t\t\t\t\txhr.responseXML = xmlDoc;\n\t\t\t\t\t\txhr.response = xhr.responseText;\n\t\t\t\t\t\txhr.onreadystatechange();\n\t\t\t\t\t};\n\t\t\t\t\txhr.ontimeout = xhr.onerror = function () {\n\t\t\t\t\t\txhr.readyState = 4;\n\t\t\t\t\t\txhr.status = 500;\n\t\t\t\t\t\txhr.onreadystatechange();\n\t\t\t\t\t};\n\t\t\t\t\treturn xhr;\n\t\t\t\t};\n\n\t\t\t\tvar _hasFlash = function () {\n\t\t\t\t\tif ('ActiveXObject' in window) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\treturn new ActiveXObject('ShockwaveFlash.ShockwaveFlash');\n\t\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (navigator.plugins && navigator.plugins.length > 0) {\n\t\t\t\t\t\t\treturn navigator.plugins['Shockwave Flash'];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn 0;\n\t\t\t\t}();\n\n\t\t\t\tvar _base64 = function _base64() {\n\n\t\t\t\t\tvar self = this;\n\n\t\t\t\t\t// private property\n\t\t\t\t\tvar _keyStr = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n\n\t\t\t\t\t// public method for encoding\n\t\t\t\t\tthis.encode = function (input) {\n\t\t\t\t\t\tvar output = \"\";\n\t\t\t\t\t\tvar chr1, chr2, chr3, enc1, enc2, enc3, enc4;\n\t\t\t\t\t\tvar i = 0;\n\t\t\t\t\t\tinput = self._utf8_encode(input);\n\t\t\t\t\t\twhile (i < input.length) {\n\t\t\t\t\t\t\tchr1 = input.charCodeAt(i++);\n\t\t\t\t\t\t\tchr2 = input.charCodeAt(i++);\n\t\t\t\t\t\t\tchr3 = input.charCodeAt(i++);\n\t\t\t\t\t\t\tenc1 = chr1 >> 2;\n\t\t\t\t\t\t\tenc2 = (chr1 & 3) << 4 | chr2 >> 4;\n\t\t\t\t\t\t\tenc3 = (chr2 & 15) << 2 | chr3 >> 6;\n\t\t\t\t\t\t\tenc4 = chr3 & 63;\n\t\t\t\t\t\t\tif (isNaN(chr2)) {\n\t\t\t\t\t\t\t\tenc3 = enc4 = 64;\n\t\t\t\t\t\t\t} else if (isNaN(chr3)) {\n\t\t\t\t\t\t\t\tenc4 = 64;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\toutput = output + _keyStr.charAt(enc1) + _keyStr.charAt(enc2) + _keyStr.charAt(enc3) + _keyStr.charAt(enc4);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn output;\n\t\t\t\t\t};\n\n\t\t\t\t\t// public method for decoding\n\t\t\t\t\tthis.decode = function (input) {\n\t\t\t\t\t\tvar output = \"\";\n\t\t\t\t\t\tvar chr1, chr2, chr3;\n\t\t\t\t\t\tvar enc1, enc2, enc3, enc4;\n\t\t\t\t\t\tvar i = 0;\n\t\t\t\t\t\tinput = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\n\t\t\t\t\t\twhile (i < input.length) {\n\t\t\t\t\t\t\tenc1 = _keyStr.indexOf(input.charAt(i++));\n\t\t\t\t\t\t\tenc2 = _keyStr.indexOf(input.charAt(i++));\n\t\t\t\t\t\t\tenc3 = _keyStr.indexOf(input.charAt(i++));\n\t\t\t\t\t\t\tenc4 = _keyStr.indexOf(input.charAt(i++));\n\t\t\t\t\t\t\tchr1 = enc1 << 2 | enc2 >> 4;\n\t\t\t\t\t\t\tchr2 = (enc2 & 15) << 4 | enc3 >> 2;\n\t\t\t\t\t\t\tchr3 = (enc3 & 3) << 6 | enc4;\n\t\t\t\t\t\t\toutput = output + String.fromCharCode(chr1);\n\t\t\t\t\t\t\tif (enc3 != 64) {\n\t\t\t\t\t\t\t\toutput = output + String.fromCharCode(chr2);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (enc4 != 64) {\n\t\t\t\t\t\t\t\toutput = output + String.fromCharCode(chr3);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\toutput = self._utf8_decode(output);\n\t\t\t\t\t\treturn output;\n\t\t\t\t\t};\n\n\t\t\t\t\t// private method for UTF-8 encoding\n\t\t\t\t\tthis._utf8_encode = function (string) {\n\t\t\t\t\t\tstring = string.replace(/\\r\\n/g, \"\\n\");\n\t\t\t\t\t\tvar utftext = \"\";\n\t\t\t\t\t\tfor (var n = 0; n < string.length; n++) {\n\t\t\t\t\t\t\tvar c = string.charCodeAt(n);\n\t\t\t\t\t\t\tif (c < 128) {\n\t\t\t\t\t\t\t\tutftext += String.fromCharCode(c);\n\t\t\t\t\t\t\t} else if (c > 127 && c < 2048) {\n\t\t\t\t\t\t\t\tutftext += String.fromCharCode(c >> 6 | 192);\n\t\t\t\t\t\t\t\tutftext += String.fromCharCode(c & 63 | 128);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tutftext += String.fromCharCode(c >> 12 | 224);\n\t\t\t\t\t\t\t\tutftext += String.fromCharCode(c >> 6 & 63 | 128);\n\t\t\t\t\t\t\t\tutftext += String.fromCharCode(c & 63 | 128);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn utftext;\n\t\t\t\t\t};\n\n\t\t\t\t\t// private method for UTF-8 decoding\n\t\t\t\t\tthis._utf8_decode = function (utftext) {\n\t\t\t\t\t\tvar string = \"\";\n\t\t\t\t\t\tvar i = 0;\n\t\t\t\t\t\tvar c = 0;\n\t\t\t\t\t\tvar c1 = 0;\n\t\t\t\t\t\tvar c2 = 0;\n\t\t\t\t\t\tvar c3 = 0;\n\t\t\t\t\t\twhile (i < utftext.length) {\n\t\t\t\t\t\t\tc = utftext.charCodeAt(i);\n\t\t\t\t\t\t\tif (c < 128) {\n\t\t\t\t\t\t\t\tstring += String.fromCharCode(c);\n\t\t\t\t\t\t\t\ti++;\n\t\t\t\t\t\t\t} else if (c > 191 && c < 224) {\n\t\t\t\t\t\t\t\tc2 = utftext.charCodeAt(i + 1);\n\t\t\t\t\t\t\t\tstring += String.fromCharCode((c & 31) << 6 | c2 & 63);\n\t\t\t\t\t\t\t\ti += 2;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tc2 = utftext.charCodeAt(i + 1);\n\t\t\t\t\t\t\t\tc3 = utftext.charCodeAt(i + 2);\n\t\t\t\t\t\t\t\tstring += String.fromCharCode((c & 15) << 12 | (c2 & 63) << 6 | c3 & 63);\n\t\t\t\t\t\t\t\ti += 3;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn string;\n\t\t\t\t\t};\n\t\t\t\t};\n\n\t\t\t\tvar _tmpUtilXHR = _xmlrequest(),\n\t\t\t\t    _hasFormData = typeof FormData !== 'undefined',\n\t\t\t\t    _hasBlob = typeof Blob !== 'undefined',\n\t\t\t\t    _isCanSetRequestHeader = _tmpUtilXHR.setRequestHeader || false,\n\t\t\t\t    _hasOverrideMimeType = _tmpUtilXHR.overrideMimeType || false,\n\t\t\t\t    _isCanUploadFileAsync = _isCanSetRequestHeader && _hasFormData,\n\t\t\t\t    _isCanUploadFile = _isCanUploadFileAsync || _hasFlash,\n\t\t\t\t    _isCanDownLoadFile = _isCanSetRequestHeader && (_hasBlob || _hasOverrideMimeType);\n\n\t\t\t\tif (!Object.keys) {\n\t\t\t\t\tObject.keys = function () {\n\t\t\t\t\t\t'use strict';\n\n\t\t\t\t\t\tvar hasOwnProperty = Object.prototype.hasOwnProperty,\n\t\t\t\t\t\t    hasDontEnumBug = !{ toString: null }.propertyIsEnumerable('toString'),\n\t\t\t\t\t\t    dontEnums = ['toString', 'toLocaleString', 'valueOf', 'hasOwnProperty', 'isPrototypeOf', 'propertyIsEnumerable', 'constructor'],\n\t\t\t\t\t\t    dontEnumsLength = dontEnums.length;\n\n\t\t\t\t\t\treturn function (obj) {\n\t\t\t\t\t\t\tif ((typeof obj === 'undefined' ? 'undefined' : _typeof(obj)) !== 'object' && (typeof obj !== 'function' || obj === null)) {\n\t\t\t\t\t\t\t\tthrow new TypeError('Object.keys called on non-object');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tvar result = [],\n\t\t\t\t\t\t\t    prop,\n\t\t\t\t\t\t\t    i;\n\n\t\t\t\t\t\t\tfor (prop in obj) {\n\t\t\t\t\t\t\t\tif (hasOwnProperty.call(obj, prop)) {\n\t\t\t\t\t\t\t\t\tresult.push(prop);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (hasDontEnumBug) {\n\t\t\t\t\t\t\t\tfor (i = 0; i < dontEnumsLength; i++) {\n\t\t\t\t\t\t\t\t\tif (hasOwnProperty.call(obj, dontEnums[i])) {\n\t\t\t\t\t\t\t\t\t\tresult.push(dontEnums[i]);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn result;\n\t\t\t\t\t\t};\n\t\t\t\t\t}();\n\t\t\t\t}\n\n\t\t\t\tvar utils = {\n\t\t\t\t\thasFormData: _hasFormData,\n\n\t\t\t\t\thasBlob: _hasBlob,\n\n\t\t\t\t\temptyfn: EMPTYFN,\n\n\t\t\t\t\tisCanSetRequestHeader: _isCanSetRequestHeader,\n\n\t\t\t\t\thasOverrideMimeType: _hasOverrideMimeType,\n\n\t\t\t\t\tisCanUploadFileAsync: _isCanUploadFileAsync,\n\n\t\t\t\t\tisCanUploadFile: _isCanUploadFile,\n\n\t\t\t\t\tisCanDownLoadFile: _isCanDownLoadFile,\n\n\t\t\t\t\tisSupportWss: function () {\n\t\t\t\t\t\tvar notSupportList = [\n\t\t\t\t\t\t//1: QQ browser X5 core\n\t\t\t\t\t\t/MQQBrowser[\\/]5([.]\\d+)?\\sTBS/\n\n\t\t\t\t\t\t//2: etc.\n\t\t\t\t\t\t//...\n\t\t\t\t\t\t];\n\n\t\t\t\t\t\tif (!window.WebSocket) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar ua = window.navigator.userAgent;\n\t\t\t\t\t\tfor (var i = 0, l = notSupportList.length; i < l; i++) {\n\t\t\t\t\t\t\tif (notSupportList[i].test(ua)) {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}(),\n\n\t\t\t\t\tgetIEVersion: function () {\n\t\t\t\t\t\tvar ua = navigator.userAgent,\n\t\t\t\t\t\t    matches,\n\t\t\t\t\t\t    tridentMap = { '4': 8, '5': 9, '6': 10, '7': 11 };\n\n\t\t\t\t\t\tmatches = ua.match(/MSIE (\\d+)/i);\n\n\t\t\t\t\t\tif (matches && matches[1]) {\n\t\t\t\t\t\t\treturn +matches[1];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tmatches = ua.match(/Trident\\/(\\d+)/i);\n\t\t\t\t\t\tif (matches && matches[1]) {\n\t\t\t\t\t\t\treturn tridentMap[matches[1]] || null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}(),\n\n\t\t\t\t\tstringify: function stringify(json) {\n\t\t\t\t\t\tif (typeof JSON !== 'undefined' && JSON.stringify) {\n\t\t\t\t\t\t\treturn JSON.stringify(json);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar s = '',\n\t\t\t\t\t\t\t    arr = [];\n\n\t\t\t\t\t\t\tvar iterate = function iterate(json) {\n\t\t\t\t\t\t\t\tvar isArr = false;\n\n\t\t\t\t\t\t\t\tif (Object.prototype.toString.call(json) === '[object Array]') {\n\t\t\t\t\t\t\t\t\tarr.push(']', '[');\n\t\t\t\t\t\t\t\t\tisArr = true;\n\t\t\t\t\t\t\t\t} else if (Object.prototype.toString.call(json) === '[object Object]') {\n\t\t\t\t\t\t\t\t\tarr.push('}', '{');\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfor (var o in json) {\n\t\t\t\t\t\t\t\t\tif (Object.prototype.toString.call(json[o]) === '[object Null]') {\n\t\t\t\t\t\t\t\t\t\tjson[o] = 'null';\n\t\t\t\t\t\t\t\t\t} else if (Object.prototype.toString.call(json[o]) === '[object Undefined]') {\n\t\t\t\t\t\t\t\t\t\tjson[o] = 'undefined';\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (json[o] && _typeof(json[o]) === 'object') {\n\t\t\t\t\t\t\t\t\t\ts += ',' + (isArr ? '' : '\"' + o + '\":' + (isArr ? '\"' : '')) + iterate(json[o]) + '';\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\ts += ',\"' + (isArr ? '' : o + '\":\"') + json[o] + '\"';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (s != '') {\n\t\t\t\t\t\t\t\t\ts = s.slice(1);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn arr.pop() + s + arr.pop();\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\treturn iterate(json);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tlogin: function login(options) {\n\t\t\t\t\t\tvar options = options || {};\n\t\t\t\t\t\tvar suc = options.success || EMPTYFN;\n\t\t\t\t\t\tvar err = options.error || EMPTYFN;\n\n\t\t\t\t\t\tvar appKey = options.appKey || '';\n\t\t\t\t\t\tvar devInfos = appKey.split('#');\n\t\t\t\t\t\tif (devInfos.length !== 2) {\n\t\t\t\t\t\t\terr({\n\t\t\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar orgName = devInfos[0];\n\t\t\t\t\t\tvar appName = devInfos[1];\n\t\t\t\t\t\tvar https = https || options.https;\n\t\t\t\t\t\tvar user = options.user || '';\n\t\t\t\t\t\tvar pwd = options.pwd || '';\n\n\t\t\t\t\t\tvar apiUrl = options.apiUrl;\n\n\t\t\t\t\t\tvar loginJson = {\n\t\t\t\t\t\t\tgrant_type: 'password',\n\t\t\t\t\t\t\tusername: user,\n\t\t\t\t\t\t\tpassword: pwd,\n\t\t\t\t\t\t\ttimestamp: +new Date()\n\t\t\t\t\t\t};\n\t\t\t\t\t\tvar loginfo = utils.stringify(loginJson);\n\n\t\t\t\t\t\tvar options = {\n\t\t\t\t\t\t\turl: apiUrl + '/' + orgName + '/' + appName + '/token',\n\t\t\t\t\t\t\tdataType: 'json',\n\t\t\t\t\t\t\tdata: loginfo,\n\t\t\t\t\t\t\tsuccess: suc,\n\t\t\t\t\t\t\terror: err\n\t\t\t\t\t\t};\n\t\t\t\t\t\treturn utils.ajax(options);\n\t\t\t\t\t},\n\n\t\t\t\t\tgetFileUrl: function getFileUrl(fileInputId) {\n\t\t\t\t\t\tvar uri = {\n\t\t\t\t\t\t\turl: '',\n\t\t\t\t\t\t\tfilename: '',\n\t\t\t\t\t\t\tfiletype: '',\n\t\t\t\t\t\t\tdata: ''\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tvar fileObj = typeof fileInputId === 'string' ? document.getElementById(fileInputId) : fileInputId;\n\n\t\t\t\t\t\tif (!utils.isCanUploadFileAsync || !fileObj) {\n\t\t\t\t\t\t\treturn uri;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (window.URL.createObjectURL) {\n\t\t\t\t\t\t\t\tvar fileItems = fileObj.files;\n\t\t\t\t\t\t\t\tif (fileItems.length > 0) {\n\t\t\t\t\t\t\t\t\tvar u = fileItems.item(0);\n\t\t\t\t\t\t\t\t\turi.data = u;\n\t\t\t\t\t\t\t\t\turi.url = window.URL.createObjectURL(u);\n\t\t\t\t\t\t\t\t\turi.filename = u.name || '';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// IE\n\t\t\t\t\t\t\t\tvar u = document.getElementById(fileInputId).value;\n\t\t\t\t\t\t\t\turi.url = u;\n\t\t\t\t\t\t\t\tvar pos1 = u.lastIndexOf('/');\n\t\t\t\t\t\t\t\tvar pos2 = u.lastIndexOf('\\\\');\n\t\t\t\t\t\t\t\tvar pos = Math.max(pos1, pos2);\n\t\t\t\t\t\t\t\tif (pos < 0) uri.filename = u;else uri.filename = u.substring(pos + 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvar index = uri.filename.lastIndexOf('.');\n\t\t\t\t\t\t\tif (index != -1) {\n\t\t\t\t\t\t\t\turi.filetype = uri.filename.substring(index + 1).toLowerCase();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn uri;\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tthrow e;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\tgetFileSize: function getFileSize(file) {\n\t\t\t\t\t\tvar fileSize = this.getFileLength(file);\n\t\t\t\t\t\tif (fileSize > 10000000) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar kb = Math.round(fileSize / 1000);\n\t\t\t\t\t\tif (kb < 1000) {\n\t\t\t\t\t\t\tfileSize = kb + ' KB';\n\t\t\t\t\t\t} else if (kb >= 1000) {\n\t\t\t\t\t\t\tvar mb = kb / 1000;\n\t\t\t\t\t\t\tif (mb < 1000) {\n\t\t\t\t\t\t\t\tfileSize = mb.toFixed(1) + ' MB';\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvar gb = mb / 1000;\n\t\t\t\t\t\t\t\tfileSize = gb.toFixed(1) + ' GB';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn fileSize;\n\t\t\t\t\t},\n\n\t\t\t\t\tgetFileLength: function getFileLength(file) {\n\t\t\t\t\t\tvar fileLength = 0;\n\t\t\t\t\t\tif (file) {\n\t\t\t\t\t\t\tif (file.files) {\n\t\t\t\t\t\t\t\tif (file.files.length > 0) {\n\t\t\t\t\t\t\t\t\tfileLength = file.files[0].size;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (file.select && 'ActiveXObject' in window) {\n\t\t\t\t\t\t\t\tfile.select();\n\t\t\t\t\t\t\t\tvar fileobject = new ActiveXObject('Scripting.FileSystemObject');\n\t\t\t\t\t\t\t\tvar file = fileobject.GetFile(file.value);\n\t\t\t\t\t\t\t\tfileLength = file.Size;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn fileLength;\n\t\t\t\t\t},\n\n\t\t\t\t\thasFlash: _hasFlash,\n\n\t\t\t\t\ttrim: function trim(str) {\n\n\t\t\t\t\t\tstr = typeof str === 'string' ? str : '';\n\n\t\t\t\t\t\treturn str.trim ? str.trim() : str.replace(/^\\s|\\s$/g, '');\n\t\t\t\t\t},\n\n\t\t\t\t\tparseEmoji: function parseEmoji(msg) {\n\t\t\t\t\t\tif (typeof WebIM.Emoji === 'undefined' || typeof WebIM.Emoji.map === 'undefined') {\n\t\t\t\t\t\t\treturn msg;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar emoji = WebIM.Emoji,\n\t\t\t\t\t\t\t    reg = null;\n\n\t\t\t\t\t\t\tfor (var face in emoji.map) {\n\t\t\t\t\t\t\t\tif (emoji.map.hasOwnProperty(face)) {\n\t\t\t\t\t\t\t\t\twhile (msg.indexOf(face) > -1) {\n\t\t\t\t\t\t\t\t\t\tmsg = msg.replace(face, '<img class=\"emoji\" src=\"' + emoji.path + emoji.map[face] + '\" />');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn msg;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\tparseLink: function parseLink(msg) {\n\n\t\t\t\t\t\tvar reg = /(https?\\:\\/\\/|www\\.)([a-zA-Z0-9-]+(\\.[a-zA-Z0-9]+)+)(\\:[0-9]{2,4})?\\/?((\\.[:_0-9a-zA-Z-]+)|[:_0-9a-zA-Z-]*\\/?)*\\??[:_#@*&%0-9a-zA-Z-/=]*/gm;\n\n\t\t\t\t\t\tmsg = msg.replace(reg, function (v) {\n\n\t\t\t\t\t\t\tvar prefix = /^https?/gm.test(v);\n\n\t\t\t\t\t\t\treturn \"<a href='\" + (prefix ? v : '//' + v) + \"' target='_blank'>\" + v + \"</a>\";\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn msg;\n\t\t\t\t\t},\n\n\t\t\t\t\tparseJSON: function parseJSON(data) {\n\n\t\t\t\t\t\tif (window.JSON && window.JSON.parse) {\n\t\t\t\t\t\t\treturn window.JSON.parse(data + '');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar requireNonComma,\n\t\t\t\t\t\t    depth = null,\n\t\t\t\t\t\t    str = utils.trim(data + '');\n\n\t\t\t\t\t\treturn str && !utils.trim(str.replace(/(,)|(\\[|{)|(}|])|\"(?:[^\"\\\\\\r\\n]|\\\\[\"\\\\\\/bfnrt]|\\\\u[\\da-fA-F]{4})*\"\\s*:?|true|false|null|-?(?!0\\d)\\d+(?:\\.\\d+|)(?:[eE][+-]?\\d+|)/g, function (token, comma, open, close) {\n\n\t\t\t\t\t\t\tif (requireNonComma && comma) {\n\t\t\t\t\t\t\t\tdepth = 0;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (depth === 0) {\n\t\t\t\t\t\t\t\treturn token;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\trequireNonComma = open || comma;\n\t\t\t\t\t\t\tdepth += !close - !open;\n\t\t\t\t\t\t\treturn '';\n\t\t\t\t\t\t})) ? Function('return ' + str)() : Function('Invalid JSON: ' + data)();\n\t\t\t\t\t},\n\n\t\t\t\t\tparseUploadResponse: function parseUploadResponse(response) {\n\t\t\t\t\t\treturn response.indexOf('callback') > -1 ? //lte ie9\n\t\t\t\t\t\tresponse.slice(9, -1) : response;\n\t\t\t\t\t},\n\n\t\t\t\t\tparseDownloadResponse: function parseDownloadResponse(response) {\n\t\t\t\t\t\treturn response && response.type && response.type === 'application/json' || 0 > Object.prototype.toString.call(response).indexOf('Blob') ? this.url + '?token=' : window.URL.createObjectURL(response);\n\t\t\t\t\t},\n\n\t\t\t\t\tuploadFile: function uploadFile(options) {\n\t\t\t\t\t\tvar options = options || {};\n\t\t\t\t\t\toptions.onFileUploadProgress = options.onFileUploadProgress || EMPTYFN;\n\t\t\t\t\t\toptions.onFileUploadComplete = options.onFileUploadComplete || EMPTYFN;\n\t\t\t\t\t\toptions.onFileUploadError = options.onFileUploadError || EMPTYFN;\n\t\t\t\t\t\toptions.onFileUploadCanceled = options.onFileUploadCanceled || EMPTYFN;\n\n\t\t\t\t\t\tvar acc = options.accessToken || this.context.accessToken;\n\t\t\t\t\t\tif (!acc) {\n\t\t\t\t\t\t\toptions.onFileUploadError({\n\t\t\t\t\t\t\t\ttype: _code.WEBIM_UPLOADFILE_NO_LOGIN,\n\t\t\t\t\t\t\t\tid: options.id\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar orgName, appName, devInfos;\n\t\t\t\t\t\tvar appKey = options.appKey || this.context.appKey || '';\n\n\t\t\t\t\t\tif (appKey) {\n\t\t\t\t\t\t\tdevInfos = appKey.split('#');\n\t\t\t\t\t\t\torgName = devInfos[0];\n\t\t\t\t\t\t\tappName = devInfos[1];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!orgName && !appName) {\n\t\t\t\t\t\t\toptions.onFileUploadError({\n\t\t\t\t\t\t\t\ttype: _code.WEBIM_UPLOADFILE_ERROR,\n\t\t\t\t\t\t\t\tid: options.id\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar apiUrl = options.apiUrl;\n\t\t\t\t\t\tvar uploadUrl = apiUrl + '/' + orgName + '/' + appName + '/chatfiles';\n\n\t\t\t\t\t\tif (!utils.isCanUploadFileAsync) {\n\t\t\t\t\t\t\tif (utils.hasFlash && typeof options.flashUpload === 'function') {\n\t\t\t\t\t\t\t\toptions.flashUpload && options.flashUpload(uploadUrl, options);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\toptions.onFileUploadError({\n\t\t\t\t\t\t\t\t\ttype: _code.WEBIM_UPLOADFILE_BROWSER_ERROR,\n\t\t\t\t\t\t\t\t\tid: options.id\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar fileSize = options.file.data ? options.file.data.size : undefined;\n\t\t\t\t\t\tif (fileSize > WEBIM_FILESIZE_LIMIT) {\n\t\t\t\t\t\t\toptions.onFileUploadError({\n\t\t\t\t\t\t\t\ttype: _code.WEBIM_UPLOADFILE_ERROR,\n\t\t\t\t\t\t\t\tid: options.id\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t} else if (fileSize <= 0) {\n\t\t\t\t\t\t\toptions.onFileUploadError({\n\t\t\t\t\t\t\t\ttype: _code.WEBIM_UPLOADFILE_ERROR,\n\t\t\t\t\t\t\t\tid: options.id\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar xhr = utils.xmlrequest();\n\t\t\t\t\t\tvar onError = function onError(e) {\n\t\t\t\t\t\t\toptions.onFileUploadError({\n\t\t\t\t\t\t\t\ttype: _code.WEBIM_UPLOADFILE_ERROR,\n\t\t\t\t\t\t\t\tid: options.id,\n\t\t\t\t\t\t\t\txhr: xhr\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif (xhr.upload) {\n\t\t\t\t\t\t\txhr.upload.addEventListener('progress', options.onFileUploadProgress, false);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (xhr.addEventListener) {\n\t\t\t\t\t\t\txhr.addEventListener('abort', options.onFileUploadCanceled, false);\n\t\t\t\t\t\t\txhr.addEventListener('load', function (e) {\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tvar json = utils.parseJSON(xhr.responseText);\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\toptions.onFileUploadComplete(json);\n\t\t\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\t\t\toptions.onFileUploadError({\n\t\t\t\t\t\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,\n\t\t\t\t\t\t\t\t\t\t\tdata: e\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\t\toptions.onFileUploadError({\n\t\t\t\t\t\t\t\t\t\ttype: _code.WEBIM_UPLOADFILE_ERROR,\n\t\t\t\t\t\t\t\t\t\tdata: xhr.responseText,\n\t\t\t\t\t\t\t\t\t\tid: options.id,\n\t\t\t\t\t\t\t\t\t\txhr: xhr\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, false);\n\t\t\t\t\t\t\txhr.addEventListener('error', onError, false);\n\t\t\t\t\t\t} else if (xhr.onreadystatechange) {\n\t\t\t\t\t\t\txhr.onreadystatechange = function () {\n\t\t\t\t\t\t\t\tif (xhr.readyState === 4) {\n\t\t\t\t\t\t\t\t\tif (ajax.status === 200) {\n\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\tvar json = utils.parseJSON(xhr.responseText);\n\t\t\t\t\t\t\t\t\t\t\toptions.onFileUploadComplete(json);\n\t\t\t\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\t\t\t\toptions.onFileUploadError({\n\t\t\t\t\t\t\t\t\t\t\t\ttype: _code.WEBIM_UPLOADFILE_ERROR,\n\t\t\t\t\t\t\t\t\t\t\t\tdata: xhr.responseText,\n\t\t\t\t\t\t\t\t\t\t\t\tid: options.id,\n\t\t\t\t\t\t\t\t\t\t\t\txhr: xhr\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\toptions.onFileUploadError({\n\t\t\t\t\t\t\t\t\t\t\ttype: _code.WEBIM_UPLOADFILE_ERROR,\n\t\t\t\t\t\t\t\t\t\t\tdata: xhr.responseText,\n\t\t\t\t\t\t\t\t\t\t\tid: options.id,\n\t\t\t\t\t\t\t\t\t\t\txhr: xhr\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\txhr.abort();\n\t\t\t\t\t\t\t\t\toptions.onFileUploadCanceled();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\txhr.open('POST', uploadUrl);\n\n\t\t\t\t\t\txhr.setRequestHeader('restrict-access', 'true');\n\t\t\t\t\t\txhr.setRequestHeader('Accept', '*/*'); // Android QQ browser has some problem with this attribute.\n\t\t\t\t\t\txhr.setRequestHeader('Authorization', 'Bearer ' + acc);\n\n\t\t\t\t\t\tvar formData = new FormData();\n\t\t\t\t\t\tformData.append('file', options.file.data);\n\t\t\t\t\t\txhr.send(formData);\n\t\t\t\t\t},\n\n\t\t\t\t\tdownload: function download(options) {\n\t\t\t\t\t\toptions.onFileDownloadComplete = options.onFileDownloadComplete || EMPTYFN;\n\t\t\t\t\t\toptions.onFileDownloadError = options.onFileDownloadError || EMPTYFN;\n\n\t\t\t\t\t\tvar accessToken = options.accessToken || this.context.accessToken;\n\t\t\t\t\t\tif (!accessToken) {\n\t\t\t\t\t\t\toptions.onFileDownloadError({\n\t\t\t\t\t\t\t\ttype: _code.WEBIM_DOWNLOADFILE_NO_LOGIN,\n\t\t\t\t\t\t\t\tid: options.id\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar onError = function onError(e) {\n\t\t\t\t\t\t\toptions.onFileDownloadError({\n\t\t\t\t\t\t\t\ttype: _code.WEBIM_DOWNLOADFILE_ERROR,\n\t\t\t\t\t\t\t\tid: options.id,\n\t\t\t\t\t\t\t\txhr: xhr\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (!utils.isCanDownLoadFile) {\n\t\t\t\t\t\t\toptions.onFileDownloadComplete();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar xhr = utils.xmlrequest();\n\t\t\t\t\t\tif ('addEventListener' in xhr) {\n\t\t\t\t\t\t\txhr.addEventListener('load', function (e) {\n\t\t\t\t\t\t\t\toptions.onFileDownloadComplete(xhr.response, xhr);\n\t\t\t\t\t\t\t}, false);\n\t\t\t\t\t\t\txhr.addEventListener('error', onError, false);\n\t\t\t\t\t\t} else if ('onreadystatechange' in xhr) {\n\t\t\t\t\t\t\txhr.onreadystatechange = function () {\n\t\t\t\t\t\t\t\tif (xhr.readyState === 4) {\n\t\t\t\t\t\t\t\t\tif (ajax.status === 200) {\n\t\t\t\t\t\t\t\t\t\toptions.onFileDownloadComplete(xhr.response, xhr);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\toptions.onFileDownloadError({\n\t\t\t\t\t\t\t\t\t\t\ttype: _code.WEBIM_DOWNLOADFILE_ERROR,\n\t\t\t\t\t\t\t\t\t\t\tid: options.id,\n\t\t\t\t\t\t\t\t\t\t\txhr: xhr\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\txhr.abort();\n\t\t\t\t\t\t\t\t\toptions.onFileDownloadError({\n\t\t\t\t\t\t\t\t\t\ttype: _code.WEBIM_DOWNLOADFILE_ERROR,\n\t\t\t\t\t\t\t\t\t\tid: options.id,\n\t\t\t\t\t\t\t\t\t\txhr: xhr\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar method = options.method || 'GET';\n\t\t\t\t\t\tvar resType = options.responseType || 'blob';\n\t\t\t\t\t\tvar mimeType = options.mimeType || 'text/plain; charset=x-user-defined';\n\t\t\t\t\t\txhr.open(method, options.url);\n\t\t\t\t\t\tif (typeof Blob !== 'undefined') {\n\t\t\t\t\t\t\txhr.responseType = resType;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\txhr.overrideMimeType(mimeType);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar innerHeaer = {\n\t\t\t\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t\t\t\t\t'Accept': 'application/octet-stream',\n\t\t\t\t\t\t\t'share-secret': options.secret,\n\t\t\t\t\t\t\t'Authorization': 'Bearer ' + accessToken\n\t\t\t\t\t\t};\n\t\t\t\t\t\tvar headers = options.headers || {};\n\t\t\t\t\t\tfor (var key in headers) {\n\t\t\t\t\t\t\tinnerHeaer[key] = headers[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfor (var key in innerHeaer) {\n\t\t\t\t\t\t\tif (innerHeaer[key]) {\n\t\t\t\t\t\t\t\txhr.setRequestHeader(key, innerHeaer[key]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\txhr.send(null);\n\t\t\t\t\t},\n\n\t\t\t\t\tparseTextMessage: function parseTextMessage(message, faces) {\n\t\t\t\t\t\tif (typeof message !== 'string') {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Object.prototype.toString.call(faces) !== '[object Object]') {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tisemoji: false,\n\t\t\t\t\t\t\t\tbody: [{\n\t\t\t\t\t\t\t\t\ttype: 'txt',\n\t\t\t\t\t\t\t\t\tdata: message\n\t\t\t\t\t\t\t\t}]\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar receiveMsg = message;\n\t\t\t\t\t\tvar emessage = [];\n\t\t\t\t\t\tvar expr = /\\[[^[\\]]{2,3}\\]/mg;\n\t\t\t\t\t\tvar emoji = receiveMsg.match(expr);\n\n\t\t\t\t\t\tif (!emoji || emoji.length < 1) {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tisemoji: false,\n\t\t\t\t\t\t\t\tbody: [{\n\t\t\t\t\t\t\t\t\ttype: 'txt',\n\t\t\t\t\t\t\t\t\tdata: message\n\t\t\t\t\t\t\t\t}]\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar isemoji = false;\n\t\t\t\t\t\tfor (var i = 0; i < emoji.length; i++) {\n\t\t\t\t\t\t\tvar tmsg = receiveMsg.substring(0, receiveMsg.indexOf(emoji[i])),\n\t\t\t\t\t\t\t    existEmoji = WebIM.Emoji.map[emoji[i]];\n\n\t\t\t\t\t\t\tif (tmsg) {\n\t\t\t\t\t\t\t\temessage.push({\n\t\t\t\t\t\t\t\t\ttype: 'txt',\n\t\t\t\t\t\t\t\t\tdata: tmsg\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (!existEmoji) {\n\t\t\t\t\t\t\t\temessage.push({\n\t\t\t\t\t\t\t\t\ttype: 'txt',\n\t\t\t\t\t\t\t\t\tdata: emoji[i]\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvar emojiStr = WebIM.Emoji.map ? WebIM.Emoji.path + existEmoji : null;\n\n\t\t\t\t\t\t\tif (emojiStr) {\n\t\t\t\t\t\t\t\tisemoji = true;\n\t\t\t\t\t\t\t\temessage.push({\n\t\t\t\t\t\t\t\t\ttype: 'emoji',\n\t\t\t\t\t\t\t\t\tdata: emojiStr\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\temessage.push({\n\t\t\t\t\t\t\t\t\ttype: 'txt',\n\t\t\t\t\t\t\t\t\tdata: emoji[i]\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvar restMsgIndex = receiveMsg.indexOf(emoji[i]) + emoji[i].length;\n\t\t\t\t\t\t\treceiveMsg = receiveMsg.substring(restMsgIndex);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (receiveMsg) {\n\t\t\t\t\t\t\temessage.push({\n\t\t\t\t\t\t\t\ttype: 'txt',\n\t\t\t\t\t\t\t\tdata: receiveMsg\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (isemoji) {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tisemoji: isemoji,\n\t\t\t\t\t\t\t\tbody: emessage\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tisemoji: false,\n\t\t\t\t\t\t\tbody: [{\n\t\t\t\t\t\t\t\ttype: 'txt',\n\t\t\t\t\t\t\t\tdata: message\n\t\t\t\t\t\t\t}]\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\n\t\t\t\t\tparseUri: function parseUri() {\n\t\t\t\t\t\tvar pattern = /([^\\?|&])\\w+=([^&]+)/g;\n\t\t\t\t\t\tvar uri = {};\n\t\t\t\t\t\tif (window.location.search) {\n\t\t\t\t\t\t\tvar args = window.location.search.match(pattern);\n\t\t\t\t\t\t\tfor (var i in args) {\n\t\t\t\t\t\t\t\tvar str = args[i];\n\t\t\t\t\t\t\t\tvar eq = str.indexOf('=');\n\t\t\t\t\t\t\t\tvar key = str.substr(0, eq);\n\t\t\t\t\t\t\t\tvar value = str.substr(eq + 1);\n\t\t\t\t\t\t\t\turi[key] = value;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn uri;\n\t\t\t\t\t},\n\n\t\t\t\t\txmlrequest: _xmlrequest,\n\n\t\t\t\t\tgetXmlFirstChild: function getXmlFirstChild(data, tagName) {\n\t\t\t\t\t\tvar children = data.getElementsByTagName(tagName);\n\t\t\t\t\t\tif (children.length == 0) {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn children[0];\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tajax: function ajax(options) {\n\t\t\t\t\t\tvar dataType = options.dataType || 'text';\n\t\t\t\t\t\tvar suc = options.success || EMPTYFN;\n\t\t\t\t\t\tvar error = options.error || EMPTYFN;\n\t\t\t\t\t\tvar xhr = utils.xmlrequest();\n\n\t\t\t\t\t\txhr.onreadystatechange = function () {\n\t\t\t\t\t\t\tif (xhr.readyState === 4) {\n\t\t\t\t\t\t\t\tvar status = xhr.status || 0;\n\t\t\t\t\t\t\t\tif (status === 200) {\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\tswitch (dataType) {\n\t\t\t\t\t\t\t\t\t\t\tcase 'text':\n\t\t\t\t\t\t\t\t\t\t\t\tsuc(xhr.responseText);\n\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\tcase 'json':\n\t\t\t\t\t\t\t\t\t\t\t\tvar json = utils.parseJSON(xhr.responseText);\n\t\t\t\t\t\t\t\t\t\t\t\tsuc(json, xhr);\n\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\tcase 'xml':\n\t\t\t\t\t\t\t\t\t\t\t\tif (xhr.responseXML && xhr.responseXML.documentElement) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tsuc(xhr.responseXML.documentElement, xhr);\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\terror({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_AJAX_ERROR,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata: xhr.responseText\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tsuc(xhr.response || xhr.responseText, xhr);\n\t\t\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\t\t\terror({\n\t\t\t\t\t\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_AJAX_ERROR,\n\t\t\t\t\t\t\t\t\t\t\tdata: e\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\terror({\n\t\t\t\t\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_AJAX_ERROR,\n\t\t\t\t\t\t\t\t\t\tdata: xhr.responseText\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (xhr.readyState === 0) {\n\t\t\t\t\t\t\t\terror({\n\t\t\t\t\t\t\t\t\ttype: _code.WEBIM_CONNCTION_AJAX_ERROR,\n\t\t\t\t\t\t\t\t\tdata: xhr.responseText\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (options.responseType) {\n\t\t\t\t\t\t\tif (xhr.responseType) {\n\t\t\t\t\t\t\t\txhr.responseType = options.responseType;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (options.mimeType) {\n\t\t\t\t\t\t\tif (utils.hasOverrideMimeType) {\n\t\t\t\t\t\t\t\txhr.overrideMimeType(options.mimeType);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar type = options.type || 'POST',\n\t\t\t\t\t\t    data = options.data || null,\n\t\t\t\t\t\t    tempData = '';\n\n\t\t\t\t\t\tif (type.toLowerCase() === 'get' && data) {\n\t\t\t\t\t\t\tfor (var o in data) {\n\t\t\t\t\t\t\t\tif (data.hasOwnProperty(o)) {\n\t\t\t\t\t\t\t\t\ttempData += o + '=' + data[o] + '&';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttempData = tempData ? tempData.slice(0, -1) : tempData;\n\t\t\t\t\t\t\toptions.url += (options.url.indexOf('?') > 0 ? '&' : '?') + (tempData ? tempData + '&' : tempData) + '_v=' + new Date().getTime();\n\t\t\t\t\t\t\tdata = null;\n\t\t\t\t\t\t\ttempData = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\txhr.open(type, options.url);\n\n\t\t\t\t\t\tif (utils.isCanSetRequestHeader) {\n\t\t\t\t\t\t\tvar headers = options.headers || {};\n\t\t\t\t\t\t\tfor (var key in headers) {\n\t\t\t\t\t\t\t\tif (headers.hasOwnProperty(key)) {\n\t\t\t\t\t\t\t\t\txhr.setRequestHeader(key, headers[key]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\txhr.send(data);\n\t\t\t\t\t\treturn xhr;\n\t\t\t\t\t},\n\t\t\t\t\tts: function ts() {\n\t\t\t\t\t\tvar d = new Date();\n\t\t\t\t\t\tvar Hours = d.getHours(); //获取当前小时数(0-23)\n\t\t\t\t\t\tvar Minutes = d.getMinutes(); //获取当前分钟数(0-59)\n\t\t\t\t\t\tvar Seconds = d.getSeconds(); //获取当前秒数(0-59)\n\t\t\t\t\t\tvar Milliseconds = d.getMilliseconds(); //获取当前毫秒\n\t\t\t\t\t\treturn (Hours < 10 ? \"0\" + Hours : Hours) + ':' + (Minutes < 10 ? \"0\" + Minutes : Minutes) + ':' + (Seconds < 10 ? \"0\" + Seconds : Seconds) + ':' + Milliseconds + ' ';\n\t\t\t\t\t},\n\n\t\t\t\t\tgetObjectKey: function getObjectKey(obj, val) {\n\t\t\t\t\t\tfor (var key in obj) {\n\t\t\t\t\t\t\tif (obj[key] == val) {\n\t\t\t\t\t\t\t\treturn key;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn '';\n\t\t\t\t\t},\n\n\t\t\t\t\tsprintf: function sprintf() {\n\t\t\t\t\t\tvar arg = arguments,\n\t\t\t\t\t\t    str = arg[0] || '',\n\t\t\t\t\t\t    i,\n\t\t\t\t\t\t    len;\n\t\t\t\t\t\tfor (i = 1, len = arg.length; i < len; i++) {\n\t\t\t\t\t\t\tstr = str.replace(/%s/, arg[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn str;\n\t\t\t\t\t},\n\n\t\t\t\t\tencrypt: function encrypt(str) {\n\t\t\t\t\t\tvar base64 = new _base64();\n\t\t\t\t\t\tvar encrypt = base64.encode(str);\n\t\t\t\t\t\treturn encrypt;\n\t\t\t\t\t},\n\n\t\t\t\t\tdecrypt: function decrypt(str) {\n\t\t\t\t\t\tvar base64 = new _base64();\n\t\t\t\t\t\tvar decrypt = base64.decode(str);\n\t\t\t\t\t\tdecrypt = escape(decrypt);\n\t\t\t\t\t\tdecrypt = decrypt.replace(/%00/g, '');\n\t\t\t\t\t\tdecrypt = unescape(decrypt);\n\t\t\t\t\t\treturn decrypt;\n\t\t\t\t\t},\n\n\t\t\t\t\tsetCookie: function setCookie(name, value, days) {\n\t\t\t\t\t\tvar cookie = name + '=' + encodeURIComponent(value);\n\t\t\t\t\t\tif (typeof days == 'number') {\n\t\t\t\t\t\t\tcookie += '; max-age: ' + days * 60 * 60 * 24;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdocument.cookie = cookie;\n\t\t\t\t\t},\n\n\t\t\t\t\tgetCookie: function getCookie() {\n\t\t\t\t\t\tvar allCookie = {};\n\t\t\t\t\t\tvar all = document.cookie;\n\t\t\t\t\t\tif (all === \"\") {\n\t\t\t\t\t\t\treturn allCookie;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar list = all.split(\"; \");\n\t\t\t\t\t\tfor (var i = 0; i < list.length; i++) {\n\t\t\t\t\t\t\tvar cookie = list[i];\n\t\t\t\t\t\t\tvar p = cookie.indexOf('=');\n\t\t\t\t\t\t\tvar name = cookie.substring(0, p);\n\t\t\t\t\t\t\tvar value = cookie.substring(p + 1);\n\t\t\t\t\t\t\tvalue = decodeURIComponent(value);\n\t\t\t\t\t\t\tallCookie[name] = value;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn allCookie;\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\texports.utils = utils;\n\t\t\t})();\n\n\t\t\t/***/\n\t\t},\n\t\t/* 4 */\n\t\t/***/function (module, exports, __webpack_require__) {\n\n\t\t\t;(function () {\n\t\t\t\t'use strict';\n\n\t\t\t\tvar _utils = __webpack_require__(3).utils;\n\t\t\t\tvar Message = function Message(type, id) {\n\t\t\t\t\tif (!this instanceof Message) {\n\t\t\t\t\t\treturn new Message(type);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._msg = {};\n\n\t\t\t\t\tif (typeof Message[type] === 'function') {\n\t\t\t\t\t\tMessage[type].prototype.setGroup = this.setGroup;\n\t\t\t\t\t\tthis._msg = new Message[type](id);\n\t\t\t\t\t}\n\t\t\t\t\treturn this._msg;\n\t\t\t\t};\n\t\t\t\tMessage.prototype.setGroup = function (group) {\n\t\t\t\t\tthis.body.group = group;\n\t\t\t\t};\n\n\t\t\t\t/*\n     * Read Message\n     */\n\t\t\t\tMessage.read = function (id) {\n\t\t\t\t\tthis.id = id;\n\t\t\t\t\tthis.type = 'read';\n\t\t\t\t};\n\n\t\t\t\tMessage.read.prototype.set = function (opt) {\n\t\t\t\t\tthis.body = {\n\t\t\t\t\t\tackId: opt.id,\n\t\t\t\t\t\tto: opt.to\n\t\t\t\t\t};\n\t\t\t\t};\n\n\t\t\t\t/*\n     * deliver message\n     */\n\t\t\t\tMessage.delivery = function (id) {\n\t\t\t\t\tthis.id = id;\n\t\t\t\t\tthis.type = 'delivery';\n\t\t\t\t};\n\n\t\t\t\tMessage.delivery.prototype.set = function (opt) {\n\t\t\t\t\tthis.body = {\n\t\t\t\t\t\tbodyId: opt.id,\n\t\t\t\t\t\tto: opt.to\n\t\t\t\t\t};\n\t\t\t\t};\n\n\t\t\t\t/*\n     * text message\n     */\n\t\t\t\tMessage.txt = function (id) {\n\t\t\t\t\tthis.id = id;\n\t\t\t\t\tthis.type = 'txt';\n\t\t\t\t\tthis.body = {};\n\t\t\t\t};\n\t\t\t\tMessage.txt.prototype.set = function (opt) {\n\t\t\t\t\tthis.value = opt.msg;\n\t\t\t\t\tthis.body = {\n\t\t\t\t\t\tid: this.id,\n\t\t\t\t\t\tto: opt.to,\n\t\t\t\t\t\tmsg: this.value,\n\t\t\t\t\t\ttype: this.type,\n\t\t\t\t\t\troomType: opt.roomType,\n\t\t\t\t\t\text: opt.ext || {},\n\t\t\t\t\t\tsuccess: opt.success,\n\t\t\t\t\t\tfail: opt.fail\n\t\t\t\t\t};\n\n\t\t\t\t\t!opt.roomType && delete this.body.roomType;\n\t\t\t\t};\n\n\t\t\t\t/*\n     * cmd message\n     */\n\t\t\t\tMessage.cmd = function (id) {\n\t\t\t\t\tthis.id = id;\n\t\t\t\t\tthis.type = 'cmd';\n\t\t\t\t\tthis.body = {};\n\t\t\t\t};\n\t\t\t\tMessage.cmd.prototype.set = function (opt) {\n\t\t\t\t\tthis.value = '';\n\n\t\t\t\t\tthis.body = {\n\t\t\t\t\t\tto: opt.to,\n\t\t\t\t\t\taction: opt.action,\n\t\t\t\t\t\tmsg: this.value,\n\t\t\t\t\t\ttype: this.type,\n\t\t\t\t\t\troomType: opt.roomType,\n\t\t\t\t\t\text: opt.ext || {},\n\t\t\t\t\t\tsuccess: opt.success\n\t\t\t\t\t};\n\t\t\t\t\t!opt.roomType && delete this.body.roomType;\n\t\t\t\t};\n\n\t\t\t\t/*\n     * loc message\n     */\n\t\t\t\tMessage.location = function (id) {\n\t\t\t\t\tthis.id = id;\n\t\t\t\t\tthis.type = 'loc';\n\t\t\t\t\tthis.body = {};\n\t\t\t\t};\n\t\t\t\tMessage.location.prototype.set = function (opt) {\n\t\t\t\t\tthis.body = {\n\t\t\t\t\t\tto: opt.to,\n\t\t\t\t\t\ttype: this.type,\n\t\t\t\t\t\troomType: opt.roomType,\n\t\t\t\t\t\taddr: opt.addr,\n\t\t\t\t\t\tlat: opt.lat,\n\t\t\t\t\t\tlng: opt.lng,\n\t\t\t\t\t\text: opt.ext || {}\n\t\t\t\t\t};\n\t\t\t\t};\n\n\t\t\t\t/*\n     * img message\n     */\n\t\t\t\tMessage.img = function (id) {\n\t\t\t\t\tthis.id = id;\n\t\t\t\t\tthis.type = 'img';\n\t\t\t\t\tthis.body = {};\n\t\t\t\t};\n\t\t\t\tMessage.img.prototype.set = function (opt) {\n\t\t\t\t\topt.file = opt.file || _utils.getFileUrl(opt.fileInputId);\n\n\t\t\t\t\tthis.value = opt.file;\n\n\t\t\t\t\tthis.body = {\n\t\t\t\t\t\tid: this.id,\n\t\t\t\t\t\tfile: this.value,\n\t\t\t\t\t\tapiUrl: opt.apiUrl,\n\t\t\t\t\t\tto: opt.to,\n\t\t\t\t\t\ttype: this.type,\n\t\t\t\t\t\text: opt.ext || {},\n\t\t\t\t\t\troomType: opt.roomType,\n\t\t\t\t\t\tonFileUploadError: opt.onFileUploadError,\n\t\t\t\t\t\tonFileUploadComplete: opt.onFileUploadComplete,\n\t\t\t\t\t\tsuccess: opt.success,\n\t\t\t\t\t\tfail: opt.fail,\n\t\t\t\t\t\tflashUpload: opt.flashUpload,\n\t\t\t\t\t\twidth: opt.width,\n\t\t\t\t\t\theight: opt.height,\n\t\t\t\t\t\tbody: opt.body,\n\t\t\t\t\t\tuploadError: opt.uploadError,\n\t\t\t\t\t\tuploadComplete: opt.uploadComplete\n\t\t\t\t\t};\n\n\t\t\t\t\t!opt.roomType && delete this.body.roomType;\n\t\t\t\t};\n\n\t\t\t\t/*\n     * audio message\n     */\n\t\t\t\tMessage.audio = function (id) {\n\t\t\t\t\tthis.id = id;\n\t\t\t\t\tthis.type = 'audio';\n\t\t\t\t\tthis.body = {};\n\t\t\t\t};\n\t\t\t\tMessage.audio.prototype.set = function (opt) {\n\t\t\t\t\topt.file = opt.file || _utils.getFileUrl(opt.fileInputId);\n\n\t\t\t\t\tthis.value = opt.file;\n\t\t\t\t\tthis.filename = opt.filename || this.value.filename;\n\n\t\t\t\t\tthis.body = {\n\t\t\t\t\t\tid: this.id,\n\t\t\t\t\t\tfile: this.value,\n\t\t\t\t\t\tfilename: this.filename,\n\t\t\t\t\t\tapiUrl: opt.apiUrl,\n\t\t\t\t\t\tto: opt.to,\n\t\t\t\t\t\ttype: this.type,\n\t\t\t\t\t\text: opt.ext || {},\n\t\t\t\t\t\tlength: opt.length || 0,\n\t\t\t\t\t\troomType: opt.roomType,\n\t\t\t\t\t\tfile_length: opt.file_length,\n\t\t\t\t\t\tonFileUploadError: opt.onFileUploadError,\n\t\t\t\t\t\tonFileUploadComplete: opt.onFileUploadComplete,\n\t\t\t\t\t\tsuccess: opt.success,\n\t\t\t\t\t\tfail: opt.fail,\n\t\t\t\t\t\tflashUpload: opt.flashUpload,\n\t\t\t\t\t\tbody: opt.body\n\t\t\t\t\t};\n\t\t\t\t\t!opt.roomType && delete this.body.roomType;\n\t\t\t\t};\n\n\t\t\t\t/*\n     * file message\n     */\n\t\t\t\tMessage.file = function (id) {\n\t\t\t\t\tthis.id = id;\n\t\t\t\t\tthis.type = 'file';\n\t\t\t\t\tthis.body = {};\n\t\t\t\t};\n\t\t\t\tMessage.file.prototype.set = function (opt) {\n\t\t\t\t\topt.file = opt.file || _utils.getFileUrl(opt.fileInputId);\n\n\t\t\t\t\tthis.value = opt.file;\n\t\t\t\t\tthis.filename = opt.filename || this.value.filename;\n\n\t\t\t\t\tthis.body = {\n\t\t\t\t\t\tid: this.id,\n\t\t\t\t\t\tfile: this.value,\n\t\t\t\t\t\tfilename: this.filename,\n\t\t\t\t\t\tapiUrl: opt.apiUrl,\n\t\t\t\t\t\tto: opt.to,\n\t\t\t\t\t\ttype: this.type,\n\t\t\t\t\t\text: opt.ext || {},\n\t\t\t\t\t\troomType: opt.roomType,\n\t\t\t\t\t\tonFileUploadError: opt.onFileUploadError,\n\t\t\t\t\t\tonFileUploadComplete: opt.onFileUploadComplete,\n\t\t\t\t\t\tsuccess: opt.success,\n\t\t\t\t\t\tfail: opt.fail,\n\t\t\t\t\t\tflashUpload: opt.flashUpload,\n\t\t\t\t\t\tbody: opt.body\n\t\t\t\t\t};\n\t\t\t\t\t!opt.roomType && delete this.body.roomType;\n\t\t\t\t};\n\n\t\t\t\t/*\n     * video message\n     */\n\t\t\t\tMessage.video = function (id) {};\n\t\t\t\tMessage.video.prototype.set = function (opt) {};\n\n\t\t\t\tvar _Message = function _Message(message) {\n\n\t\t\t\t\tif (!this instanceof _Message) {\n\t\t\t\t\t\treturn new _Message(message, conn);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.msg = message;\n\t\t\t\t};\n\n\t\t\t\t_Message.prototype.send = function (conn) {\n\t\t\t\t\tvar me = this;\n\n\t\t\t\t\tvar _send = function _send(message) {\n\n\t\t\t\t\t\tmessage.ext = message.ext || {};\n\t\t\t\t\t\tmessage.ext.weichat = message.ext.weichat || {};\n\t\t\t\t\t\tmessage.ext.weichat.originType = message.ext.weichat.originType || 'webim';\n\n\t\t\t\t\t\tvar dom;\n\t\t\t\t\t\tvar json = {\n\t\t\t\t\t\t\tfrom: conn.context.userId || '',\n\t\t\t\t\t\t\tto: message.to,\n\t\t\t\t\t\t\tbodies: [message.body],\n\t\t\t\t\t\t\text: message.ext || {}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tvar jsonstr = _utils.stringify(json);\n\t\t\t\t\t\tdom = $msg({\n\t\t\t\t\t\t\ttype: message.group || 'chat',\n\t\t\t\t\t\t\tto: message.toJid,\n\t\t\t\t\t\t\tid: message.id,\n\t\t\t\t\t\t\txmlns: 'jabber:client'\n\t\t\t\t\t\t}).c('body').t(jsonstr);\n\n\t\t\t\t\t\tif (message.roomType) {\n\t\t\t\t\t\t\tdom.up().c('roomtype', { xmlns: 'easemob:x:roomtype', type: 'chatroom' });\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (message.bodyId) {\n\t\t\t\t\t\t\tdom.up().c('body').t(message.bodyId);\n\t\t\t\t\t\t\tvar delivery = {\n\t\t\t\t\t\t\t\txmlns: 'urn:xmpp:receipts',\n\t\t\t\t\t\t\t\tid: message.bodyId\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tdom.up().c('delivery').t(_utils.stringify(delivery));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (message.ackId) {\n\t\t\t\t\t\t\tdom.up().c('body').t(message.ackId);\n\t\t\t\t\t\t\tvar read = {\n\t\t\t\t\t\t\t\txmlns: 'urn:xmpp:receipts',\n\t\t\t\t\t\t\t\tid: message.ackId\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tdom.up().c('acked').t(_utils.stringify(read));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t\tif (typeof _msgHash !== 'undefined' && _msgHash[message.id]) {\n\t\t\t\t\t\t\t\t_msgHash[message.id].msg.fail instanceof Function && _msgHash[message.id].msg.fail(message.id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, 60000);\n\t\t\t\t\t\tconn.sendCommand(dom.tree(), message.id);\n\t\t\t\t\t};\n\n\t\t\t\t\tif (me.msg.file) {\n\t\t\t\t\t\tif (me.msg.body && me.msg.body.url) {\n\t\t\t\t\t\t\t// Only send msg\n\t\t\t\t\t\t\t_send(me.msg);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar _tmpComplete = me.msg.onFileUploadComplete;\n\t\t\t\t\t\tvar _complete = function _complete(data) {\n\t\t\t\t\t\t\tif (data.entities[0]['file-metadata']) {\n\t\t\t\t\t\t\t\tvar file_len = data.entities[0]['file-metadata']['content-length'];\n\t\t\t\t\t\t\t\t// me.msg.file_length = file_len;\n\t\t\t\t\t\t\t\tme.msg.filetype = data.entities[0]['file-metadata']['content-type'];\n\t\t\t\t\t\t\t\tif (file_len > 204800) {\n\t\t\t\t\t\t\t\t\tme.msg.thumbnail = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tme.msg.body = {\n\t\t\t\t\t\t\t\ttype: me.msg.type || 'file',\n\n\t\t\t\t\t\t\t\turl: (location.protocol != 'https:' && conn.isHttpDNS ? conn.apiUrl + data.uri.substr(data.uri.indexOf(\"/\", 9)) : data.uri) + '/' + data.entities[0]['uuid'],\n\t\t\t\t\t\t\t\tsecret: data.entities[0]['share-secret'],\n\t\t\t\t\t\t\t\tfilename: me.msg.file.filename || me.msg.filename,\n\t\t\t\t\t\t\t\tsize: {\n\t\t\t\t\t\t\t\t\twidth: me.msg.width || 0,\n\t\t\t\t\t\t\t\t\theight: me.msg.height || 0\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tlength: me.msg.length || 0,\n\t\t\t\t\t\t\t\tfile_length: me.msg.ext.file_length || 0,\n\t\t\t\t\t\t\t\tfiletype: me.msg.filetype\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t_send(me.msg);\n\t\t\t\t\t\t\t_tmpComplete instanceof Function && _tmpComplete(data, me.msg.id);\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tme.msg.onFileUploadComplete = _complete;\n\t\t\t\t\t\t_utils.uploadFile.call(conn, me.msg);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tme.msg.body = {\n\t\t\t\t\t\t\ttype: me.msg.type === 'chat' ? 'txt' : me.msg.type,\n\t\t\t\t\t\t\tmsg: me.msg.msg\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif (me.msg.type === 'cmd') {\n\t\t\t\t\t\t\tme.msg.body.action = me.msg.action;\n\t\t\t\t\t\t} else if (me.msg.type === 'loc') {\n\t\t\t\t\t\t\tme.msg.body.addr = me.msg.addr;\n\t\t\t\t\t\t\tme.msg.body.lat = me.msg.lat;\n\t\t\t\t\t\t\tme.msg.body.lng = me.msg.lng;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t_send(me.msg);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\texports._msg = _Message;\n\t\t\t\texports.message = Message;\n\t\t\t})();\n\n\t\t\t/***/\n\t\t},\n\t\t/* 5 */\n\t\t/***/function (module, exports) {\n\n\t\t\t;(function () {\n\t\t\t\tfunction Array_h(length) {\n\t\t\t\t\tthis.array = length === undefined ? [] : new Array(length);\n\t\t\t\t}\n\n\t\t\t\tArray_h.prototype = {\n\t\t\t\t\t/**\n      * 返回数组长度\n      *\n      * @return {Number} length [数组长度]\n      */\n\t\t\t\t\tlength: function length() {\n\t\t\t\t\t\treturn this.array.length;\n\t\t\t\t\t},\n\n\t\t\t\t\tat: function at(index) {\n\t\t\t\t\t\treturn this.array[index];\n\t\t\t\t\t},\n\n\t\t\t\t\tset: function set(index, obj) {\n\t\t\t\t\t\tthis.array[index] = obj;\n\t\t\t\t\t},\n\n\t\t\t\t\t/**\n      * 向数组的末尾添加一个或多个元素，并返回新的长度。\n      *\n      * @param  {*} obj [description]\n      * @return {Number} length [新数组的长度]\n      */\n\t\t\t\t\tpush: function push(obj) {\n\t\t\t\t\t\treturn this.array.push(obj);\n\t\t\t\t\t},\n\n\t\t\t\t\t/**\n      * 返回数组中选定的元素\n      *\n      * @param  {Number} start [开始索引值]\n      * @param  {Number} end [结束索引值]\n      * @return {Array} newArray  [新的数组]\n      */\n\t\t\t\t\tslice: function slice(start, end) {\n\t\t\t\t\t\treturn this.array = this.array.slice(start, end);\n\t\t\t\t\t},\n\n\t\t\t\t\tconcat: function concat(array) {\n\t\t\t\t\t\tthis.array = this.array.concat(array);\n\t\t\t\t\t},\n\n\t\t\t\t\tremove: function remove(index, count) {\n\t\t\t\t\t\tcount = count === undefined ? 1 : count;\n\t\t\t\t\t\tthis.array.splice(index, count);\n\t\t\t\t\t},\n\n\t\t\t\t\tjoin: function join(separator) {\n\t\t\t\t\t\treturn this.array.join(separator);\n\t\t\t\t\t},\n\n\t\t\t\t\tclear: function clear() {\n\t\t\t\t\t\tthis.array.length = 0;\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\t/**\n     * 先进先出队列 (First Input First Output)\n     *\n     * 一种先进先出的数据缓存器\n     */\n\t\t\t\tvar Queue = function Queue() {\n\t\t\t\t\tthis._array_h = new Array_h();\n\t\t\t\t};\n\n\t\t\t\tQueue.prototype = {\n\t\t\t\t\t_index: 0,\n\n\t\t\t\t\t/**\n      * 排队\n      *\n      * @param  {Object} obj [description]\n      * @return {[type]}     [description]\n      */\n\t\t\t\t\tpush: function push(obj) {\n\t\t\t\t\t\tthis._array_h.push(obj);\n\t\t\t\t\t},\n\n\t\t\t\t\t/**\n      * 出队\n      *\n      * @return {Object} [description]\n      */\n\t\t\t\t\tpop: function pop() {\n\t\t\t\t\t\tvar ret = null;\n\t\t\t\t\t\tif (this._array_h.length()) {\n\t\t\t\t\t\t\tret = this._array_h.at(this._index);\n\t\t\t\t\t\t\tif (++this._index * 2 >= this._array_h.length()) {\n\t\t\t\t\t\t\t\tthis._array_h.slice(this._index);\n\t\t\t\t\t\t\t\tthis._index = 0;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn ret;\n\t\t\t\t\t},\n\n\t\t\t\t\t/**\n      * 返回队列中头部(即最新添加的)的动态对象\n      *\n      * @return {Object} [description]\n      */\n\t\t\t\t\thead: function head() {\n\t\t\t\t\t\tvar ret = null,\n\t\t\t\t\t\t    len = this._array_h.length();\n\t\t\t\t\t\tif (len) {\n\t\t\t\t\t\t\tret = this._array_h.at(len - 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn ret;\n\t\t\t\t\t},\n\n\t\t\t\t\t/**\n      * 返回队列中尾部(即最早添加的)的动态对象\n      *\n      * @return {Object} [description]\n      */\n\t\t\t\t\ttail: function tail() {\n\t\t\t\t\t\tvar ret = null,\n\t\t\t\t\t\t    len = this._array_h.length();\n\t\t\t\t\t\tif (len) {\n\t\t\t\t\t\t\tret = this._array_h.at(this._index);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn ret;\n\t\t\t\t\t},\n\n\t\t\t\t\t/**\n      * 返回数据队列长度\n      *\n      * @return {Number} [description]\n      */\n\t\t\t\t\tlength: function length() {\n\t\t\t\t\t\treturn this._array_h.length() - this._index;\n\t\t\t\t\t},\n\n\t\t\t\t\t/**\n      * 队列是否为空\n      *\n      * @return {Boolean} [description]\n      */\n\t\t\t\t\tempty: function empty() {\n\t\t\t\t\t\treturn this._array_h.length() === 0;\n\t\t\t\t\t},\n\n\t\t\t\t\tclear: function clear() {\n\t\t\t\t\t\tthis._array_h.clear();\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\texports.Queue = Queue;\n\t\t\t})();\n\n\t\t\t/***/\n\t\t}\n\t\t/******/])\n\t);\n});\n;"]}